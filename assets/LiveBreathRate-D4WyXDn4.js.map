{"version":3,"file":"LiveBreathRate-D4WyXDn4.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Health/Components/LiveBreathRate.jsx"],"sourcesContent":["import { useState, useEffect, useContext, useCallback, useRef } from \"react\";\r\nimport LiveRateChart from \"@/Components/GraphAndChart/LiveRateChart\";\r\nimport { FaLungs } from \"react-icons/fa\";\r\nimport { CustomContext } from \"@/Context/UseCustomContext\";\r\nimport { decodeHeartBreath } from \"@/utils/helper\";\r\nimport { Tooltip } from \"antd\";\r\nimport { IoMdInformationCircle } from \"react-icons/io\";\r\nimport { WebSocketContext } from \"@/Context/WebSoketHook\";\r\nexport default function BreathRate() {\r\n  const { elderlyDetails, sleepData } = useContext(CustomContext);\r\n  const { deviceData } = useContext(WebSocketContext);\r\n  const deviceCodes = elderlyDetails?.deviceId;\r\n  const [data, setData] = useState({\r\n    time: [],\r\n    heartRate: [],\r\n    breathRate: [],\r\n  });\r\n\r\n  const [liveRateData, setLiveRateData] = useState(null);\r\n  const lastBase64Ref = useRef(null);\r\n  const lastUpdateRef = useRef(Date.now());\r\n  const handleDecode = useCallback((base64Input) => {\r\n    if (lastBase64Ref.current === base64Input) {\r\n      return;\r\n    }\r\n    lastBase64Ref.current = base64Input;\r\n    lastUpdateRef.current = Date.now();\r\n\r\n    const decoded = decodeHeartBreath(base64Input);\r\n    setLiveRateData(decoded);\r\n    const newTime = new Date().toLocaleTimeString();\r\n\r\n    setData((prevData) => {\r\n      let updatedTime = [...prevData.time];\r\n      let updatedBreath = [...prevData.breathRate];\r\n\r\n      if (updatedBreath.length === 0) {\r\n        const fakeBreath = Math.max(\r\n          0,\r\n          decoded.breathingValue + (Math.random() < 0.5 ? 0 : 0)\r\n        );\r\n        updatedTime.push(newTime);\r\n        updatedBreath.push(fakeBreath);\r\n      }\r\n\r\n      updatedTime.push(newTime);\r\n      updatedBreath.push(decoded.breathingValue);\r\n\r\n      return {\r\n        time: updatedTime.slice(-30),\r\n        breathRate: updatedBreath.slice(-30),\r\n      };\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      if (Date.now() - lastUpdateRef.current > 5000) {\r\n        setData({ time: [], breathRate: [] });\r\n        setLiveRateData(null);\r\n        lastBase64Ref.current = null;\r\n      }\r\n    }, 500);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (!deviceCodes?.length) {\r\n      setLiveRateData(null);\r\n      return;\r\n    }\r\n    for (const code of [deviceCodes]) {\r\n      if (!deviceData[code]) continue;\r\n      const { heartBreath } = deviceData[code];\r\n      if (heartBreath) {\r\n        handleDecode(heartBreath);\r\n        return;\r\n      }\r\n    }\r\n\r\n    setLiveRateData(null);\r\n  }, [deviceData]);\r\n  return (\r\n    <div className=\"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto\">\r\n      <div className=\"text-2xl font-bold text-primary flex items-center gap-2\">\r\n        Current Breathing Pattern\r\n        <Tooltip\r\n          title=\"This feature functions only if the user is in the monitoring bed.\"\r\n          className=\"cursor-pointer\"\r\n        >\r\n          <IoMdInformationCircle size=\"18px\" />\r\n        </Tooltip>\r\n      </div>\r\n      <div id=\"LiveRate\" className=\"flex flex-col gap-1 pl-3 mb-2\">\r\n        <div\r\n          className={`text-4xl font-bold flex items-center gap-2`}\r\n          style={{\r\n            color: \"#FFA54D\",\r\n          }}\r\n        >\r\n          {liveRateData?.breathingValue ?? \"--\"}{\" \"}\r\n          <span className=\"text-secondary/40\">BPM</span>\r\n          <FaLungs color=\"#FFA54D\" size={24} />\r\n        </div>\r\n      </div>\r\n      <LiveRateChart data={data} color=\"#FFA54D\" type=\"breathRate\" />\r\n      <div id=\"footer\">\r\n        <div className=\"flex justify-evenly items-center\">\r\n          <div\r\n            id=\"avgRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {sleepData?.breath_rate_vo?.avg ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Avgerage</div>\r\n          </div>\r\n          <div\r\n            id=\"minRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.min ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Minimum</div>\r\n          </div>\r\n          <div\r\n            id=\"maxRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.max ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Maximum</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["BreathRate","elderlyDetails","sleepData","useContext","CustomContext","deviceData","WebSocketContext","deviceCodes","data","setData","useState","liveRateData","setLiveRateData","lastBase64Ref","useRef","lastUpdateRef","handleDecode","useCallback","base64Input","decoded","decodeHeartBreath","newTime","prevData","updatedTime","updatedBreath","fakeBreath","useEffect","interval","code","heartBreath","jsxs","jsx","Tooltip","IoMdInformationCircle","FaLungs","LiveRateChart","_a","_b","_c"],"mappings":"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"}