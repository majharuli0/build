import{r as i,j as e,fm as g}from"./index-Cx2ZnkBC.js";import p from"./LiveRateChart-CQ_RgcO8.js";import{C as N}from"./UseCustomContext-B_8njEg6.js";import{d as y}from"./helper-DZks3_Jq.js";import"./index-BgeVerw7.js";function k(){var f,h,v;const{elderlyDetails:c,sleepData:s}=i.useContext(N),l=c==null?void 0:c.deviceId,[u,d]=i.useState({time:[],heartRate:[],breathRate:[]}),[o,x]=i.useState(null),[m,j]=i.useState(Date.now()),b=t=>{const r=y(t);x(r),j(Date.now())};return i.useEffect(()=>{const t=setInterval(()=>{if(Date.now()-m>5e3)x(null),d([]);else if(o){const a=new Date().toLocaleTimeString();d(n=>({time:[...n.time,a].slice(-30),heartRate:[...n.heartRate,o.heartRateValue].slice(-30),breathRate:[...n.breathRate,o.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(t)},[o,m]),i.useEffect(()=>{const t=new WebSocket("ws://localhost:8080");return t.onopen=()=>{console.log("Connected to WebSocket server"),t.send(JSON.stringify({uid:l}))},t.onmessage=r=>{const a=JSON.parse(r==null?void 0:r.data).payload;(a==null?void 0:a.deviceCode)===l&&(a!=null&&a.heartbreath)&&b(a.heartbreath)},t.onerror=r=>{console.error("WebSocket error:",r)},t.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>t.close()},[l]),e.jsxs("div",{className:"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"Live Heart Rate"}),e.jsx("div",{id:"LiveRate",className:"flex flex-col gap-1 pl-3 mb-2",children:e.jsxs("div",{className:"text-4xl font-bold flex items-center gap-2",style:{color:"#D76C82"},children:[(o==null?void 0:o.heartRateValue)??"--"," ",e.jsx("span",{className:"text-secondary/40",children:"BPM"}),e.jsx(g,{color:"#D76C82",size:24})]})}),e.jsx(p,{data:u,color:"#D76C82",type:"heartRate"}),e.jsx("div",{id:"footer",children:e.jsxs("div",{className:"flex justify-evenly items-center",children:[e.jsxs("div",{id:"avgRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsx("div",{className:"text-3xl text-primary font-bold",children:(f=s==null?void 0:s.heart_rate_vo)==null?void 0:f.avg}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Avg. Rate"})]}),e.jsxs("div",{id:"minRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(h=s==null?void 0:s.heart_rate_vo)==null?void 0:h.min]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Min Rate"})]}),e.jsxs("div",{id:"maxRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(v=s==null?void 0:s.heart_rate_vo)==null?void 0:v.max]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Max Rate"})]})]})})]})}export{k as default};
