{"version":3,"file":"index-DkJPelEJ.js","sources":["../../src/Pages/UserProfileView/index.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\r\nimport { useParams, useLocation } from \"react-router-dom\";\r\nimport ls from \"store2\";\r\nimport { getUserDetails, getUserToken } from \"@/api/Users\";\r\nimport { useCountStore } from \"@/store/index\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Loader from \"@/Components/Loader\";\r\nimport { getToken, setToken } from \"@/utils/auth\";\r\nexport default function UserProfileView() {\r\n  const params = useParams();\r\n  const location = useLocation();\r\n  const { role } = location.state || {};\r\n  const [loading, setLoading] = useState(true);\r\n  const { setStoreRole, setUser } = useCountStore();\r\n  const navigate = useNavigate();\r\n  let param = params.id.split(\"-\");\r\n\r\n  // Store the original token in localStorage when switching roles\r\n  const storeOriginalToken = () => {\r\n    let user = ls.get(\"user\");\r\n    const currentToken = getToken(); // Get the current token from storage\r\n\r\n    if (!ls.get(\"rootToken\")) {\r\n      ls.set(\"rootToken\", currentToken);\r\n      ls.set(\"rootRole\", user.role);\r\n    }\r\n  };\r\n\r\n  // Switch to the new user's token\r\n  const switchToNewToken = (newToken) => {\r\n    setToken(newToken); // Replace the token with the new user's token\r\n  };\r\n\r\n  const getUserDetail = useCallback(() => {\r\n    console.log(param);\r\n    if (param.length >= 2) {\r\n      getUserToken({\r\n        id: param[0],\r\n        params: {\r\n          role: \"nurse\",\r\n        },\r\n      })\r\n        .then((res) => {\r\n          setUpEverythingForViewProfile({ ...res.data, sub_role: \"elderly\" });\r\n          storeOriginalToken();\r\n          switchToNewToken(res.data.access_token);\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n      getUserDetails({\r\n        id: param[0],\r\n      })\r\n        .then((res) => {\r\n          if (res.data.role !== \"nursing_home\") {\r\n            setUpEverythingForViewProfile({ ...res.data, sub_role: \"elderly\" });\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n\r\n      return;\r\n    }\r\n    getUserDetails({\r\n      id: params.id,\r\n    })\r\n      .then((res) => {\r\n        setUpEverythingForViewProfile(res.data);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n    getUserToken({\r\n      id: params.id,\r\n    })\r\n      .then((res) => {\r\n        storeOriginalToken();\r\n        switchToNewToken(res.data.access_token);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }, [role, params.id]);\r\n  const nvto = (active) => {\r\n    if (active == \"super_admin\") {\r\n      navigate(\"/support-agent/dashboard/\");\r\n    } else if (active == \"supports_agent\") {\r\n      navigate(\"/supporter/support-agent/dashboard\");\r\n    } else if (active == \"nurse\") {\r\n      navigate(\"/supporter/nurse/dashboard\");\r\n    } else if (active == \"end_user\") {\r\n      navigate(\"/supporter/end-user/dashboard\");\r\n    } else if (active == \"elderly\") {\r\n      navigate(`/supporter/elderlies/elderly-profile/${param[1]}?tab=overview`);\r\n    } else {\r\n      navigate(\"/support-nurnt/dashboard\");\r\n    }\r\n  };\r\n\r\n  function setUpEverythingForViewProfile(data) {\r\n    ls.set(\"user\", data);\r\n    ls.set(\"mainRole\", data.role);\r\n    ls.set(\"role\", data.role);\r\n    setStoreRole({ role: data.role });\r\n    setUser({ role: data.role });\r\n    setTimeout(() => {\r\n      setLoading(false);\r\n      nvto(data?.sub_role || data?.role);\r\n    }, 1500);\r\n  }\r\n\r\n  useEffect(() => {\r\n    getUserDetail();\r\n  }, [getUserDetail]);\r\n  if (loading) return <Loader loaderTitle=\"Loading User Profile\" />;\r\n}\r\n"],"names":["UserProfileView","params","useParams","location","useLocation","role","loading","setLoading","useState","setStoreRole","setUser","useCountStore","navigate","useNavigate","param","storeOriginalToken","user","ls","currentToken","getToken","switchToNewToken","newToken","setToken","getUserDetail","useCallback","getUserToken","res","setUpEverythingForViewProfile","err","getUserDetails","nvto","active","data","useEffect","jsx","Loader"],"mappings":"8bAQA,SAAwBA,GAAkB,CACxC,MAAMC,EAASC,IACTC,EAAWC,IACX,CAAE,KAAAC,CAAS,EAAAF,EAAS,OAAS,CAAA,EAC7B,CAACG,EAASC,CAAU,EAAIC,WAAS,EAAI,EACrC,CAAE,aAAAC,EAAc,QAAAC,CAAQ,EAAIC,EAAc,EAC1CC,EAAWC,IACjB,IAAIC,EAAQb,EAAO,GAAG,MAAM,GAAG,EAG/B,MAAMc,EAAqB,IAAM,CAC3B,IAAAC,EAAOC,EAAG,IAAI,MAAM,EACxB,MAAMC,EAAeC,IAEhBF,EAAG,IAAI,WAAW,IAClBA,EAAA,IAAI,YAAaC,CAAY,EAC7BD,EAAA,IAAI,WAAYD,EAAK,IAAI,EAC9B,EAIII,EAAoBC,GAAa,CACrCC,EAASD,CAAQ,CAAA,EAGbE,EAAgBC,EAAAA,YAAY,IAAM,CAElC,GADJ,QAAQ,IAAIV,CAAK,EACbA,EAAM,QAAU,EAAG,CACRW,EAAA,CACX,GAAIX,EAAM,CAAC,EACX,OAAQ,CACN,KAAM,OACR,CAAA,CACD,EACE,KAAMY,GAAQ,CACbC,EAA8B,CAAE,GAAGD,EAAI,KAAM,SAAU,UAAW,EAC/CX,IACFK,EAAAM,EAAI,KAAK,YAAY,CAAA,CACvC,EACA,MAAOE,GAAQ,CACd,QAAQ,IAAIA,CAAG,CAAA,CAChB,EACYC,EAAA,CACb,GAAIf,EAAM,CAAC,CAAA,CACZ,EACE,KAAMY,GAAQ,CACTA,EAAI,KAAK,OAAS,gBACpBC,EAA8B,CAAE,GAAGD,EAAI,KAAM,SAAU,UAAW,CACpE,CACD,EACA,MAAOE,GAAQ,CACd,QAAQ,IAAIA,CAAG,CAAA,CAChB,EAEH,MACF,CACeC,EAAA,CACb,GAAI5B,EAAO,EAAA,CACZ,EACE,KAAMyB,GAAQ,CACbC,EAA8BD,EAAI,IAAI,CAAA,CACvC,EACA,MAAOE,GAAQ,CACd,QAAQ,IAAIA,CAAG,CAAA,CAChB,EACUH,EAAA,CACX,GAAIxB,EAAO,EAAA,CACZ,EACE,KAAMyB,GAAQ,CACMX,IACFK,EAAAM,EAAI,KAAK,YAAY,CAAA,CACvC,EACA,MAAOE,GAAQ,CACd,QAAQ,IAAIA,CAAG,CAAA,CAChB,CACF,EAAA,CAACvB,EAAMJ,EAAO,EAAE,CAAC,EACd6B,EAAQC,GAAW,CACnBA,GAAU,cACZnB,EAAS,2BAA2B,EAC3BmB,GAAU,iBACnBnB,EAAS,oCAAoC,EACpCmB,GAAU,QACnBnB,EAAS,4BAA4B,EAC5BmB,GAAU,WACnBnB,EAAS,+BAA+B,EAC/BmB,GAAU,UACnBnB,EAAS,wCAAwCE,EAAM,CAAC,CAAC,eAAe,EAExEF,EAAS,0BAA0B,CACrC,EAGF,SAASe,EAA8BK,EAAM,CACxCf,EAAA,IAAI,OAAQe,CAAI,EAChBf,EAAA,IAAI,WAAYe,EAAK,IAAI,EACzBf,EAAA,IAAI,OAAQe,EAAK,IAAI,EACxBvB,EAAa,CAAE,KAAMuB,EAAK,IAAM,CAAA,EAChCtB,EAAQ,CAAE,KAAMsB,EAAK,IAAM,CAAA,EAC3B,WAAW,IAAM,CACfzB,EAAW,EAAK,EACXuB,GAAAE,GAAA,YAAAA,EAAM,YAAYA,GAAA,YAAAA,EAAM,KAAI,GAChC,IAAI,CACT,CAKA,GAHAC,EAAAA,UAAU,IAAM,CACAV,GAAA,EACb,CAACA,CAAa,CAAC,EACdjB,EAAS,OAAQ4B,MAAAC,EAAA,CAAO,YAAY,sBAAuB,CAAA,CACjE"}