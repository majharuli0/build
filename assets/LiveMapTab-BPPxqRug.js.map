{"version":3,"file":"LiveMapTab-BPPxqRug.js","sources":["../../src/Pages/Elderlies/Components/TabContents/LiveMap/LiveMapTab.jsx"],"sourcesContent":["import React, { useState, useContext } from \"react\";\r\nimport Room1 from \"@/Components/RoomMap/RoomMap3\";\r\nimport Room2 from \"@/Components/RoomMap/RoomMap4\";\r\nimport { CustomContext } from \"@/Context/UseCustomContext\";\r\nimport useWebSocket from \"@/hook/useWebSoket\";\r\nimport { decodePosition } from \"@/utils/helper\";\r\nimport { FaUser } from \"react-icons/fa6\";\r\nimport { Tooltip } from \"antd\";\r\n\r\nexport default function LiveMapTab() {\r\n  const context = useContext(CustomContext);\r\n  const { elderlyDetails } = context || {};\r\n  const deviceCode = elderlyDetails?.deviceId; // May be \"992300030457\" or \"992300030457,E598A28D0873\"\r\n\r\n  // Store positions as an object mapping device codes to their position data\r\n  const [positions, setPositions] = useState({});\r\n\r\n  // Decode position data\r\n  function handleDecode(code) {\r\n    return decodePosition(code);\r\n  }\r\n\r\n  // WebSocket handler to update positions for any matching device code\r\n  useWebSocket({\r\n    onMessage: (data) => {\r\n      const payload = JSON.parse(data?.message)?.payload;\r\n      if (payload?.deviceCode && payload?.position) {\r\n        const decodedData = handleDecode(payload.position);\r\n        setPositions((prev) => ({\r\n          ...prev,\r\n          [payload.deviceCode]: decodedData,\r\n        }));\r\n      }\r\n    },\r\n    dependencies: [deviceCode],\r\n  });\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4 mt-6 overflow-hidden\">\r\n      {elderlyDetails?.rooms &&\r\n        elderlyDetails?.rooms\r\n          ?.filter((room) => room.device_no)\r\n          .map((room, indx) => {\r\n            // Split room.device_no into an array of device codes\r\n            const roomDeviceCodes =\r\n              room.device_no?.split(\",\").map((code) => code.trim()) || [];\r\n            // Combine position data for all device codes in this room\r\n            const roomPositions = roomDeviceCodes.flatMap(\r\n              (code) => positions[code] || []\r\n            );\r\n\r\n            return (\r\n              <div\r\n                key={indx}\r\n                className=\"flex flex-col gap-4 bg-white rounded-2xl p-4 h-[700px]\"\r\n              >\r\n                <h1 className=\"text-2xl font-bold\">{room?.name}</h1>\r\n                <div className=\"flex h-full\">\r\n                  <div className=\"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit z-50\">\r\n                    {roomPositions.length > 0 && (\r\n                      <Tooltip\r\n                        color=\"white\"\r\n                        overlayInnerStyle={{ color: \"black\", padding: \"10px\" }}\r\n                        title={roomPositions.map((person, idx) => (\r\n                          <div\r\n                            key={idx}\r\n                            className=\"flex items-center gap-2 mb-2\"\r\n                          >\r\n                            <div\r\n                              style={{ backgroundColor: person?.color }}\r\n                              className=\"p-2 rounded-full\"\r\n                            >\r\n                              <FaUser size={14} color=\"white\" />\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"text-sm m-0\">{person?.posture}</p>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      >\r\n                        <div className=\"flex -space-x-4 cursor-pointer\">\r\n                          {roomPositions.map((person, idx) => (\r\n                            <div\r\n                              key={idx}\r\n                              style={{ backgroundColor: person?.color }}\r\n                              className=\"p-1 rounded-full border-2 border-white\"\r\n                            >\r\n                              <FaUser size={16} color=\"white\" />\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </Tooltip>\r\n                    )}\r\n                    {roomPositions.length === 0 && (\r\n                      <div className=\"bg-primary p-1 rounded-full border-2 border-white\">\r\n                        <FaUser size={16} color=\"white\" />\r\n                      </div>\r\n                    )}\r\n                    <span className=\"font-bold text-lg\">\r\n                      {roomPositions.length}\r\n                    </span>\r\n                  </div>\r\n                  <div id=\"roomMap\" className=\"w-full h-full scale-[1.2] mt-14\">\r\n                    {room?.mount_type === 2 ? (\r\n                      <Room2 roomInfo={room} position={roomPositions} />\r\n                    ) : (\r\n                      <Room1 roomInfo={room} position={roomPositions} />\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["LiveMapTab","context","useContext","CustomContext","elderlyDetails","deviceCode","positions","setPositions","useState","handleDecode","code","decodePosition","useWebSocket","data","payload","_a","decodedData","prev","room","indx","roomPositions","jsxs","jsx","Tooltip","person","idx","FaUser","Room2","Room1"],"mappings":"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"}