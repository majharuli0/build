import{r as i,j as e,fo as R}from"./index-d_7D8AC7.js";import p from"./LiveRateChart-65SMVd7W.js";import{C as N}from"./UseCustomContext-BYJWDH5N.js";import{d as y}from"./helper-C8eLjNk9.js";import"./index-BJ-cyjPg.js";function _(){var f,h,u;const{elderlyDetails:c,sleepData:s}=i.useContext(N),l=c==null?void 0:c.deviceId,[v,d]=i.useState({time:[],heartRate:[],breathRate:[]}),[o,x]=i.useState(null),[m,b]=i.useState(Date.now()),j=t=>{const r=y(t);x(r),b(Date.now())};return i.useEffect(()=>{const t=setInterval(()=>{if(Date.now()-m>5e3)x(null),d([]);else if(o){const a=new Date().toLocaleTimeString();d(n=>({time:[...n.time,a].slice(-30),heartRate:[...n.heartRate,o.heartRateValue].slice(-30),breathRate:[...n.breathRate,o.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(t)},[o,m]),i.useEffect(()=>{const t=new WebSocket("ws://localhost:8080");return t.onopen=()=>{console.log("Connected to WebSocket server"),t.send(JSON.stringify({uid:l}))},t.onmessage=r=>{const a=JSON.parse(r==null?void 0:r.data).payload;(a==null?void 0:a.deviceCode)===l&&(a!=null&&a.heartbreath)&&j(a.heartbreath)},t.onerror=r=>{console.error("WebSocket error:",r)},t.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>t.close()},[l]),e.jsxs("div",{className:"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"Live Breath Rate"}),e.jsx("div",{id:"LiveRate",className:"flex flex-col gap-1 pl-3 mb-2",children:e.jsxs("div",{className:"text-4xl font-bold flex items-center gap-2",style:{color:"#FFA54D"},children:[(o==null?void 0:o.breathingValue)??"--"," ",e.jsx("span",{className:"text-secondary/40",children:"BPM"}),e.jsx(R,{color:"#FFA54D",size:24})]})}),e.jsx(p,{data:v,color:"#FFA54D",type:"breathRate"}),e.jsx("div",{id:"footer",children:e.jsxs("div",{className:"flex justify-evenly items-center",children:[e.jsxs("div",{id:"avgRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsx("div",{className:"text-3xl text-primary font-bold",children:(f=s==null?void 0:s.breath_rate_vo)==null?void 0:f.avg}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Avg. Rate"})]}),e.jsxs("div",{id:"minRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(h=s==null?void 0:s.breath_rate_vo)==null?void 0:h.min]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Min Rate"})]}),e.jsxs("div",{id:"maxRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(u=s==null?void 0:s.breath_rate_vo)==null?void 0:u.max]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Max Rate"})]})]})})]})}export{_ as default};
