import{r as s,O as H,j as e,cV as ce,ao as xe,C as v,g as S,N as U,cW as ue,V as w,q as Y,aA as pe,T as I,D as fe,a8 as he,cX as j,cY as me}from"./index-Zs39X0Dw.js";import{m as q}from"./Dashboard-Dg1q77y7.js";import{W as ge}from"./WeeklyMonthlyPicker-Cf40OLu7.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},f=new r.Error().stack;f&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[f]="64f3a4d6-d3d2-40c1-bf97-fb7676f741b1",r._sentryDebugIdIdentifier="sentry-dbid-64f3a4d6-d3d2-40c1-bf97-fb7676f741b1")}catch{}function be({data:r}){const[f,i]=s.useState(!1),t=s.useContext(H),[a,l]=s.useState([]),[d,p]=s.useState([]),[h,u]=s.useState(!1),[y,_]=s.useState("");function m(){u(!0),w({role:"installer"}).then(o=>{o&&(l(o==null?void 0:o.data),u(!1))})}function D(o){p(o)}function P(){console.log("cliekd"),u(!0),ue(r==null?void 0:r._id,{installer_id:d}).then(o=>{o&&(console.log(o),i(!1),u(!1),t.getlist())}).finally(()=>{i(!1)})}function A(){m()}return e.jsxs("div",{children:[e.jsxs("span",{onClick:()=>{i(!0),A()},className:"flex items-center gap-2 text-blue-500 font-baloo font-semibold",children:[e.jsx(ce,{size:18})," Assign Installer"]}),e.jsx(xe,{modalOPen:f,setModalOpen:i,onCancel:()=>i(!1),title:"Assign Installer",isBottomButtomShow:!1,children:e.jsx(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsxs("div",{id:"addSalesAgent",className:"flex gap-4 mb-5  justify-between items-center",children:[e.jsx(S,{mode:"single",maxTagCount:"responsive",optionFontSize:18,dropdownMatchSelectWidth:!1,optionHeight:50,placeholder:"Search Installer",value:d,onChange:D,onSearch:o=>_(o),style:{width:"100%",borderRadius:"13px"},filterOption:!1,className:"agentSelection h-[40px]",children:a==null?void 0:a.map(o=>e.jsxs(Option,{value:o._id,children:[o.name," ",o.last_name]},o._id))}),e.jsx(U,{onClick:()=>P(),children:"Assign Installer"})]})})})]})}function ye(r){return[...Y.get("user").role!=="office"?[{title:"Office Identifier",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.office_name})})}]:[{title:"Action",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap ",children:t.installation_date===null?e.jsx("span",{className:"",children:"N/A"}):t.installer_id?e.jsx("span",{className:"italic",children:"Assigned"}):e.jsx(be,{data:t})})})},{title:"Installer Status",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.installation_date===null?"N/A":t.installer_id?"Assigned":"Not Assigned"})})},{title:"Report",render:t=>e.jsx("div",{className:"flex justify-center",children:e.jsx(pe,{report:t})})},{title:"Installation Status",render:t=>{let a;switch(t.installation_status){case"not_started":a="bg-red-500";break;case"pending":a="bg-yellow-500";break;case"completed":a="bg-[#1EB564]";break;default:a="bg-black"}const l={not_started:"Not Started",pending:"Pending",completed:"Completed"};return e.jsx("button",{children:e.jsx("span",{className:`text-[14px] xl:text-base capitalize font-normal text-white p-2 px-3 py-1 ${t.installer_id?a:"bg-transparent !text-black"} rounded-lg`,children:t.installer_id?l[t.installation_status]||"Unknown":"N/A"})})}}],{title:"Agent Name (ID Number)",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:[t.agent_name," (",t.agent_unique_id,")"]})})},{title:"Date of Sales",render:t=>{const a=new Date(t.created_at).toLocaleDateString("en-CA");return e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:a})})}},{title:"Preferred Installation Date",render:t=>{const a=t.installation_date?new Date(t.installation_date).toLocaleDateString("en-CA"):"--";return e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:a})})}},{title:"Customer Name",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t==null?void 0:t.user_name})})},{title:"Customer Phone Number",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t==null?void 0:t.user_phone})})},{title:"Customer Email",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t==null?void 0:t.user_email})})},{title:"Location",render:t=>{var a,l,d,p,h,u;return e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:[(a=t.address)==null?void 0:a.line1,","," ",(l=t.address)!=null&&l.line2?((d=t.address)==null?void 0:d.line2)+", ":"",","," ",(p=t.address)==null?void 0:p.city,", ",(h=t.address)==null?void 0:h.state,","," ",t.address?t.address.postal_code:" ",","," ",(u=t.address)==null?void 0:u.country]})})}},{title:"Product Name",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary flex  gap-2",children:t.products.filter((a,l,d)=>{const p=a.type==="Seenyor Kit"&&d.findIndex(h=>h.type==="Seenyor Kit")===l;return!/^AI Sensor/.test(a.type)&&(a.type!=="Seenyor Kit"||p)}).map((a,l)=>{const d=a.type==="Seenyor Kit"?"blue":a.type==="Installation"?"orange":"default";return e.jsx(I,{color:d,children:a.type==="Seenyor Kit"?"Package":a.type},l)})})})},{title:"Product Price",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary",children:["$",t.products.filter(a=>["Seenyor Kit","Installation","AI Monitoring"].includes(a.type)).reduce((a,l)=>a+l.price,0).toFixed(2)]})})},{title:"Addon Name",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary flex gap-2",children:t.products.filter(a=>!["Seenyor Kit","Installation","AI Monitoring"].includes(a.type)).map((a,l)=>e.jsx(I,{children:a.type},l)).length===0?e.jsx("span",{children:"--"}):t.products.filter(a=>!["Seenyor Kit","Installation","AI Monitoring"].includes(a.type)).map((a,l)=>e.jsx(I,{children:a.type},l))})})},{title:"Addon Price",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.products.map((a,l)=>["Seenyor Kit","Installation","AI Monitoring"].includes(a.type)?null:e.jsxs("span",{children:["$",a.price.toFixed(2)]},l)).filter(Boolean).length===0?e.jsx("span",{children:"--"}):t.products.map((a,l)=>["Seenyor Kit","Installation","AI Monitoring"].includes(a.type)?null:e.jsxs("span",{children:["$",a.price.toFixed(2)]},l))})})},{title:"Total Price",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:["$",t.total.toFixed(2)]})})},{title:"Payment Status",dataIndex:"payment_status",key:"payment_status",filters:[{text:"Completed",value:"completed"},{text:"Pending",value:"pending"},{text:"Cancelled",value:"cancelled"}],filterMultiple:!0,onFilter:(t,a)=>a.payment_status.includes(t),render:(t,a)=>{let l="";switch(t){case"pending":l="orange";break;case"cancelled":l="red";break;case"completed":l="green";break;default:l="black"}return e.jsx("span",{style:{backgroundColor:l,color:"white",padding:"4px 8px",borderRadius:"4px",fontWeight:500,textTransform:"capitalize"},children:t})}}]}const{RangePicker:je}=fe,Ae=()=>{var K;const[r,f]=s.useState(null),[i,t]=s.useState("all"),[a,l]=s.useState(Y.get("user")),[d,p]=s.useState([]),[h,u]=s.useState([]),[y,_]=s.useState(null),[m,D]=s.useState([]),[P,A]=s.useState([]),[o,M]=s.useState({}),[Q,L]=s.useState(!1),[C,G]=s.useState(1),[F,R]=s.useState(null),[N,O]=s.useState(null),X=ye(),[J,T]=s.useState(null),[Z,E]=s.useState(null),ee={not_started:"Not Started",pending:"Pending",completed:"Completed"},te=async()=>{try{const n=await ae(i==="all"?null:i,r==="all"?null:r);if(!n||n.length===0)throw new Error("No data available to download");const g=n.map((x,de)=>{var V;const z=new Date(x.created_at);return{"No.":de+1,"Office Name":x.office_name,"Agent ID":x.agent_unique_id,"Agent Name":x.agent_name,"Sale Date":z.toLocaleDateString("en-CA"),"Sale Time":z.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),"Installation Status":x.installer_id?ee[x.installation_status]||"Unknown":"N/A","Preferred Installation Date":x.installation_date?new Date(x.installation_date).toLocaleDateString("en-CA"):"--",Products:x.products.map((b,$)=>`${$+1}. ${b.name}`).join(""),"Extra Product":x.products.map((b,$)=>{if(b.type!=="Seenyor Kit"&&b.type!=="Installation"&&b.type!=="AI Monitoring")return b.type}).join(""),"Current Sale Status":x.saleStatus,"City Location":((V=x.address)==null?void 0:V.city)||"N/A"}}),c=j.utils.json_to_sheet(g),W=j.utils.book_new();j.utils.book_append_sheet(W,c,"Sales Report");const oe=j.write(W,{bookType:"xlsx",type:"array"}),re=new Blob([oe],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ie=`Sales_Report_${new Date().toISOString().split("T")[0]}.xlsx`;me.saveAs(re,ie)}catch(n){console.error("Error downloading the sales report:",n)}},ae=(n,g)=>q({...o,agent_id:n,payment_status:g,from_date:F,to_date:N,limit:1e5}).then(c=>(A(c),c.data)).catch(c=>{throw console.log(c),c}),k=s.useCallback((n,g)=>{L(!0),q({...C,...o,agent_id:n,payment_status:g,from_date:F,to_date:N}).then(c=>{console.log(c),D(c),L(!1)}).catch(c=>{console.log(c)})},[r,i,o.office_id,N,C]);function ne(){w({role:"office"}).then(n=>{p(n.data)}).catch(n=>{console.log(n)})}function B(){w({...o,role:"sales_agent"}).then(n=>{u(n.data)}).catch(n=>{console.log(n)})}s.useEffect(()=>{ne(),B()},[]),s.useEffect(()=>{B()},[o]),s.useEffect(()=>{k(i==="all"?null:i,r==="all"?null:r)},[k]);function le(n){T(n),R(n==null?void 0:n.start),O(n==null?void 0:n.end)}function se(n){R(n[0]),O(n[1])}return s.useEffect(()=>{if(y)if(y==="all"){if(o.office_id){const n={...o};delete n.office_id,M(n)}}else M(n=>({...n,office_id:y})),t("all")},[y]),e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"Distributor_Dash_Top",className:"flex justify-between w-full mb-5 flex-wrap gap-5 pt-[30px]",children:e.jsxs(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:[a.role=="office"?e.jsx("div",{className:"p-2 px-4 rounded-lg text-[36px] font-bold  text-primary",children:a.office}):a.role=="sales_agent"?null:e.jsx(S,{showSearch:!0,optionFilterProp:"label",onChange:n=>_(n.value),defaultValue:"all",dropdownMatchSelectWidth:!1,size:"large",className:"custom-select",labelInValue:!0,options:[{value:"all",label:e.jsxs(e.Fragment,{children:["All Offices"," ",e.jsx("span",{className:"highlighted-number",children:d.length})]})},...d.map(n=>({value:n._id,label:n.name}))]}),e.jsxs("div",{id:"DatePickers",className:"flex gap-4 items-center",children:[e.jsx(ge,{placeholder:"Weekly/Monthly",style:{width:"140px",borderRadius:"10px"},value:J,handleChnage:n=>{le(n),E(null)}}),e.jsx(je,{showTime:!1,style:{width:"200px",borderRadius:"10px"},size:"large",value:Z,placeholder:["Pick Date Range (Start)","End"],format:"YYYY-MM-DD",onChange:(n,g)=>{se(g),T(null),E(n)}}),e.jsx(U,{disabled:((K=m==null?void 0:m.data)==null?void 0:K.length)<=0,onClick:te,type:"text",children:"Download"})]})]})}),e.jsxs("div",{id:"dealsDetails",className:" p-[25px] rounded-2xl  bg-white w-full mb-[20px]",children:[e.jsxs("div",{id:"DealsHeader",className:"w-full flex justify-between mb-8",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"All Deal"}),a.role=="sales_agent"?null:e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsxs(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:[e.jsx(S,{optionFilterProp:"label",onChange:n=>f(n.value),defaultValue:"all",size:"large",labelInValue:!0,dropdownMatchSelectWidth:!1,className:"w-[200px]",options:[{value:"all",label:"All Sales"},{value:"completed",label:"Completed"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]}),e.jsx(S,{showSearch:!0,optionFilterProp:"label",onChange:n=>t(n.value),defaultValue:"all",size:"large",value:i,labelInValue:!0,className:"w-[200px]",dropdownMatchSelectWidth:!1,options:[{value:"all",label:"All Agents"},...h.map(n=>({value:n._id,label:n.name+" "+n.last_name}))]})]})})]}),e.jsx(H.Provider,{value:{getlist:k,total:m.total||[],page:C,SetPage:G},children:e.jsx(he,{loading:Q,tableData:m.data,columns:X})})]})]})};export{Ae as default};
//# sourceMappingURL=index-CYbZi9ty.js.map
