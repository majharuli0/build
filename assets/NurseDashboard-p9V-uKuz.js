import{r as s,j as e,bq as q,u as oe,d as B,br as ce,S as se,bs as de,B as O,I as fe,a6 as W,aN as U}from"./index-DKKIrJkr.js";import{a as ue}from"./index-DHZ_F7Jt.js";import{u as Q,A as he,a as xe}from"./alertsOverview-DjIVJdxL.js";import{g as J,a as pe}from"./elderlySupport-FEHzjQ_y.js";import{d as me,a as y,b as ge,g as le}from"./helper-C_2_l4sE.js";import{g as je}from"./elderly-CY2dm5Zo.js";import{S as ve}from"./slick-theme-DdSHDC2N.js";import{u as be,D as we,a as Ce}from"./RoomMap4-BsObs0SS.js";import{A as ye}from"./AlertCloseModal-BPzpbo7V.js";import{M as Ne,u as re,P as Se,a as Ae,L as _e,m as E}from"./proxy-DtX5xMDP.js";import"./index-p85IepaV.js";import"./line-CS4l8Wmc.js";import"./WeeklyMonthlyPicker-DmGP_U48.js";import{C as De}from"./CreateAndEditModal-alIqIcOu.js";import{S as ne}from"./index-BTSnPdwc.js";import{R as Ee}from"./AimOutlined-BeYFl5rF.js";import{R as Me}from"./HomeOutlined-D8q9lxSm.js";import"./AlertName-Sbt1Guwy.js";import"./ActionManu-VEOH587v.js";import"./index-BIADAzPj.js";import"./index-B3eKfCJC.js";import"./index-BkY9Nf-8.js";import"./SuccessModal-DKyhvgYD.js";import"./UseCustomContext-aFWT3z3w.js";import"./LargeTextViewerModal-DAHquWND.js";import"./SwapRightOutlined-CCH1E9zQ.js";import"./weekOfYear-CVPDmtEy.js";import"./index-nnJyr53O.js";import"./weekday-B__MiVbj.js";import"./index-C-9YgO_Q.js";import"./leaflet-src-BCT8uL1J.js";/* empty css                */import"./InfoCircleOutlined-D2WTo80u.js";import"./index-79pJl7D6.js";class ke extends s.Component{getSnapshotBeforeUpdate(h){const r=this.props.childRef.current;if(r&&h.isPresent&&!this.props.isPresent){const t=this.props.sizeRef.current;t.height=r.offsetHeight||0,t.width=r.offsetWidth||0,t.top=r.offsetTop,t.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Fe({children:d,isPresent:h}){const r=s.useId(),t=s.useRef(null),w=s.useRef({width:0,height:0,top:0,left:0}),{nonce:n}=s.useContext(Ne);return s.useInsertionEffect(()=>{const{width:f,height:a,top:g,left:N}=w.current;if(h||!t.current||!f||!a)return;t.current.dataset.motionPopId=r;const j=document.createElement("style");return n&&(j.nonce=n),document.head.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${a}px !important;
            top: ${g}px !important;
            left: ${N}px !important;
          }
        `),()=>{document.head.removeChild(j)}},[h]),e.jsx(ke,{isPresent:h,childRef:t,sizeRef:w,children:s.cloneElement(d,{ref:t})})}const Re=({children:d,initial:h,isPresent:r,onExitComplete:t,custom:w,presenceAffectsLayout:n,mode:f})=>{const a=re(Le),g=s.useId(),N=s.useCallback(x=>{a.set(x,!0);for(const v of a.values())if(!v)return;t&&t()},[a,t]),j=s.useMemo(()=>({id:g,initial:h,isPresent:r,custom:w,onExitComplete:N,register:x=>(a.set(x,!1),()=>a.delete(x))}),n?[Math.random(),N]:[r,N]);return s.useMemo(()=>{a.forEach((x,v)=>a.set(v,!1))},[r]),s.useEffect(()=>{!r&&!a.size&&t&&t()},[r]),f==="popLayout"&&(d=e.jsx(Fe,{isPresent:r,children:d})),e.jsx(Se.Provider,{value:j,children:d})};function Le(){return new Map}const $=d=>d.key||"";function ae(d){const h=[];return s.Children.forEach(d,r=>{s.isValidElement(r)&&h.push(r)}),h}const Pe=({children:d,exitBeforeEnter:h,custom:r,initial:t=!0,onExitComplete:w,presenceAffectsLayout:n=!0,mode:f="sync"})=>{const a=s.useMemo(()=>ae(d),[d]),g=a.map($),N=s.useRef(!0),j=s.useRef(a),x=re(()=>new Map),[v,k]=s.useState(a),[A,_]=s.useState(a);Ae(()=>{N.current=!1,j.current=a;for(let b=0;b<A.length;b++){const p=$(A[b]);g.includes(p)?x.delete(p):x.get(p)!==!0&&x.set(p,!1)}},[A,g.length,g.join("-")]);const m=[];if(a!==v){let b=[...a];for(let p=0;p<A.length;p++){const C=A[p],F=$(C);g.includes(F)||(b.splice(p,0,C),m.push(C))}f==="wait"&&m.length&&(b=m),_(ae(b)),k(a);return}const{forceRender:M}=s.useContext(_e);return e.jsx(e.Fragment,{children:A.map(b=>{const p=$(b),C=a===A||g.includes(p),F=()=>{if(x.has(p))x.set(p,!0);else return;let S=!0;x.forEach(R=>{R||(S=!1)}),S&&(M==null||M(),_(j.current),w&&w())};return e.jsx(Re,{isPresent:C,initial:!N.current||t?void 0:!1,custom:C?void 0:r,presenceAffectsLayout:n,mode:f,onExitComplete:C?void 0:F,children:b},p)})})};function Ie({rooms:d=[]}){const[h,r]=s.useState({}),t={dots:d.length>=2,infinite:d.length>2,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:n=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsxs("ul",{id:"dots",style:{margin:"0px"},children:[" ",n," "]})})},w=s.useCallback((n,f)=>{const a=me(n);r(g=>({...g,[f]:a}))},[]);return be({onMessage:n=>{var a;const f=(a=JSON.parse(n==null?void 0:n.message))==null?void 0:a.payload;console.log(f),f!=null&&f.position&&w(f.position,f.deviceCode)},dependencies:[]}),e.jsxs(e.Fragment,{children:[d.length>0&&e.jsx("div",{id:"rooms",className:"w-full mb-2 transition-all duration-300 h-full",children:e.jsx(ve,{...t,className:"w-full transition-all duration-300 h-full ",children:d.map((n,f)=>e.jsxs("div",{className:"px-2 overflow-hidden transition-all duration-300 w-full h-[355px] ",children:[e.jsxs("div",{id:"roomNmaeAndStatus",className:"flex items-center gap-2 w-fit bg-white pr-4 py-1.5 border border-gray-200 p-2 rounded-full absolute top-2 left-2",children:[e.jsx("div",{id:"dot",className:"size-3 rounded-full",style:{backgroundColor:(n==null?void 0:n.is_device_bind)===!0?"green":"red"}}),e.jsx("p",{children:n==null?void 0:n.name})]}),(n==null?void 0:n.is_device_bind)&&(n==null?void 0:n.mount_type)===1&&e.jsx(we,{roomInfo:n,position:h[n.device_no]}),(n==null?void 0:n.is_device_bind)&&(n==null?void 0:n.mount_type)===2&&e.jsx(Ce,{roomInfo:n,position:h[n.device_no]}),!(n!=null&&n.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:"No Device Data Available"})})]},f))})}),d.length===0&&e.jsx(q,{description:"No Room Found "})]})}function Te({refreshAlertList:d}){var K,X,Z,ee;const[h,r]=s.useState([]),[t,w]=s.useState(null),n=oe(),[f,a]=s.useState(!1),[g,N]=s.useState(null),[j,x]=s.useState(!0),[v,k]=s.useState({textColor:"text-white",bodyColor:"text-white",txtc:"#fff",bgc:"#fff"}),[A,_]=s.useState({time:[],heartRate:[],breathRate:[]}),[m,M]=s.useState(null),[b,p]=s.useState(Date.now()),[C,F]=s.useState([]),[S,R]=s.useState(!1),[P,I]=s.useState(1);s.useState(!0);const T=s.useRef(null),V=s.useCallback(()=>{x(!0),je().then(l=>{r(l.data),x(!1)}).catch(l=>{console.log(l),x(!1)})},[]);s.useEffect(()=>{V()},[V]);const Y=s.useCallback(()=>{S||(R(!0),J({to_date:"2024-11-30",from_date:B().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t==null?void 0:t._id,limit:20,page:P}).then(l=>{F(o=>[...o,...l.data]),R(!1)}).catch(l=>{R(!1),console.error(l)}))},[t==null?void 0:t._id,P]);s.useEffect(()=>{t!=null&&t._id&&(F([]),I(1))},[t==null?void 0:t._id]),s.useEffect(()=>{t!=null&&t._id&&Y()},[Y]);const H=()=>{const{scrollTop:l,scrollHeight:o,clientHeight:i}=T.current;l+i>=o-10&&!S&&I(u=>u+1)};s.useEffect(()=>{var l,o,i,u;t&&k({textColor:((l=y(t))==null?void 0:l.label)!=="Critical"?"text-primary":"text-white",bodyColor:((o=y(t))==null?void 0:o.label)!=="Critical"?"text-primary":"text-white",txtc:((i=y(t))==null?void 0:i.label)!=="Critical"?"#fff":"#000",bgc:((u=y(t))==null?void 0:u.label)!=="Critical"?"#fff":"#000"})},[t]),s.useEffect(()=>{var o;const l=((o=t==null?void 0:t.rooms)==null?void 0:o.length)>0?t.rooms.filter(i=>i.device_no).map(i=>i.device_no).join(", "):"";l&&t&&ce({uid:l,messageType:["1","2","3","4"],topics:{pub:[l]}}).then(i=>{console.log(i)}).catch(i=>{console.log(i)})},[t]);const z=l=>{const o=ge(l);M(o),p(Date.now())};s.useEffect(()=>{const l=setInterval(()=>{if(Date.now()-b>5e3)M(null),_({time:[],heartRate:[],breathRate:[]});else if(m){const u=new Date().toLocaleTimeString();_(D=>({time:[...D.time,u].slice(-30),heartRate:[...D.heartRate,m.heartRateValue].slice(-30),breathRate:[...D.breathRate,m.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(l)},[m,b]),s.useEffect(()=>{var i;if(!t)return;const l=((i=t==null?void 0:t.rooms)==null?void 0:i.length)>0?t.rooms.filter(u=>u.device_no).map(u=>u.device_no).join(", "):"",o=new WebSocket("wss://live.elderlycareplatform.com/ws/");return o.onopen=()=>{console.log("Connected to WebSocket server")},o.onmessage=u=>{var te;const D=JSON.parse(u==null?void 0:u.data),L=(te=JSON.parse(D==null?void 0:D.message))==null?void 0:te.payload;l.includes(L==null?void 0:L.deviceCode)&&(L!=null&&L.heartbreath)&&z(L.heartbreath)},o.onerror=u=>{console.error("WebSocket error:",u)},o.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>o.close()},[t]);const c=l=>{window.scrollTo(0,0),n(`/supporter/elderlies/elderly-profile/${l==null?void 0:l._id}`)},G=()=>{var o;const l=((o=t==null?void 0:t.rooms)==null?void 0:o.length)>0?t.rooms.filter(i=>i.device_no).map(i=>i.device_no).join(", "):"";l&&t&&de({uid:l,messageType:["1","2","3","4"]}).then(i=>{}).catch(i=>{console.log(i)}),w(null)};return j?e.jsx(e.Fragment,{children:j&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx(se,{})})}):h.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"NurseRoomView",className:"w-full h-full relative",children:[e.jsx("div",{className:"w-full h-full grid grid-cols-10  overflow-auto",children:h==null?void 0:h.map((l,o)=>{var i,u,D;return e.jsx(E.div,{layoutId:l==null?void 0:l._id,onClick:()=>w(l),className:`text-white text-base ${((i=y(l==null?void 0:l.alarms_data[0]))==null?void 0:i.label)==="Critical"?"bg-[#FF1D1D] animate-scaleUpDown1":((u=y(l==null?void 0:l.alarms_data[0]))==null?void 0:u.label)==="Warning"?"bg-[#FF9831] animate-scaleUpDown2":((D=y(l==null?void 0:l.alarms_data[0]))==null?void 0:D.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6] !text-primary"}  rounded-lg cursor-pointer flex justify-center m-2 items-center font-semibold min-w-[55px] min-h-[65px] h-fit `,children:e.jsx(E.h5,{children:(l==null?void 0:l.room_no)||"--"})},o)})}),e.jsx(Pe,{children:t&&e.jsx(E.div,{className:"absolute inset-0 flex justify-center items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(E.div,{className:"bg-black bg-opacity-50 w-full h-full flex justify-center items-center",onClick:()=>G(),children:e.jsxs(E.div,{className:`${((K=y(t))==null?void 0:K.label)==="Critical"?"bg-[#FF1D1D]":((X=y(t))==null?void 0:X.label)==="Warning"?"bg-[#FF9831]":((Z=y(t))==null?void 0:Z.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6]"} p-4 rounded-xl w-[95%] h-[90%]`,onClick:l=>l.stopPropagation(),layoutId:t==null?void 0:t._id,children:[e.jsxs(E.div,{className:"flex justify-between items-start",children:[" ",e.jsx("div",{className:"w-[65%] flex items-start cursor-pointer bg-white hover:bg-white/75 rounded-xl transition-all duration-300 ease-in",onClick:()=>c(t),children:e.jsxs("div",{id:"elderly-profile",className:"flex items-center w-full  justify-between px-4 ",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col items-start w-full gap-1",children:[e.jsx("h2",{className:`text-xl font-bold ${v.textColor} text-center text-nowrap m-0  leading-none`,children:t==null?void 0:t.name}),e.jsxs("h2",{className:`text-base font-medium ${v.textColor} opacity-80 text-center text-nowrap m-0 leading-none`,children:["Age: ",e.jsx("span",{children:t==null?void 0:t.age})]})]})}),e.jsxs("div",{id:"liveHeartAndBreathRate",className:"flex w-fit py-4 gap-8",children:[e.jsxs("div",{id:"heartRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${v.textColor}  text-nowrap`,children:[(m==null?void 0:m.heartRateValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${v.textColor} opacity-80 text-nowrap`,children:"Heart Rate"})]}),e.jsxs("div",{id:"breathRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${v.textColor}  text-nowrap`,children:[(m==null?void 0:m.breathingValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${v.textColor} opacity-80  text-nowrap`,children:"Breath Rate"})]})]})]})}),e.jsx(E.button,{className:"p-2 bg-black/5  hover:bg-black/10 rounded-full",onClick:()=>G(),children:e.jsx(ue,{size:24,className:v.textColor})})]}),e.jsxs(E.div,{className:"flex h-[80%] items-center mt-2",children:[e.jsx(E.div,{className:"h-full  w-[65%] bg-white rounded-xl flex flex-col items-center justify-center",children:e.jsx(Ie,{rooms:(ee=t==null?void 0:t.rooms)==null?void 0:ee.filter(l=>l.device_no)})}),e.jsxs(E.div,{className:"h-full w-[35%] rounded-xl p-2 border-1 overflow-y-auto overflow-x-hidden gap-2 flex flex-col pt-0",ref:T,onScroll:H,children:[C==null?void 0:C.map((l,o)=>{var i,u;return e.jsxs("div",{className:"flex items-center gap-2 w-[350px] bg-white p-2 rounded-lg cursor-pointer",onClick:()=>{N(l),a(!0)},children:[e.jsx("div",{id:"Icon",children:y(l).icon?e.jsx("img",{src:y(l).icon,alt:"Alert Icon",width:38,height:38,className:"min-w-[38px]"}):null}),e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:(i=y(l))==null?void 0:i.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:(u=y(l))==null?void 0:u.message})]})]},o)}),C.length===0&&!S&&e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(q,{description:"No alerts available to show"})}),S&&e.jsx("div",{className:"h-full w-full flex flex-col justify-center items-center",children:e.jsx(se,{})})]})]})]})})})})]}),e.jsx(ye,{openAlertCloseModal:f,setOpenAlertCloseModal:a,selectedAlert:g,getAlertListDatas:()=>{Y(),d()}})]}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(q,{description:"No room available to show"})})}function jt(){s.useState("Map View");const[d,h]=s.useState(!1);s.useState([]);const r=Q("activeAlert"),t=Q("recentlyClosedAlert"),w=Q("events"),[n,f]=s.useState([]),[a,g]=s.useState([]),[N,j]=s.useState(1),[x,v]=s.useState(1),[k,A]=s.useState([]),[_,m]=s.useState([]),[M,b]=s.useState({}),[p,C]=s.useState({}),[F,S]=s.useState(!0),[R,P]=s.useState(!0),I=s.useCallback(()=>{P(!0),J({to_date:"2024-11-30",from_date:B().format("YYYY-MM-DD"),is_resolved:!1,page:N,...M}).then(c=>{A(c==null?void 0:c.data),P(!1)}).catch(c=>{console.log(c),P(!1)})},[N,M]);s.useEffect(()=>{I()},[I]);const T=s.useCallback(()=>{S(!0),J({to_date:"2024-11-30",from_date:B().format("YYYY-MM-DD"),is_resolved:!0,page:x,...p}).then(c=>{m(c.data),S(!1)}).catch(c=>{console.log(c),S(!1)})},[x,p]);s.useEffect(()=>{T()},[T]);const V=s.useCallback(()=>{pe({to_date:"2024-11-30",from_date:B().format("YYYY-MM-DD"),page:a}).then(c=>{c.data.length>0&&f(c.data)}).catch(c=>{console.log(c)})},[a]);s.useEffect(()=>{V()},[V]);function Y(){I(),T()}function H(c){b(le(c))}function z(c){C(le(c))}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 flex-col pt-8 pb-8",children:[e.jsx("div",{className:"flex item-center justify-between w-full",children:e.jsx(O,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx("div",{children:e.jsx(fe,{className:"rounded-[10px]",size:"large",placeholder:"Search Anything",style:{height:"44px"}})})})}),e.jsx("div",{className:"w-full",children:e.jsx(he,{refreshAlertList:Y})}),e.jsxs("div",{className:"w-full flex flex-col gap-4 lg3:flex-row",children:[e.jsx("div",{className:"w-full p-0",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 h-[650px] flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-5",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Room View"})}),e.jsx("div",{className:"w-full h-full overflow-y-auto rounded-xl",children:e.jsx(Te,{refreshAlertList:Y})})]})}),e.jsx("div",{className:"bg-white w-full lg3:w-[48%] rounded-2xl p-6 h-[650px] overflow-hidden",children:e.jsx(xe,{})})]}),e.jsxs("div",{id:"Active_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Active_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Active Alerts"}),e.jsx("div",{children:e.jsx(O,{theme:{components:{Segmented:{itemSelectedBg:"#252F67",itemSelectedColor:"#fff",fontFamily:"Baloo2"}}},children:e.jsx(ne,{options:ie,onChange:c=>H(c)})})})]}),e.jsx("div",{id:"Active_Alerts_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:k==null?void 0:k.length,page:1,SetPage:j},children:e.jsx(U,{pageSize:6,loading:R,tableData:k,columns:r})})})]}),e.jsxs("div",{id:"Recently_Closed_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Recently_Closed_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Recently Closed Alerts"}),e.jsx("div",{children:e.jsx(O,{theme:{components:{Segmented:{itemSelectedBg:"#252F67",itemSelectedColor:"#fff",fontFamily:"Baloo2"}}},children:e.jsx(ne,{options:ie,onChange:c=>z(c)})})})]}),e.jsx("div",{id:"Recently_Closed_Alerts_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:_==null?void 0:_.length,page:1,SetPage:v},children:e.jsx(U,{pageSize:6,loading:F,tableData:_,columns:t})})})]}),e.jsxs("div",{id:"Events",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsx("div",{id:"Events_Header",className:"w-full flex justify-between",children:e.jsx("h1",{className:"text-[24px] font-bold",children:"Events"})}),e.jsx("div",{id:"Events_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:n==null?void 0:n.length,page:1,SetPage:g,getList:()=>V},children:e.jsx(U,{pageSize:6,tableData:n,columns:w})})})]})]}),e.jsx(De,{modalOpen:d,setModalOpen:h,type:"event"})]})}const vt=[{label:" Map View",value:"Map View",icon:e.jsx(Ee,{})},{label:"Room View",value:"Room View",icon:e.jsx(Me,{})}],ie=[{label:"All Alerts",value:"All Alerts"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Informational",value:"Info"}];export{ie as activeAlertSegmentOptions,vt as alertViewSegmentOptions,jt as default};
