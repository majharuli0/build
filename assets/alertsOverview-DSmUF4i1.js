import{r as n,S as $,u as F,aj as B,ak as P,bl as O,g as p,j as e,b7 as V,bV as G,bW as H,bX as N,bY as D,bZ as J,ap as U,b_ as R,bQ as Q,bR as q,bP as K,bO as X,b5 as Z,K as I,b$ as ee,J as te,E as se,D as le,c0 as ne,aS as re,c1 as ae,C as ie}from"./index-CXxVR1su.js";import{d as oe}from"./debounce-z2hha3Qi.js";import{C as z}from"./Collapse-Nwhb1erK.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},f=new t.Error().stack;f&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[f]="c66cb2b1-88dd-4f2d-af28-63c62ee4939b",t._sentryDebugIdIdentifier="sentry-dbid-c66cb2b1-88dd-4f2d-af28-63c62ee4939b")}catch{}function xe({refreshAlertList:t,isElderlyVisible:f=!1,isAlarmViewBtn:u=!1}){const{setModalDataList:g,modalDataList:h}=n.useContext($),[i,m]=n.useState(!1),[a,s]=n.useState(null),[o,d]=n.useState([]),c=["Critical"],v=F(),{notificationEvent:x}=B(),C=n.useRef(0),y=n.useCallback(async()=>{let l=[],M=30;for(const S of c){if(M<=0)break;const _=O(S);if(_)try{const T=(await P({to_date:"2024-11-30",from_date:p().format("YYYY-MM-DD"),is_resolved:!1,limit:M,..._})).data||[];if(l=[...l,...T],M-=T.length,M<=0)break}catch(k){console.error(`Error fetching ${S} alerts:`,k)}}l.length>C.current&&t(),C.current=l.length,d(l)},[]);n.useEffect(()=>{y()},[y]);const w={dots:o.length>=2,infinite:o.length>2,speed:500,slidesToShow:o.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:l=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:l})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(o.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},A=l=>{window.scrollTo(0,0),v(`/supporter/elderlies/elderly-profile/${l.elderly_id}?tab=overview`)};return n.useEffect(()=>{x&&y()},[x]),e.jsxs(e.Fragment,{children:[o.length>0&&e.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:e.jsx(V,{...w,className:"w-full transition-all duration-300",children:o.map((l,M)=>{var S,_,k,T,E,W;return e.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:e.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((S=N(l))==null?void 0:S.label)==="Critical"?"bg-red-500":((_=N(l))==null?void 0:_.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full flex justify-between items-center`,children:[e.jsx("div",{id:"leftSide",className:"z-50",children:e.jsx("div",{id:"alertItemHeader",children:e.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[e.jsxs("div",{id:"time",className:"flex gap-2",children:[f&&e.jsxs("span",{onClick:()=>A(l),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[e.jsx(G,{size:22,style:{opacity:"0.8"}}),l==null?void 0:l.elderly_name]}),e.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[e.jsx("div",{id:"dot",className:`w-2 h-2 ${((k=N(l))==null?void 0:k.label)==="Critical"?"bg-red-500":((T=N(l))==null?void 0:T.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`}),H(l.created_at)]}),e.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:e.jsx(D,{date:l.created_at})})]}),e.jsxs("div",{id:"alertItemTitleAndDescription",children:[e.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(E=N(l))==null?void 0:E.title}),e.jsx("p",{className:"text-white text-base m-0 leading-none",children:(W=N(l))==null?void 0:W.message})]})]})})}),u?e.jsx("div",{id:"btn",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{s(l),v("/support-nurnt/dashboard/alarm-detail",{state:{alertData:l,id:l==null?void 0:l.elderly_id}})},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"View Alert"})}):e.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{s(l),m(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),e.jsx("img",{src:J,alt:"",className:"absolute top-0 right-0"})]})},M)})})}),e.jsx(U,{openAlertCloseModal:i,setOpenAlertCloseModal:m,selectedAlert:a,getAlertListDatas:()=>{y(),t()}})]})}function ce({data:t={}}){var s,o,d,c,v,x,C,y;const f=F(),[u,g]=n.useState(null),h=n.useRef(null);n.useRef(!1);const[i,m]=n.useState(!1),a=w=>{switch(w){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};return n.useEffect(()=>{var A;const w=(A=t==null?void 0:t.rooms)==null?void 0:A.device_no;return w&&(h.current&&h.current!==w&&R({uid:h.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(l=>console.error(`Error unsubscribing: ${l}`)),Q({uid:w,messageType:["1","2","3","4"],topics:{pub:[w]}}).then(()=>{}).catch(l=>console.error(`Error subscribing: ${l}`)),h.current=w),()=>{h.current&&R({uid:h.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(l=>console.error(`Error during cleanup unsubscribe: ${l}`))}},[t]),e.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[e.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${a((s=N(t))==null?void 0:s.label)}`,children:[e.jsx("div",{className:"loader"}),e.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[e.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:t.room_name}),e.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(o=N(t))==null?void 0:o.title})]}),e.jsx("span",{onClick:()=>{f(`/supporter/elderlies/elderly-profile/${t==null?void 0:t.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[e.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:t.elderly_name}),e.jsx("p",{className:"text-sm text-gray-500 m-0",children:t.address})]}),e.jsx("div",{})]}),e.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[e.jsx(q,{deviceId:(d=t==null?void 0:t.rooms)==null?void 0:d.device_no,children:e.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((c=t==null?void 0:t.rooms)==null?void 0:c.mount_type)===1&&((v=t==null?void 0:t.rooms)==null?void 0:v.is_device_bind)&&e.jsx(K,{roomInfo:t==null?void 0:t.rooms}),((x=t==null?void 0:t.rooms)==null?void 0:x.mount_type)===2&&((C=t==null?void 0:t.rooms)==null?void 0:C.is_device_bind)&&e.jsx(X,{roomInfo:t==null?void 0:t.rooms}),!((y=t==null?void 0:t.rooms)!=null&&y.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:" No Device Data Available"})})]})}),e.jsxs("div",{className:"details-container w-1/3 ",children:[e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:H(t.created_at)}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:e.jsx(D,{date:t.created_at})}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}const{Panel:de}=z;function be(){const{setModalDataList:t,modalDataList:f}=n.useContext($),{notificationEvent:u}=B(),[g,h]=n.useState("All"),[i,m]=n.useState([]),[a,s]=n.useState(null),[o,d]=n.useState(null),[c,v]=n.useState(null),[x,C]=n.useState(!1),[y,w]=n.useState(1),[A,l]=n.useState(!0),M=n.useRef(null),S=n.useCallback(()=>{!A||x||(C(!0),P({to_date:"2024-11-30",from_date:p().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:y,...c}).then(r=>{m(j=>[...j,...r.data]),y>=r.totalPages&&l(!1),C(!1)}).catch(r=>{console.error(r),C(!1)}))},[c,y,A,x]);n.useEffect(()=>{S()},[y,c]),n.useEffect(()=>{if(i.length>0&&!a){const r=i[0];s(r._id),d(r)}},[i,a]);const _=r=>{s(r);const j=i.find(b=>b._id===r);d(j)},k=n.useCallback(oe(()=>{if(!M.current||x||!A)return;const{scrollTop:r,scrollHeight:j,clientHeight:b}=M.current;r+b>=j-50&&w(Y=>Y+1)},200),[x,A]),T=r=>{v(O(r)),w(1),m([]),l(!0)};n.useEffect(()=>{u&&S()},[u]),n.useEffect(()=>{const r=M.current;return r&&r.addEventListener("scroll",k),()=>{r&&r.removeEventListener("scroll",k)}},[k]);const E=n.useMemo(()=>i.reduce((r,j)=>{const b=j.room_name;return r[b]||(r[b]=[]),r[b].push(j),r},{}),[i]),W=r=>{switch(r){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return e.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[e.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[e.jsx(Z,{style:{width:"100%"},block:!0,options:ue,onChange:r=>T(r)}),e.jsxs("div",{ref:M,className:"w-full overflow-auto",style:{height:"440px"},children:[i.length===0&&!x&&e.jsx(I,{description:"No active alerts available"}),i.length>0&&e.jsx(z,{children:Object.entries(E).map(([r,j])=>([...new Set(j.map(b=>{var Y;return(Y=N(b))==null?void 0:Y.label}))],e.jsx(de,{header:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-black font-semibold",children:r})}),children:j&&j.map(b=>{var Y;return e.jsxs("div",{onClick:()=>_(b._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${a===b._id?"bg-gray-100":""}`,children:[e.jsx("span",{className:"text-[14px] font-semibold",children:p(b.created_at).format("hh:mm:ss a")}),e.jsx(ee,{color:W((Y=N(b))==null?void 0:Y.label),size:"large"})]},b._id)})},r)))}),x&&e.jsx("div",{className:"w-full flex justify-center py-4",children:e.jsx(te,{})}),!A&&i.length>0&&e.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),e.jsx("div",{className:"w-[70%] h-full",children:o?e.jsx(ce,{data:o}):e.jsx(I,{description:"Select an alert to view details"})})]})}const ue=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];function he({data:t=[],fromDate:f,toDate:u}){const i=((a,s)=>{const o=[];let d=p(a);for(;d.isBefore(s)||d.isSame(s,"day");)o.push(d.format("YYYY-MM-DD")),d=d.add(1,"day");return o})(f,u).map(a=>{const s=t.filter(c=>c.date===a&&c.alarm_group==="Critical").reduce((c,v)=>c+v.count,0),o=t.filter(c=>c.date===a&&c.alarm_group==="Warning").reduce((c,v)=>c+v.count,0),d=t.filter(c=>c.date===a&&c.alarm_group==="Info").reduce((c,v)=>c+v.count,0);return{day:p(a).format("ddd"),critical:s,warning:o,problem:d}}),m={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:i.map(a=>a.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:i.map(a=>a.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:i.map(a=>a.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:i.map(a=>a.problem),itemStyle:{color:"#800080"},smooth:!0}]};return t.length?e.jsx(se,{option:m,style:{width:"100% !important",height:"100%"}}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(I,{description:"No data available to show"})})}p.extend(ne);p.extend(re);const fe=({placeholder:t,style:f,handleChange:u,value:g})=>{const[h,i]=n.useState("This Week"),m=s=>{const o=p(s).startOf("week").format("YYYY-MM-DD"),d=p(s).endOf("week").format("YYYY-MM-DD");return{week:p(s).week(),start:o,end:d}},a=s=>`Week ${m(s).week}`;return n.useEffect(()=>{if(g){const s=p().week(),o=p(g.start).week();o===s-1?i("Last Week"):i(`Week ${o}`)}else i("This Week")},[g]),e.jsx(le,{style:f,placeholder:h,size:"large",format:a,picker:"week",onChange:s=>{if(s){const o=m(s);u(o)}else u(""),i("This Week")}})},L=t=>{const f=["Critical","Info","Warning"],u=["Living Room","Kitchen","Bedroom","Bathroom"],g=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],h=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],i=["Medication Taken","Medication Not Taken","Medication Reminder"],m=["Wheelchair","Crutches","Cane","None"],a=["Yes","No"],s=["Yes","No"],o=["Yes","No"],d=["1","4","2","No"],c=["True","False"];return Array.from({length:t},(v,x)=>({_id:x+1,alertType:f[Math.floor(Math.random()*f.length)],elderlyName:g[Math.floor(Math.random()*g.length)],alertName:h[Math.floor(Math.random()*h.length)],roomId:String(x+1),roomName:u[Math.floor(Math.random()*u.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${h[Math.floor(Math.random()*h.length)]} in the ${u[Math.floor(Math.random()*u.length)]}`,status:"Active",isAlert:c[Math.floor(Math.random()*c.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:g[Math.floor(Math.random()*g.length)],eventName:i[Math.floor(Math.random()*i.length)],disabilityType:m[Math.floor(Math.random()*m.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:a[Math.floor(Math.random()*a.length)],diseases:s[Math.floor(Math.random()*s.length)],medications:o[Math.floor(Math.random()*o.length)],activeAlert:d[Math.floor(Math.random()*d.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};L(14);L(20);L(20);L(20);L(20);function ve(){const[t,f]=n.useState(p().subtract(6,"days").format("YYYY-MM-DD")),[u,g]=n.useState(p().format("YYYY-MM-DD")),[h,i]=n.useState([]),m=n.useCallback(()=>{ae({from_date:u,to_date:t}).then(s=>{i(s==null?void 0:s.data)}).catch(s=>{console.log(s)})},[u]);n.useEffect(()=>{m()},[m]);function a(s){s?(f(s.start),g(s.end)):(f(p().subtract(6,"days").format("YYYY-MM-DD")),g(p().format("YYYY-MM-DD")))}return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Overview"}),e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsx(ie,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx(fe,{style:{height:"fit-content"},handleChange:s=>a(s)})})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsx(he,{data:h,fromDate:t,toDate:u})})]})}export{xe as A,be as R,ve as a};
//# sourceMappingURL=alertsOverview-DSmUF4i1.js.map
