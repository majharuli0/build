import{j as e,E as G,hu as le,bA as ie,r as T,hv as ce,i as g,hw as de,hx as fe,hy as me,hz as he,hA as ue,hB as xe,c8 as te,hC as pe,hD as ge,hE as ve,h7 as be,hF as ye,hG as De,hH as we,hI as je,hJ as Se,hK as Ye,hL as Me,hM as Ae,hN as Ne,hi as U,hO as Le,h9 as Te}from"./index-DJjw0XFZ.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},v=new n.Error().stack;v&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[v]="1b535547-a19e-4693-9611-8a261a1cb1f8",n._sentryDebugIdIdentifier="sentry-dbid-1b535547-a19e-4693-9611-8a261a1cb1f8")}catch{}function Pe({width:n="100%",height:v=400,data:S=[]}){const s=()=>{if(!S||S.length===0)return m();const a=new Map;S.forEach(l=>{const y=new Date(l.year,l.month-1,l.day),k=y.toISOString().split("T")[0],N=l.event==="5"?"Device Offline":"Fall Alert";a.has(k)||a.set(k,{date:y,timestamp:y.getTime(),dateFormatted:A(y,S),tooltipDate:b(y),"Fall Alert":0,"Device Offline":0});const H=a.get(k);H[N]+=l.count||0});const c=Array.from(a.values()).sort((l,y)=>l.timestamp-y.timestamp),Y=c.map(l=>l.dateFormatted),M=c.map(l=>l.tooltipDate),r=c.map(l=>l["Fall Alert"]),w=c.map(l=>l["Device Offline"]);return{dates:Y,tooltipDates:M,fallAlertData:r,deviceOfflineData:w}},A=(a,c)=>{if(!c||c.length===0)return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});const Y=c.map(y=>new Date(y.year,y.month-1,y.day)),M=new Date(Math.min(...Y)),r=new Date(Math.max(...Y)),w=Math.abs(r-M);return Math.ceil(w/(1e3*60*60*24))<=60?a.toLocaleDateString("en-US",{month:"short",day:"numeric"}):a.toLocaleDateString("en-US",{month:"short",year:"2-digit"})},b=a=>a.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),m=()=>{const a=[],c=[],Y=[],M=[],r=new Date;for(let w=9;w>=0;w--){const l=new Date(r);l.setDate(r.getDate()-w),a.push(l.toLocaleDateString("en-US",{month:"short",day:"numeric"})),c.push(l.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),Y.push(Math.floor(0)),M.push(Math.floor(0))}return{dates:a,tooltipDates:c,fallAlertData:Y,deviceOfflineData:M}},{dates:t,tooltipDates:x,fallAlertData:p,deviceOfflineData:O}=s(),E=a=>a<=10?0:a<=20?1:a<=40?2:a<=60?3:Math.floor(a/12),I=p.reduce((a,c)=>a+c,0),_=O.reduce((a,c)=>a+c,0),h={tooltip:{trigger:"axis",backgroundColor:"transparent",borderWidth:0,className:"!shadow-none",axisPointer:{type:"line",lineStyle:{color:"rgb(var(--ms-text-color)/0.2)",width:1}},formatter:a=>{const c=a[0].dataIndex,Y=x[c],M=a.find(w=>w.seriesName==="Fall Alert"),r=a.find(w=>w.seriesName==="Device Offline");return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[180px]">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${Y}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #ef4444"></div>
                  <span class="text-text/80 text-sm">Fall Alert</span>
                </div>
                <span class="font-mono font-medium text-text">${(M==null?void 0:M.value)||0}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #f59e0b"></div>
                  <span class="text-text/80 text-sm">Device Offline</span>
                </div>
                <span class="font-mono font-medium text-text">${(r==null?void 0:r.value)||0}</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!0,bottom:10,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"normal"},formatter:function(a){return a==="Fall Alert"?`Fall Alert: ${I.toLocaleString()}`:a==="Device Offline"?`Device Offline: ${_.toLocaleString()}`:a}},grid:{left:"3%",right:"4%",bottom:t.length>15?"80px":"50px",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.2)"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:11,interval:E(t.length),rotate:t.length>15?45:0,margin:t.length>15?15:8,formatter:a=>a},axisTick:{alignWithLabel:!0,interval:E(t.length)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12}},series:[{name:"Fall Alert",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#ef4444"},itemStyle:{color:"#ef4444"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(239, 68, 68, 0.3)"},{offset:1,color:"rgba(239, 68, 68, 0.05)"}]}},data:p},{name:"Device Offline",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#f59e0b"},itemStyle:{color:"#f59e0b"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 158, 11, 0.3)"},{offset:1,color:"rgba(245, 158, 11, 0.05)"}]}},data:O}],dataZoom:[{type:"inside",start:t.length>30?100-Math.floor(3e3/t.length):0,end:100},{show:!1}]};return e.jsx("div",{style:{width:n,height:v},children:e.jsx(G,{option:h,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Ee({data:n=[],width:v="100%",height:S=350}){const A=(()=>{const m=n.map(p=>p.score),t=Math.max(...m),x=Math.min(...m);return n.map(p=>({...p,isHighest:p.score===t,isLowest:p.score===x,itemStyle:{color:p.score===t?"#10b981":p.score===x?"#ef4444":"rgb(var(--ms-primary-color))"}}))})(),b={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:m=>{const{name:t,value:x,color:p}=m;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${p}"></div>
              <span class="font-semibold text-text text-sm">${t}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm pr-1">Performance Score: </span>
                <span class="font-mono font-bold text-text text-sm">${x}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",show:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12,formatter:"{value}%"}},series:[{name:"Performance Score",type:"bar",barWidth:"60%",itemStyle:{borderRadius:[7,7,0,0],borderWidth:0},label:{show:!0,position:"top",color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"bold",formatter:"{c}%"},emphasis:{disabled:!0},data:A.map(m=>({value:m.score,name:m.name,itemStyle:{...m.itemStyle,borderWidth:0},emphasis:m.isHighest||m.isLowest?void 0:{itemStyle:{opacity:.8}}}))}]};return e.jsx("div",{style:{width:v,height:S},children:e.jsx(G,{option:b,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Oe({data:n,centerLabel:v,width:S="100%",height:s=400}){const A=n.reduce((t,x)=>t+x.value,0),b=Math.max(...n.map(t=>t.value)),m={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:t=>{const x=(t.value/A*100).toFixed(1);return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${t.color}"></div>
              <span class="font-semibold text-text text-sm">${t.name}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Count</span>
                <span class="font-mono font-medium text-text">${t.value.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Percent</span>
                <span class="font-mono font-medium text-text">${x}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},series:[{type:"pie",radius:["37%","77%"],roseType:"area",emphasis:{scale:!0,scaleSize:10,focus:"self"},itemStyle:{borderWidth:0,borderColor:"#fff"},label:{show:!0,fontSize:14,color:"rgb(var(--ms-text-color))",formatter:({name:t,value:x})=>`${t}
{value|${x.toLocaleString()}}`,rich:{value:{fontSize:24,fontWeight:600,color:"rgb(var(--ms-text-color)/0.7)",padding:[2,0,0,0]}}},labelLine:{show:!0,length:20,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},data:n.map(t=>({...t,...t.value===b&&{emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{...t.itemStyle,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}))}]};return e.jsxs("div",{className:"relative",style:{width:S,height:s},children:[e.jsx(G,{option:m,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-[22px] font-bold text-text",children:A.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0",children:v||"Total"})]})]})}function Ke(){var Q,V;const{appName:n,logoUrl:v,logoDarkUrl:S}=le().branding,[s,A]=ie.useState({from:null,to:null}),[b,m]=T.useState([]),[t,x]=T.useState([]),[p,O]=T.useState({}),[E,I]=T.useState(0),_={2:{name:"Fall Alerts",color:"#ef4444"},5:{name:"Device Offline",color:"#f59e0b"}},{data:h,isLoading:a,isError:c,isSuccess:Y,error:M}=ce({to_date:s.from||g().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||g().format("YYYY-MM-DD")});T.useEffect(()=>{var j,L;const o=((j=h==null?void 0:h.data)==null?void 0:j.device_uptime)??0,D=((L=h==null?void 0:h.data)==null?void 0:L.device_downtime)??0,u=o+D,d=u>0?Math.round(o/u*100):0;I(d)},[h,Y]);const{data:r,isLoading:w,isError:l,isSuccess:y,error:k}=de({to_date:s.from||g().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||g().format("YYYY-MM-DD")});T.useEffect(()=>{var D,u;const o=Array.isArray(r==null?void 0:r.data)&&((D=r==null?void 0:r.data)==null?void 0:D.length)>0?(u=r==null?void 0:r.data)==null?void 0:u.map(d=>{var j,L;return{value:(d==null?void 0:d.count)??0,name:((j=_[d==null?void 0:d._id])==null?void 0:j.name)||"Unknown",itemStyle:{color:((L=_[d==null?void 0:d._id])==null?void 0:L.color)||"#9ca3af"}}}):[{value:0,name:"No Data",itemStyle:{color:"#9ca3af"}}];m(o)},[r,y]);const{data:N,isLoading:H,isError:ke,error:Ce,isSuccess:Fe}=fe({to_date:s.from||g().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||g().format("YYYY-MM-DD")}),{data:C,isLoading:$e,isError:Ue,isSuccess:K,error:We}=me({to_date:s.from||g().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||g().format("YYYY-MM-DD")});T.useEffect(()=>{var D;const o=(D=C==null?void 0:C.data)==null?void 0:D.map(u=>{const d=(u.countLessThan2Min??0)+(u.countGreaterThan2Min??0),j=d>0?(u.countLessThan2Min??0)/d*100:0;return{name:u.closed_by,score:Math.round(j)}});x(o)},[C,K]);const{data:i,isLoading:ze,isError:Ie,isSuccess:Be,error:Ge}=he({to_date:s.from||g().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||g().format("YYYY-MM-DD")});function X(o){if(!o||o.length===0)return 0;const u=o.filter(d=>d.sla_status).length/o.length*100;return Math.round(u*100)/100}const ae=ue("(max-width: 1366px)"),F=xe(t),se=o=>o.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return T.useEffect(()=>{var J,Z,q,R,ee;const o={companyName:n,startDate:s.from||g().format("YYYY-MM-DD"),endDate:s.to||g().subtract(30,"day").format("YYYY-MM-DD"),totalAlerts:((J=r==null?void 0:r.data)==null?void 0:J.reduce((f,P)=>f+P.count,0))||0,avgResponseTime:te(((Z=h==null?void 0:h.data)==null?void 0:Z.avg_res_time)||0),slaCompliance:(i==null?void 0:i.data)&&X(i==null?void 0:i.data)||"0%",deviceUptime:Math.round(E)+"%"},D=((q=b==null?void 0:b.filter(f=>f.name=="Fall Alerts")[0])==null?void 0:q.value)||0,u=((R=b==null?void 0:b.filter(f=>f.name=="Device Offline")[0])==null?void 0:R.value)||0,d={fall:D,offline:u,total:D+u},j=new Map;(ee=N==null?void 0:N.data)==null||ee.forEach(f=>{const P=new Date(f.year,f.month-1,f.day),B=P.toISOString().split("T")[0],ne=f.event==="5"?"offline":"fall";j.has(B)||j.set(B,{timestamp:P.getTime(),date:se(P),fall:0,offline:0,total:0});const $=j.get(B);$[ne]+=f.count||0,$.total=$.fall+$.offline});const L=Array.from(j.values()).sort((f,P)=>f.timestamp-P.timestamp);L.forEach(f=>{delete f.timestamp});const re=t==null?void 0:t.map(f=>({...f,score:`${f.score}%`})),oe=pe((i==null?void 0:i.data)||[]);O({basicInfo:o,totalAlertOverview:d,alertTrends:L,agentPerformance:re,slaCompliance:oe})},[s.to,s.form,r,N,t,K,i]),e.jsxs("div",{className:"mb-6",children:[" ",e.jsxs("div",{id:"customer_heading",className:"flex justify-between sm:flex-row flex-col gap-4 items-center mb-6",children:[e.jsx(_e,{}),e.jsxs("div",{className:"flex gap-2  items-center",children:[e.jsxs(ge,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(be,{variant:"tertiary",children:[e.jsx(ye,{}),s!=null&&s.from&&(s!=null&&s.to)?`${s.from} - ${s.to}`:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Start Date"})," ",e.jsx(De,{})," ",e.jsx("span",{children:"End Date"})]})]})}),e.jsx(we,{className:"overflow-hidden p-0",align:"end",children:e.jsx(je,{className:"w-full border-border",mode:"range",selected:s,onSelect:o=>{if(!(o!=null&&o.from)||!(o!=null&&o.to)){A({from:null,to:null});return}A({from:g(o.from).format("YYYY-MM-DD"),to:g(o.to).format("YYYY-MM-DD")})},captionLayout:"dropdown",fixedWeeks:!0,showOutsideDays:!0})})]}),e.jsx(Se,{pdfProps:p})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:" items-center justify-between grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 lg:auto-rows-fr",children:[e.jsx(W,{label:"Total Alerts",value:((Q=r==null?void 0:r.data)==null?void 0:Q.reduce((o,D)=>o+D.count,0))||0,icon:e.jsx(Ye,{size:20,color:"white"})}),e.jsx(W,{label:"Avg. Response Time",value:te(((V=h==null?void 0:h.data)==null?void 0:V.avg_res_time)||0),icon:e.jsx(Me,{size:20,color:"white"})}),e.jsx(W,{label:"SLA Compliance",value:(i==null?void 0:i.data)&&X(i==null?void 0:i.data)||"0%",icon:e.jsx(Ae,{size:20,color:"white"})}),e.jsx(W,{label:"Device Uptime",value:Math.round(E)+"%",icon:e.jsx(Ne,{size:20,color:"white"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2 lg:auto-rows-fr",children:[e.jsx("div",{id:"Total Alert Overview Graph",children:e.jsx(U,{title:e.jsx("h1",{className:"text-lg",children:"Total Alert Overview"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4 !h-full flex items-center justify-center",children:e.jsx(Oe,{data:b,centerLabel:" ",width:"100%",height:ae?340:400})})})}),e.jsx("div",{id:"Alert Trends Graph",children:e.jsx(U,{title:e.jsx("h1",{className:"text-lg",children:"Alert Trends"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4",children:e.jsx(Pe,{data:N==null?void 0:N.data})})})}),e.jsx("div",{id:"Agent Performance Graph",children:e.jsx(U,{title:e.jsx("h1",{className:"text-lg",children:"Agent Performance"}),headerPadding:"p-4 !text-lg border-none",children:e.jsxs("div",{className:"p-4",children:[e.jsx(Ee,{data:t,height:340}),e.jsxs("div",{className:"flex items-center gap-4 justify-center mt-4",children:[e.jsx(z,{title:"Total Agent",value:F.totalAgents}),e.jsx(z,{title:"Avg. Performance",value:F.averagePerformance+"%"}),e.jsx(z,{title:"Highest Performance",value:F.highestPerformance+"%"}),e.jsx(z,{title:"Lowest Performance",value:F.lowestPerformance+"%"})]})]})})}),e.jsx("div",{id:"SLA Compliance Report Graph",children:e.jsx(U,{title:e.jsx("h1",{className:"text-lg",children:"SLA Compliance Report"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx(Le,{width:"100%",height:400,data:i==null?void 0:i.data})})})]})]})]})}const _e=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-start gap-2 w-full",children:[e.jsx("h1",{className:"text-text sm:text-xl text-lg",children:"Reporting & Analytics"}),e.jsx("div",{className:"opacity-95",children:e.jsx(Te,{})})]})}),W=({label:n="",value:v="",icon:S})=>e.jsxs("div",{className:"bg-card p-4 flex items-center justify-between gap-3 rounded-md w-full",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx("h1",{className:"text-lg font-semibold",children:v})]}),e.jsx("div",{className:"p-2 bg-primary w-fit rounded-md text-lg",children:S})]}),z=({title:n,value:v})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsxs("div",{className:"p-2 px-3 bg-primary rounded-lg text-white font-medium text-sm",children:[" ",v]}),e.jsxs("div",{className:"rounded-lg text-sm text-wrap",children:[" ",n]})]})});export{Ke as default};
//# sourceMappingURL=Analytics-BN_3jQQf.js.map
