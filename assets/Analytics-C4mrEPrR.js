import{bn as ge,j as e,h5 as ye,gK as me,h6 as ve,h7 as be,h8 as De,h9 as D,ha as S,h as j,E as K,hb as z,hc as B,bg as we,r as P,hd as Se,bQ as ce,he as je,hf as Te,hg as Ae,hh as Me,hi as Ce,hj as _e,hk as Ye,hl as Le,hm as Ne,hn as Fe,gV as G,gM as $e}from"./index-JN8Zdwsz.js";import{n as Oe,o as Ee,p as Pe,q as ke,r as ze}from"./Dashboard-Db77fCOr.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new t.Error().stack;o&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="47eb5d6f-23d4-478d-9548-1d811f42eb59",t._sentryDebugIdIdentifier="sentry-dbid-47eb5d6f-23d4-478d-9548-1d811f42eb59")}catch{}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ie=ge("arrow-right",Be),f=De.create({page:{padding:30,fontSize:10,fontFamily:"Helvetica",color:"#111"},header:{textAlign:"center",marginBottom:20},companyName:{fontSize:16,fontWeight:"bold"},reportTitle:{fontSize:13,marginTop:4,textDecoration:"underline"},dateRange:{fontSize:10,marginTop:4,color:"#555"},section:{marginTop:15},sectionTitle:{fontSize:12,fontWeight:"bold",marginBottom:6,borderBottom:"1 solid #ccc",paddingBottom:3},infoBoxContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",flexWrap:"wrap",marginBottom:10},infoBox:{width:"49.9%",backgroundColor:"#f0f0f0",padding:8,marginBottom:2,fontWeight:600,fontSize:"11px"},table:{display:"table",width:"100%",border:"1 solid #ddd",borderRadius:3,marginTop:5},tableRow:{flexDirection:"row"},tableCol:{width:"25%",borderRight:"0.5 solid #ddd",padding:4},tableColHeader:{width:"25%",borderRight:"0.5 solid #ddd",backgroundColor:"#f0f0f0",padding:4},tableCellHeader:{fontWeight:"bold",fontSize:10},tableCell:{fontSize:9},noData:{fontSize:9,fontStyle:"italic",color:"#777",marginTop:4}}),We=()=>{const t=Array.from({length:30},(a,l)=>j().subtract(29-l,"day").format("YYYY-MM-DD")),o=["Device Offline Alert","Fall Alert"],s=[];return t.forEach(a=>{const l=Math.floor(Math.random()*12)+8;for(let c=0;c<l;c++){const d=Math.floor(Math.random()*24),n=Math.floor(Math.random()*60),g=Math.floor(Math.random()*25)+5,x=15,y=g<=x,F=o[Math.floor(Math.random()*o.length)];s.push({day:a,time:`${d.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`,hour:d+n/60,responseTime:g,slaTime:x,alertId:`A${a.replace(/-/g,"")}${c+1}`,compliance:y,alertType:F})}}),s},de={fall:25,offline:40,total:65};Array.from({length:30},(t,o)=>{const s=j().subtract(29-o,"day").format("MMM DD"),a=Math.floor(Math.random()*5),l=Math.floor(Math.random()*3),c=a+l;return{date:s,fall:a,offline:l,total:c}});Array.from({length:30},(t,o)=>{const s=j().subtract(29-o,"day").format("MMM DD"),a=Math.floor(Math.random()*50)+10,l=Math.floor(Math.random()*50)+10,c=a+l,d=(a/c*100).toFixed(0)+"%";return{date:s,compliance:a,nonCompliance:l,percent:d}});const Re=()=>{const t=We(),o={};return t.forEach(a=>{o[a.day]||(o[a.day]={date:j(a.day).format("MMM DD"),fallCount:0,offlineCount:0,totalAlerts:0,slaMet:0}),o[a.day].totalAlerts++,a.alertType==="Fall Alert"&&o[a.day].fallCount++,a.alertType==="Device Offline Alert"&&o[a.day].offlineCount++,a.compliance&&o[a.day].slaMet++}),Object.values(o).map(a=>({date:a.date,fallCount:a.fallCount,offlineCount:a.offlineCount,slaPercent:a.totalAlerts>0?(a.slaMet/a.totalAlerts*100).toFixed(1)+"%":"0%"}))};Re();const q=(t,o)=>e.jsxs(D,{style:f.table,children:[e.jsx(D,{style:f.tableRow,children:t.map((s,a)=>e.jsx(D,{style:{width:"50%",padding:6,borderBottom:"0.5 solid #ccc",borderRight:a===0?"0.5 solid #ccc":"none"},children:e.jsx(S,{style:f.tableCellHeader,children:s})},a))}),o.map((s,a)=>e.jsx(D,{style:f.tableRow,children:Object.values(s).map((l,c)=>e.jsx(D,{style:{width:"50%",padding:6,borderBottom:"0.5 solid #ddd",borderRight:c===0?"0.5 solid #ddd":"none"},children:e.jsx(S,{style:f.tableCell,children:l})},c))},a))]}),Ue=t=>{const o=t.total||1,s=12;return e.jsx(D,{style:{marginTop:6},children:[{label:"Fall Alerts",value:t.fall,color:"#EF4444"},{label:"Device Offline Alerts",value:t.offline,color:"#FACC15"},{label:"Total",value:t.total,color:"#556270"}].map((a,l)=>e.jsxs(D,{style:{marginBottom:6,display:"flex",alignItems:a.label=="Fall Alerts"?"flex-start":a.label=="Device Offline Alerts"?"flex-end":"center"},children:[e.jsxs(S,{style:{fontSize:10,marginBottom:2},children:[a.label,": ",a.value]}),e.jsx(D,{style:{width:"100%",height:s,backgroundColor:"#eee",borderRadius:4,overflow:"hidden",display:"flex",alignItems:a.label=="Fall Alerts"?"flex-start":"flex-end"},children:e.jsx(D,{style:{width:`${a.value/o*100}%`,height:"100%",backgroundColor:a.color,borderRadius:4}})})]},l))})},Ge=({basicInfo:t={},totalAlertOverview:o={},alertTrends:s=[],agentPerformance:a=[],slaCompliance:l=[]})=>e.jsx(ve,{children:e.jsxs(be,{size:"A4",style:f.page,children:[e.jsxs(D,{style:f.header,children:[e.jsx(S,{style:f.companyName,children:t.companyName}),e.jsx(S,{style:f.reportTitle,children:"Analytics Report"}),e.jsxs(S,{style:f.dateRange,children:[t.startDate," â†’ ",t.endDate]})]}),e.jsxs(D,{style:f.infoBoxContainer,children:[e.jsx(D,{style:f.infoBox,children:e.jsxs(S,{children:["Total Alerts: ",t.totalAlerts]})}),e.jsx(D,{style:f.infoBox,children:e.jsxs(S,{children:["Avg. Response Time: ",t.avgResponseTime]})}),e.jsx(D,{style:f.infoBox,children:e.jsxs(S,{children:["SLA Compliance: ",t.slaCompliance]})}),e.jsx(D,{style:f.infoBox,children:e.jsxs(S,{children:["Device Uptime: ",t.deviceUptime]})})]}),e.jsxs(D,{style:f.section,children:[e.jsx(S,{style:f.sectionTitle,children:"Total Alert Overview"}),de&&(o.fall||o.offline)?Ue(de):e.jsx(S,{style:f.noData,children:"No data available."})]}),e.jsxs(D,{style:f.section,children:[e.jsx(S,{style:f.sectionTitle,children:"Alert Trends"}),s.length>0?q(["Date","Fall Alerts","Device Offline","Total"],s):e.jsx(S,{style:f.noData,children:"No data available."})]}),e.jsxs(D,{style:f.section,children:[e.jsx(S,{style:f.sectionTitle,children:"Agent Performance"}),a.length>0?q(["Agent","Performance %"],a):e.jsx(S,{style:f.noData,children:"No data available."})]}),e.jsxs(D,{style:f.section,children:[e.jsx(S,{style:f.sectionTitle,children:"SLA Compliance Report"}),l.length>0?q(["Date","Fall Alert","Device Offline","SLA Compliance (%)"],l):e.jsx(S,{style:f.noData,children:"No data available."})]})]})}),He=({pdfProps:t={}})=>e.jsx(ye,{document:e.jsx(Ge,{basicInfo:t.basicInfo,totalAlertOverview:t.totalAlertOverview,alertTrends:t.alertTrends,agentPerformance:t.agentPerformance,slaCompliance:t.slaCompliance}),fileName:"Analytics_Report.pdf",children:({loading:o})=>e.jsx(me,{children:o?"Generating...":"Export Report"})});function Qe({width:t="100%",height:o=400,data:s=[]}){const a=()=>{if(!s||s.length===0)return d();const i=new Map;s.forEach(h=>{const A=new Date(h.year,h.month-1,h.day),O=A.toISOString().split("T")[0],_=h.event==="5"?"Device Offline":"Fall Alert";i.has(O)||i.set(O,{date:A,timestamp:A.getTime(),dateFormatted:l(A,s),tooltipDate:c(A),"Fall Alert":0,"Device Offline":0});const V=i.get(O);V[_]+=h.count||0});const p=Array.from(i.values()).sort((h,A)=>h.timestamp-A.timestamp),M=p.map(h=>h.dateFormatted),v=p.map(h=>h.tooltipDate),m=p.map(h=>h["Fall Alert"]),T=p.map(h=>h["Device Offline"]);return{dates:M,tooltipDates:v,fallAlertData:m,deviceOfflineData:T}},l=(i,p)=>{if(!p||p.length===0)return i.toLocaleDateString("en-US",{month:"short",day:"numeric"});const M=p.map(A=>new Date(A.year,A.month-1,A.day)),v=new Date(Math.min(...M)),m=new Date(Math.max(...M)),T=Math.abs(m-v);return Math.ceil(T/(1e3*60*60*24))<=60?i.toLocaleDateString("en-US",{month:"short",day:"numeric"}):i.toLocaleDateString("en-US",{month:"short",year:"2-digit"})},c=i=>i.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),d=()=>{const i=[],p=[],M=[],v=[],m=new Date;for(let T=9;T>=0;T--){const h=new Date(m);h.setDate(m.getDate()-T),i.push(h.toLocaleDateString("en-US",{month:"short",day:"numeric"})),p.push(h.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),M.push(Math.floor(0)),v.push(Math.floor(0))}return{dates:i,tooltipDates:p,fallAlertData:M,deviceOfflineData:v}},{dates:n,tooltipDates:g,fallAlertData:x,deviceOfflineData:y}=a(),F=i=>i<=10?0:i<=20?1:i<=40?2:i<=60?3:Math.floor(i/12),I=x.reduce((i,p)=>i+p,0),r=y.reduce((i,p)=>i+p,0),$={tooltip:{trigger:"axis",backgroundColor:"transparent",borderWidth:0,className:"!shadow-none",axisPointer:{type:"line",lineStyle:{color:"rgb(var(--ms-text-color)/0.2)",width:1}},formatter:i=>{const p=i[0].dataIndex,M=g[p],v=i.find(T=>T.seriesName==="Fall Alert"),m=i.find(T=>T.seriesName==="Device Offline");return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[180px]">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${M}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #ef4444"></div>
                  <span class="text-text/80 text-sm">Fall Alert</span>
                </div>
                <span class="font-mono font-medium text-text">${(v==null?void 0:v.value)||0}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #f59e0b"></div>
                  <span class="text-text/80 text-sm">Device Offline</span>
                </div>
                <span class="font-mono font-medium text-text">${(m==null?void 0:m.value)||0}</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!0,bottom:10,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"normal"},formatter:function(i){return i==="Fall Alert"?`Fall Alert: ${I.toLocaleString()}`:i==="Device Offline"?`Device Offline: ${r.toLocaleString()}`:i}},grid:{left:"3%",right:"4%",bottom:n.length>15?"80px":"50px",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n,axisLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.2)"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:11,interval:F(n.length),rotate:n.length>15?45:0,margin:n.length>15?15:8,formatter:i=>i},axisTick:{alignWithLabel:!0,interval:F(n.length)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12}},series:[{name:"Fall Alert",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#ef4444"},itemStyle:{color:"#ef4444"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(239, 68, 68, 0.3)"},{offset:1,color:"rgba(239, 68, 68, 0.05)"}]}},data:x},{name:"Device Offline",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#f59e0b"},itemStyle:{color:"#f59e0b"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 158, 11, 0.3)"},{offset:1,color:"rgba(245, 158, 11, 0.05)"}]}},data:y}],dataZoom:[{type:"inside",start:n.length>30?100-Math.floor(3e3/n.length):0,end:100},{show:!1}]};return e.jsx("div",{style:{width:t,height:o},children:e.jsx(K,{option:$,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Ke({data:t=[],width:o="100%",height:s=350}){const l=(()=>{const d=t.map(x=>x.score),n=Math.max(...d),g=Math.min(...d);return t.map(x=>({...x,isHighest:x.score===n,isLowest:x.score===g,itemStyle:{color:x.score===n?"#10b981":x.score===g?"#ef4444":"rgb(var(--ms-primary-color))"}}))})(),c={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:d=>{const{name:n,value:g,color:x}=d;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${x}"></div>
              <span class="font-semibold text-text text-sm">${n}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm pr-1">Performance Score: </span>
                <span class="font-mono font-bold text-text text-sm">${g}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",show:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12,formatter:"{value}%"}},series:[{name:"Performance Score",type:"bar",barWidth:"60%",itemStyle:{borderRadius:[7,7,0,0],borderWidth:0},label:{show:!0,position:"top",color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"bold",formatter:"{c}%"},emphasis:{disabled:!0},data:l.map(d=>({value:d.score,name:d.name,itemStyle:{...d.itemStyle,borderWidth:0},emphasis:d.isHighest||d.isLowest?void 0:{itemStyle:{opacity:.8}}}))}]};return e.jsx("div",{style:{width:o,height:s},children:e.jsx(K,{option:c,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Ve({data:t,centerLabel:o,width:s="100%",height:a=400}){const l=t.reduce((n,g)=>n+g.value,0),c=Math.max(...t.map(n=>n.value)),d={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:n=>{const g=(n.value/l*100).toFixed(1);return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${n.color}"></div>
              <span class="font-semibold text-text text-sm">${n.name}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Count</span>
                <span class="font-mono font-medium text-text">${n.value.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Percent</span>
                <span class="font-mono font-medium text-text">${g}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},series:[{type:"pie",radius:["37%","77%"],roseType:"area",emphasis:{scale:!0,scaleSize:10,focus:"self"},itemStyle:{borderWidth:0,borderColor:"#fff"},label:{show:!0,fontSize:14,color:"rgb(var(--ms-text-color))",formatter:({name:n,value:g})=>`${n}
{value|${g.toLocaleString()}}`,rich:{value:{fontSize:24,fontWeight:600,color:"rgb(var(--ms-text-color)/0.7)",padding:[2,0,0,0]}}},labelLine:{show:!0,length:20,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},data:t.map(n=>({...n,...n.value===c&&{emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{...n.itemStyle,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}))}]};return e.jsxs("div",{className:"relative",style:{width:s,height:a},children:[e.jsx(K,{option:d,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-[22px] font-bold text-text",children:l.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0",children:o||"Total"})]})]})}function Xe(t,o){const s=new Date(t),l=new Date(o)-s,c=Math.floor(l/(1e3*60*60)),d=Math.floor(l%(1e3*60*60)/(1e3*60)),n=Math.floor(l%(1e3*60)/1e3);return{hours:c,minutes:d,seconds:n,totalMinutes:l/(1e3*60)}}function qe(t){const o=Math.floor(t/60),s=Math.floor(t%60),a=Math.floor(t*60%60);return o>0?`${o}h ${s}m ${a}s`:s>0?`${s}m ${a}s`:`${a}s`}const Ze=t=>t.map(o=>{const s=new Date(o.created_at);new Date(o.closed_at);const a=Xe(o.created_at,o.closed_at),l=s.toISOString().split("T")[0],c=s.toTimeString().split(" ")[0].substring(0,5),d=s.getHours()+s.getMinutes()/60;qe(o.sla_minutes);const n={2:"Fall Alert",5:"Device Offline Alert"};return{_id:o._id,day:l,time:c,hour:d,responseTime:a.totalMinutes,responseTimeFormatted:`${a.hours}h ${a.minutes}m ${a.seconds}s`,slaTime:o.sla_minutes,slaTimeFormatted:"2m",alertId:o._id,compliance:o.sla_status,alertType:n[o.event]||`Event ${o.event}`,created_at:o.created_at,closed_at:o.closed_at,event:o.event}});function Je({data:t=[],width:o="100%",height:s=400}){const a=()=>{const r=["2024-01-01","2024-01-02","2024-01-03","2024-01-04","2024-01-05"],$=["Device Offline Alert","Fall Alert"],i=[];return r.forEach(p=>{const M=Math.floor(Math.random()*12)+8;for(let v=0;v<M;v++){const m=Math.floor(Math.random()*24),T=Math.floor(Math.random()*60),h=Math.floor(Math.random()*25)+5,A=15,O=h<=A,_=$[Math.floor(Math.random()*$.length)];i.push({day:p,time:`${m.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`,hour:m+T/60,responseTime:h,slaTime:A,alertId:`A${p.replace(/-/g,"")}${v+1}`,compliance:O,alertType:_})}}),i},c=t.length>0?Ze(t):a(),d=c.length,n=c.filter(r=>r.compliance).length,g=c.filter(r=>!r.compliance).length,x=c.filter(r=>r.compliance),y=c.filter(r=>!r.compliance),F=[...new Set(c.map(r=>r.day))].sort(),I={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:r=>{const{name:$,compliance:i,responseTimeFormatted:p,slaTimeFormatted:M,time:v,day:m,alertType:T,event:h,created_at:A,closed_at:O}=r.data;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[250px] z-999">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${T}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-text/80 text-sm">Date</span>
                <span class="font-mono font-medium text-text">${m}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-text/80 text-sm">Time</span>
                <span class="font-mono font-medium text-text">${v}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-text/80 text-sm">Response Time</span>
                <span class="font-mono font-medium text-text">${p}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-text/80 text-sm">SLA Time</span>
                <span class="font-mono font-medium text-text">${M}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-text/80 text-sm">Status</span>
                <span class="font-mono font-medium" style="color: ${i?"#10b981":"#ef4444"}">${i?"Compliance":"Not Compliance"}</span>
              </div>
             
            </div>
          </div>
        `}},legend:{show:!0,bottom:0,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12},formatter:function(r){return r==="Total Alerts"?`Total Alerts: ${d}`:r==="Compliance"?`Compliance: ${n}`:r==="Not Compliance"?`Not Compliance: ${g}`:r},rich:{bold:{fontWeight:"bold",color:"rgb(var(--ms-text-color))",fontFamily:"monospace",fontSize:12}},data:[{name:"Total Alerts",itemStyle:{color:"rgb(var(--ms-primary-color))"}},{name:"Compliance",itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#10b981"}},{name:"Not Compliance",itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#ef4444"}}]},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"value",nameLocation:"middle",nameGap:30,min:0,max:24,axisLine:{show:!1,lineStyle:{color:"rgb(var(--ms-text-color)/0.3)"}},axisTick:{show:!1},axisLabel:{show:!0,color:"rgb(var(--ms-text-color)/0.7)",formatter:function(r){return`${Math.floor(r)}:00`}},splitLine:{show:!1,lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"solid"}}},yAxis:{type:"category",nameLocation:"middle",nameGap:40,data:F,axisLine:{show:!1,lineStyle:{color:"rgb(var(--ms-text-color)/0.3)"}},axisTick:{show:!0},axisLabel:{show:!0,color:"rgb(var(--ms-text-color)/0.7)",formatter:function(r){return new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"})}},splitLine:{show:!0,lineStyle:{color:"rgb(var(--ms-text-color)/0.1)"}}},dataZoom:[{type:"slider",yAxisIndex:0,filterMode:"filter",start:50,end:100,height:20,bottom:40,show:!1,handleStyle:{color:"rgb(var(--ms-primary-color))"}},{type:"inside",yAxisIndex:0,filterMode:"filter"}],series:[{name:"Compliance",type:"scatter",symbolSize:10,data:x.map(r=>({name:r.alertId,value:[r.hour,r.day],responseTime:r.responseTime,responseTimeFormatted:r.responseTimeFormatted,slaTime:r.slaTime,slaTimeFormatted:r.slaTimeFormatted,compliance:r.compliance,day:r.day,time:r.time,alertType:r.alertType,event:r.event,created_at:r.created_at,closed_at:r.closed_at,itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#10b981"}})),itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#10b981"},emphasis:{scale:!0,scaleSize:2}},{name:"Not Compliance",type:"scatter",symbolSize:10,data:y.map(r=>({name:r.alertId,value:[r.hour,r.day],responseTime:r.responseTime,responseTimeFormatted:r.responseTimeFormatted,slaTime:r.slaTime,slaTimeFormatted:r.slaTimeFormatted,compliance:r.compliance,day:r.day,time:r.time,alertType:r.alertType,event:r.event,created_at:r.created_at,closed_at:r.closed_at,itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#ef4444"}})),itemStyle:{color:(t==null?void 0:t.length)==0?"#ccc":"#ef4444"},emphasis:{scale:!0,scaleSize:2}}]};return e.jsx("div",{style:{width:o,height:s},children:e.jsx(K,{option:I,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}const et=(t={},o={})=>z([B.COUNT_STATISTICS,t],()=>Oe(t),{...o,retry:0}),tt=(t={},o={})=>z([B.TOTAL_ALERTS,t],()=>Ee(t),{...o,retry:0}),ot=(t={},o={})=>z([B.TOTAL_ALERTS_TREND,t],()=>Pe(t),{...o,retry:0}),at=(t={},o={})=>z([B.AGENT_PERFORMANCE,t],()=>ke(t),{...o,retry:0}),st=(t={},o={})=>z([B.SLA_STATISTICS,t],()=>ze(t),{...o,retry:0}),rt=t=>{if(!t||!Array.isArray(t)||t.length===0)return{totalAgents:0,averagePerformance:0,highestPerformance:0,lowestPerformance:0,highestAgent:null,lowestAgent:null};const o=t.length,s=t.reduce((d,n)=>d+n.score,0),a=Math.round(s/o),l=t.reduce((d,n)=>n.score>d.score?n:d),c=t.reduce((d,n)=>n.score<d.score?n:d);return{totalAgents:o,averagePerformance:a,highestPerformance:l.score,lowestPerformance:c.score,highestAgent:l,lowestAgent:c}},nt=t=>{const o={};return t.forEach(s=>{const a=new Date(s.created_at);a.toISOString().split("T")[0];const l=new Date(a).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}).replace(/,/g,"");o[l]||(o[l]={date:l,fall:0,offline:0,total:0,compliant:0});const d={2:"fall",5:"offline"}[s.event];d&&o[l][d]++,o[l].total++,(s.sla_status==="compliant"||s.sla_status===!0)&&o[l].compliant++}),Object.values(o).sort((s,a)=>new Date(s.date)-new Date(a.date)).map(s=>({date:s.date,fall:s.fall,offline:s.offline,percent:s.total>0?`${Math.round(s.compliant/s.total*100)}%`:"0%"}))};function bt(){var ee,te,oe,ae;const{appName:t}=je.branding,[o,s]=we.useState({from:null,to:null}),[a,l]=P.useState([]),[c,d]=P.useState([]),[n,g]=P.useState({}),x={2:{name:"Fall Alerts",color:"#ef4444"},5:{name:"Device Offline",color:"#f59e0b"}},{data:y,isLoading:F,isError:I,isSuccess:r,error:$}=et({to_date:o.from||j().subtract(30,"day").format("YYYY-MM-DD"),from_date:o.to||j().format("YYYY-MM-DD")}),i=((ee=y==null?void 0:y.data)==null?void 0:ee.device_uptime)??0,p=((te=y==null?void 0:y.data)==null?void 0:te.device_downtime)??0,M=i+p,v=M>0?Math.round(i/M*100):0,{data:m,isLoading:T,isError:h,isSuccess:A,error:O}=tt({to_date:o.from||j().subtract(30,"day").format("YYYY-MM-DD"),from_date:o.to||j().format("YYYY-MM-DD")});P.useEffect(()=>{var L,Y;const u=Array.isArray(m==null?void 0:m.data)&&((L=m==null?void 0:m.data)==null?void 0:L.length)>0?(Y=m==null?void 0:m.data)==null?void 0:Y.map(C=>{var N,k;return{value:(C==null?void 0:C.count)??0,name:((N=x[C==null?void 0:C._id])==null?void 0:N.name)||"Unknown",itemStyle:{color:((k=x[C==null?void 0:C._id])==null?void 0:k.color)||"#9ca3af"}}}):[{value:0,name:"No Data",itemStyle:{color:"#9ca3af"}}];l(u)},[m,A]);const{data:_,isLoading:V,isError:it,error:ct,isSuccess:dt}=ot({to_date:o.from||j().subtract(30,"day").format("YYYY-MM-DD"),from_date:o.to||j().format("YYYY-MM-DD")}),{data:W,isLoading:mt,isError:ft,isSuccess:Z,error:ht}=at({to_date:o.from||j().subtract(30,"day").format("YYYY-MM-DD"),from_date:o.to||j().format("YYYY-MM-DD")});P.useEffect(()=>{var L;const u=(L=W==null?void 0:W.data)==null?void 0:L.map(Y=>{const C=(Y.countLessThan2Min??0)+(Y.countGreaterThan2Min??0),N=C>0?(Y.countLessThan2Min??0)/C*100:0;return{name:Y.closed_by,score:Math.round(N)}});d(u)},[W,Z]);const{data:b,isLoading:pt,isError:ut,isSuccess:xt,error:gt}=st({to_date:o.from||j().subtract(30,"day").format("YYYY-MM-DD"),from_date:o.to||j().format("YYYY-MM-DD")});function J(u){if(!u||u.length===0)return 0;const Y=u.filter(C=>C.sla_status).length/u.length*100;return Math.round(Y*100)/100}const fe=Se("(max-width: 1366px)"),R=rt(c),he=u=>u.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return P.useEffect(()=>{var se,re,ne,le,ie;const u={companyName:t,startDate:o.from||j().format("YYYY-MM-DD"),endDate:o.to||j().subtract(30,"day").format("YYYY-MM-DD"),totalAlerts:((se=m==null?void 0:m.data)==null?void 0:se.reduce((w,E)=>w+E.count,0))||0,avgResponseTime:ce(((re=y==null?void 0:y.data)==null?void 0:re.avg_res_time)||0),slaCompliance:(b==null?void 0:b.data)&&J(b==null?void 0:b.data)||"0%",deviceUptime:Math.round(v)+"%"},L=((ne=a==null?void 0:a.filter(w=>w.name=="Fall Alerts")[0])==null?void 0:ne.value)||0,Y=((le=a==null?void 0:a.filter(w=>w.name=="Device Offline")[0])==null?void 0:le.value)||0,C={fall:L,offline:Y,total:L+Y},N=new Map;(ie=_==null?void 0:_.data)==null||ie.forEach(w=>{const E=new Date(w.year,w.month-1,w.day),X=E.toISOString().split("T")[0],xe=w.event==="5"?"offline":"fall";N.has(X)||N.set(X,{timestamp:E.getTime(),date:he(E),fall:0,offline:0,total:0});const U=N.get(X);U[xe]+=w.count||0,U.total=U.fall+U.offline});const k=Array.from(N.values()).sort((w,E)=>w.timestamp-E.timestamp);k.forEach(w=>{delete w.timestamp});const pe=c==null?void 0:c.map(w=>({...w,score:`${w.score}%`})),ue=nt((b==null?void 0:b.data)||[]);g({basicInfo:u,totalAlertOverview:C,alertTrends:k,agentPerformance:pe,slaCompliance:ue})},[o.to,o.form,m,_,c,Z,b]),e.jsxs("div",{className:"mb-6",children:[" ",e.jsxs("div",{id:"customer_heading",className:"flex justify-between sm:flex-row flex-col gap-4 items-center mb-6",children:[e.jsx(lt,{}),e.jsxs("div",{className:"flex gap-2  items-center",children:[e.jsxs(Te,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(me,{variant:"tertiary",children:[e.jsx(Me,{}),o!=null&&o.from&&(o!=null&&o.to)?`${o.from} - ${o.to}`:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Start Date"})," ",e.jsx(Ie,{})," ",e.jsx("span",{children:"End Date"})]})]})}),e.jsx(Ce,{className:"overflow-hidden p-0",align:"end",children:e.jsx(_e,{className:"w-full border-border",mode:"range",selected:o,onSelect:u=>{if(!(u!=null&&u.from)||!(u!=null&&u.to)){s({from:null,to:null});return}s({from:j(u.from).format("YYYY-MM-DD"),to:j(u.to).format("YYYY-MM-DD")})},captionLayout:"dropdown",fixedWeeks:!0,showOutsideDays:!0})})]}),e.jsx(He,{pdfProps:n})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:" items-center justify-between grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 lg:auto-rows-fr",children:[e.jsx(H,{label:"Total Alerts",value:((oe=m==null?void 0:m.data)==null?void 0:oe.reduce((u,L)=>u+L.count,0))||0,icon:e.jsx(Ye,{size:20,color:"white"})}),e.jsx(H,{label:"Avg. Response Time",value:ce(((ae=y==null?void 0:y.data)==null?void 0:ae.avg_res_time)||0),icon:e.jsx(Le,{size:20,color:"white"})}),e.jsx(H,{label:"SLA Compliance",value:(b==null?void 0:b.data)&&J(b==null?void 0:b.data)||"0%",icon:e.jsx(Ne,{size:20,color:"white"})}),e.jsx(H,{label:"Device Uptime",value:Math.round(v)+"%",icon:e.jsx(Fe,{size:20,color:"white"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2 lg:auto-rows-fr",children:[e.jsx("div",{id:"Total Alert Overview Graph",children:e.jsx(G,{title:e.jsx("h1",{className:"text-lg",children:"Total Alert Overview"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4 !h-full flex items-center justify-center",children:e.jsx(Ve,{data:a,centerLabel:" ",width:"100%",height:fe?340:400})})})}),e.jsx("div",{id:"Alert Trends Graph",children:e.jsx(G,{title:e.jsx("h1",{className:"text-lg",children:"Alert Trends"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4",children:e.jsx(Qe,{data:_==null?void 0:_.data})})})}),e.jsx("div",{id:"Agent Performance Graph",children:e.jsx(G,{title:e.jsx("h1",{className:"text-lg",children:"Agent Performance"}),headerPadding:"p-4 !text-lg border-none",children:e.jsxs("div",{className:"p-4",children:[e.jsx(Ke,{data:c,height:340}),e.jsxs("div",{className:"flex items-center gap-4 justify-center mt-4",children:[e.jsx(Q,{title:"Total Agent",value:R.totalAgents}),e.jsx(Q,{title:"Avg. Performance",value:R.averagePerformance+"%"}),e.jsx(Q,{title:"Highest Performance",value:R.highestPerformance+"%"}),e.jsx(Q,{title:"Lowest Performance",value:R.lowestPerformance+"%"})]})]})})}),e.jsx("div",{id:"SLA Compliance Report Graph",children:e.jsx(G,{title:e.jsx("h1",{className:"text-lg",children:"SLA Compliance Report"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx(Je,{width:"100%",height:400,data:b==null?void 0:b.data})})})]})]})]})}const lt=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-start gap-2 w-full",children:[e.jsx("h1",{className:"text-text sm:text-xl text-lg",children:"Reporting & Analytics"}),e.jsx("div",{className:"opacity-95",children:e.jsx($e,{})})]})}),H=({label:t="",value:o="",icon:s})=>e.jsxs("div",{className:"bg-card p-4 flex items-center justify-between gap-3 rounded-md w-full",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:t}),e.jsx("h1",{className:"text-lg font-semibold",children:o})]}),e.jsx("div",{className:"p-2 bg-primary w-fit rounded-md text-lg",children:s})]}),Q=({title:t,value:o})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsxs("div",{className:"p-2 px-3 bg-primary rounded-lg text-white font-medium text-sm",children:[" ",o]}),e.jsxs("div",{className:"rounded-lg text-sm text-wrap",children:[" ",t]})]})});export{bt as default};
//# sourceMappingURL=Analytics-C4mrEPrR.js.map
