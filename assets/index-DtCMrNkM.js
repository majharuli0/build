import{u as C,r as i,aj as I,ah as T,j as s,e as E,a7 as B,ak as S,ai as k,ag as R}from"./index-BZN7kAPq.js";import"./alertsOverview-Cn23m0hg.js";import{u as $,D as L,a as M}from"./RoomMap4-BoV7jKvS.js";import{g as b,t as H,d as W,b as P}from"./helper-BMkLFytm.js";import{A as V}from"./ActionManu-BD3cZAei.js";import{g as Y}from"./elderlySupport-4oZUV8OQ.js";import{S as F}from"./index-Uvg5eF-I.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="b601c18b-7a20-49a6-93eb-ac17b9800bcc",e._sentryDebugIdIdentifier="sentry-dbid-b601c18b-7a20-49a6-93eb-ac17b9800bcc")}catch{}function q({data:e={}}){var g,w,N,_,A,t,c;const a=C(),[u,m]=i.useState(null),d=i.useRef(null),o=i.useRef(!1),[v,j]=i.useState(!1),f=i.useRef,x=n=>{switch(n){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};i.useEffect(()=>{var l;const n=(l=e==null?void 0:e.rooms)==null?void 0:l.device_no;return n&&(d.current&&d.current!==n&&I({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(r=>console.error(`Error unsubscribing: ${r}`)),T({uid:n,messageType:["1","2","3","4"],topics:{pub:[n]}}).then(()=>{}).catch(r=>console.error(`Error subscribing: ${r}`)),d.current=n),()=>{d.current&&I({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(r=>console.error(`Error during cleanup unsubscribe: ${r}`))}},[e]);function h(n){var p;const r=[...W(n)];((p=r[0])==null?void 0:p.postureIndex)===4&&o.current&&(r[0].postureIndex=6,r[0].posture="Resident on Bed",r[0].color="#252F67"),m(r)}function y(){j(!0),o.current=!0,clearTimeout(f.current),f.current=setTimeout(()=>{j(!1),o.current=!1},5e3)}return $({onMessage:n=>{var r,p;const l=(r=JSON.parse(n==null?void 0:n.message))==null?void 0:r.payload;(l==null?void 0:l.deviceCode)===((p=e==null?void 0:e.rooms)==null?void 0:p.device_no)&&(l!=null&&l.position||l!=null&&l.heartbreath)&&(l!=null&&l.position&&h(l.position),l!=null&&l.heartbreath&&y())},dependencies:[e]}),s.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[s.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${x((g=b(e))==null?void 0:g.label)}`,children:[s.jsx("div",{className:"loader"}),s.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[s.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),s.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(w=b(e))==null?void 0:w.title})]}),s.jsx("span",{onClick:()=>{a(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[s.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),s.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),s.jsx("div",{})]}),s.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[s.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((N=e==null?void 0:e.rooms)==null?void 0:N.mount_type)===1&&((_=e==null?void 0:e.rooms)==null?void 0:_.is_device_bind)&&s.jsx(L,{roomInfo:e==null?void 0:e.rooms,position:u}),((A=e==null?void 0:e.rooms)==null?void 0:A.mount_type)===2&&((t=e==null?void 0:e.rooms)==null?void 0:t.is_device_bind)&&s.jsx(M,{roomInfo:e==null?void 0:e.rooms,position:u}),!((c=e==null?void 0:e.rooms)!=null&&c.is_device_bind)&&s.jsx("span",{className:"w-full h-full flex items-center justify-center",children:s.jsx("p",{children:" No Device Data Available"})})]}),s.jsxs("div",{className:"details-container w-1/3 ",children:[s.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[s.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:H(e.created_at)}),s.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),s.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[s.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:s.jsx(V,{date:e.created_at})}),s.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}function Z(){i.useState("All");const[e,a]=i.useState([]),[u,m]=i.useState(null),[d,o]=i.useState(null),[v,j]=i.useState(null),[f,x]=i.useState(!1),[h,y]=i.useState(1),g=i.useRef(null),w=i.useCallback(()=>{x(!0),Y({to_date:"2024-11-30",from_date:E().format("YYYY-MM-DD"),is_resolved:!1,limit:20,page:h,...v}).then(t=>{a(c=>[...c,...t.data]),x(!1)}).catch(t=>{console.error(t),x(!1)})},[v,h]);i.useEffect(()=>{w()},[h,v]),i.useEffect(()=>{if(e.length>0&&!u){const t=e[0];m(t._id),o(t)}},[e,u]);const N=t=>{m(t);const c=e.find(n=>n._id===t);o(c)},_=()=>{const{scrollTop:t,scrollHeight:c,clientHeight:n}=g.current;t+n>=c-10&&!f&&y(l=>l+1)},A=t=>{j(P(t)),y(1),a([])};return s.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[s.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[s.jsx(F,{style:{width:"100%"},block:!0,options:Q,onChange:t=>A(t)}),s.jsxs("div",{ref:g,className:"w-full overflow-auto",style:{height:"440px"},onScroll:_,children:[e.map(t=>{var c,n,l;return s.jsxs("div",{onClick:()=>N(t._id),className:`custom-tab-label flex justify-between items-center p-2.5 rounded-md cursor-pointer ${u===t._id?"bg-gray-100":""}`,children:[s.jsx("span",{className:"text-black font-semibold",children:t.room_name}),s.jsxs(B,{children:[((c=b(t))==null?void 0:c.label)==="Critical"&&s.jsx(S,{color:"red"}),((n=b(t))==null?void 0:n.label)==="Warning"&&s.jsx(S,{color:"orange"}),((l=b(t))==null?void 0:l.label)==="Info"&&s.jsx(S,{color:"blue"})]})]},t._id)}),f&&s.jsx("div",{className:"w-full flex justify-center py-4",children:s.jsx(k,{})}),!f&&e.length===0&&s.jsx(R,{description:"No active alerts available"})]})]}),s.jsx("div",{className:"w-[70%] h-full",children:d?s.jsx(q,{data:d}):s.jsx(R,{description:"Select an alert to view details"})})]})}const Q=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{Z as R};
//# sourceMappingURL=index-DtCMrNkM.js.map
