import{u as Q,r as s,aS as O,aN as q,j as n,aM as $,aP as z,aI as J,aH as X,aR as K,aV as Z,am as I,an as D,S as ee,Q as te,U as ne,e as k,aD as re,aJ as L,aW as se,aO as ie,aT as le}from"./index-CZWH72ML.js";import"./alertsOverview-SXIuYQme.js";import{C as F}from"./Collapse-BCDu23ph.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="1195b91b-ebc0-4d4b-9194-f0fda86d2c68",e._sentryDebugIdIdentifier="sentry-dbid-1195b91b-ebc0-4d4b-9194-f0fda86d2c68")}catch{}function ce({data:e={}}){var u,h,g,a,x,d,j,b;const r=Q();s.useState(null);const i=s.useRef(null);s.useRef(!1),s.useState(!1);const o=f=>{switch(f){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};return s.useEffect(()=>{var m;const f=(m=e==null?void 0:e.rooms)==null?void 0:m.device_no;return f&&(i.current&&i.current!==f&&O({uid:i.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(v=>console.error(`Error unsubscribing: ${v}`)),q({uid:f,messageType:["1","2","3","4"],topics:{pub:[f]}}).then(()=>{}).catch(v=>console.error(`Error subscribing: ${v}`)),i.current=f),()=>{i.current&&O({uid:i.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(v=>console.error(`Error during cleanup unsubscribe: ${v}`))}},[e]),n.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[n.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${o((u=$(e))==null?void 0:u.label)}`,children:[n.jsx("div",{className:"loader"}),n.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[n.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),n.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(h=$(e))==null?void 0:h.title})]}),n.jsx("span",{onClick:()=>{r(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[n.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),n.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),n.jsx("div",{})]}),n.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[n.jsx(z,{deviceId:(g=e==null?void 0:e.rooms)==null?void 0:g.device_no,children:n.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((a=e==null?void 0:e.rooms)==null?void 0:a.mount_type)===1&&((x=e==null?void 0:e.rooms)==null?void 0:x.is_device_bind)&&n.jsx(J,{roomInfo:e==null?void 0:e.rooms}),((d=e==null?void 0:e.rooms)==null?void 0:d.mount_type)===2&&((j=e==null?void 0:e.rooms)==null?void 0:j.is_device_bind)&&n.jsx(X,{roomInfo:e==null?void 0:e.rooms}),!((b=e==null?void 0:e.rooms)!=null&&b.is_device_bind)&&n.jsx("span",{className:"w-full h-full flex items-center justify-center",children:n.jsx("p",{children:" No Device Data Available"})})]})}),n.jsxs("div",{className:"details-container w-1/3 ",children:[n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:K(e.created_at)}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:n.jsx(Z,{date:e.created_at})}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}function ae(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var H=ae,de=typeof I=="object"&&I&&I.Object===Object&&I,oe=de,fe=oe,ue=typeof self=="object"&&self&&self.Object===Object&&self,be=fe||ue||Function("return this")(),V=be,ge=V,xe=function(){return ge.Date.now()},me=xe,he=/\s/;function ve(e){for(var r=e.length;r--&&he.test(e.charAt(r)););return r}var pe=ve,je=pe,ye=/^\s+/;function _e(e){return e&&e.slice(0,je(e)+1).replace(ye,"")}var Te=_e,Se=V,we=Se.Symbol,U=we,R=U,Y=Object.prototype,Ne=Y.hasOwnProperty,Ie=Y.toString,N=R?R.toStringTag:void 0;function $e(e){var r=Ne.call(e,N),i=e[N];try{e[N]=void 0;var o=!0}catch{}var u=Ie.call(e);return o&&(r?e[N]=i:delete e[N]),u}var Ee=$e,Ae=Object.prototype,Ce=Ae.toString;function Oe(e){return Ce.call(e)}var ke=Oe,M=U,Le=Ee,Re=ke,Me="[object Null]",We="[object Undefined]",W=M?M.toStringTag:void 0;function Pe(e){return e==null?e===void 0?We:Me:W&&W in Object(e)?Le(e):Re(e)}var Ge=Pe;function Be(e){return e!=null&&typeof e=="object"}var Fe=Be,He=Ge,Ve=Fe,Ue="[object Symbol]";function Ye(e){return typeof e=="symbol"||Ve(e)&&He(e)==Ue}var Qe=Ye,qe=Te,P=H,ze=Qe,G=NaN,Je=/^[-+]0x[0-9a-f]+$/i,Xe=/^0b[01]+$/i,Ke=/^0o[0-7]+$/i,Ze=parseInt;function De(e){if(typeof e=="number")return e;if(ze(e))return G;if(P(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=P(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=qe(e);var i=Xe.test(e);return i||Ke.test(e)?Ze(e.slice(2),i?2:8):Je.test(e)?G:+e}var et=De,tt=H,C=me,B=et,nt="Expected a function",rt=Math.max,st=Math.min;function it(e,r,i){var o,u,h,g,a,x,d=0,j=!1,b=!1,f=!0;if(typeof e!="function")throw new TypeError(nt);r=B(r)||0,tt(i)&&(j=!!i.leading,b="maxWait"in i,h=b?rt(B(i.maxWait)||0,r):h,f="trailing"in i?!!i.trailing:f);function m(t){var l=o,c=u;return o=u=void 0,d=t,g=e.apply(c,l),g}function v(t){return d=t,a=setTimeout(_,r),j?m(t):g}function y(t){var l=t-x,c=t-d,p=r-l;return b?st(p,h-c):p}function S(t){var l=t-x,c=t-d;return x===void 0||l>=r||l<0||b&&c>=h}function _(){var t=C();if(S(t))return T(t);a=setTimeout(_,y(t))}function T(t){return a=void 0,f&&o?m(t):(o=u=void 0,g)}function E(){a!==void 0&&clearTimeout(a),d=0,o=x=u=a=void 0}function A(){return a===void 0?g:T(C())}function w(){var t=C(),l=S(t);if(o=arguments,u=this,x=t,l){if(a===void 0)return v(x);if(b)return clearTimeout(a),a=setTimeout(_,r),m(x)}return a===void 0&&(a=setTimeout(_,r)),g}return w.cancel=E,w.flush=A,w}var lt=it;const ct=D(lt),{Panel:at}=F;function bt(){s.useContext(ee);const{notificationEvent:e}=te();s.useState("All");const[r,i]=s.useState([]),[o,u]=s.useState(null),[h,g]=s.useState(null),[a,x]=s.useState(null),[d,j]=s.useState(!1),[b,f]=s.useState(1),[m,v]=s.useState(!0),y=s.useRef(null),S=s.useCallback(()=>{!m||d||(j(!0),ne({to_date:"2024-11-30",from_date:k().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:b,...a}).then(t=>{i(l=>[...l,...t.data]),b>=t.totalPages&&v(!1),j(!1)}).catch(t=>{console.error(t),j(!1)}))},[a,b,m,d]);s.useEffect(()=>{S()},[b,a]),s.useEffect(()=>{if(r.length>0&&!o){const t=r[0];u(t._id),g(t)}},[r,o]);const _=t=>{u(t);const l=r.find(c=>c._id===t);g(l)},T=s.useCallback(ct(()=>{if(!y.current||d||!m)return;const{scrollTop:t,scrollHeight:l,clientHeight:c}=y.current;t+c>=l-50&&f(p=>p+1)},200),[d,m]),E=t=>{x(le(t)),f(1),i([]),v(!0)};s.useEffect(()=>{e&&S()},[e]),s.useEffect(()=>{const t=y.current;return t&&t.addEventListener("scroll",T),()=>{t&&t.removeEventListener("scroll",T)}},[T]);const A=s.useMemo(()=>r.reduce((t,l)=>{const c=l.room_name;return t[c]||(t[c]=[]),t[c].push(l),t},{}),[r]),w=t=>{switch(t){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return n.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[n.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[n.jsx(re,{style:{width:"100%"},block:!0,options:dt,onChange:t=>E(t)}),n.jsxs("div",{ref:y,className:"w-full overflow-auto",style:{height:"440px"},children:[r.length===0&&!d&&n.jsx(L,{description:"No active alerts available"}),r.length>0&&n.jsx(F,{children:Object.entries(A).map(([t,l])=>([...new Set(l.map(c=>{var p;return(p=$(c))==null?void 0:p.label}))],n.jsx(at,{header:n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("span",{className:"text-black font-semibold",children:t})}),children:l&&l.map(c=>{var p;return n.jsxs("div",{onClick:()=>_(c._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${o===c._id?"bg-gray-100":""}`,children:[n.jsx("span",{className:"text-[14px] font-semibold",children:k(c.created_at).format("hh:mm:ss a")}),n.jsx(se,{color:w((p=$(c))==null?void 0:p.label),size:"large"})]},c._id)})},t)))}),d&&n.jsx("div",{className:"w-full flex justify-center py-4",children:n.jsx(ie,{})}),!m&&r.length>0&&n.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),n.jsx("div",{className:"w-[70%] h-full",children:h?n.jsx(ce,{data:h}):n.jsx(L,{description:"Select an alert to view details"})})]})}const dt=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{bt as R};
//# sourceMappingURL=index-ldJzWtmc.js.map
