import{d as x,j as t,bt as _,by as L,a as I,r as p,a3 as F,a1 as E,u as k,F as W,bz as B,az as $,M as z,bb as T,a8 as C,_ as D,H as P,aD as R,bA as O,E as H}from"./index-CLCamRgM.js";import{A as V}from"./AlertName-DtRpCk6a.js";import{A as S,a as G}from"./ActionManu-DwvoMF6q.js";import{L as U}from"./LargeTextViewerModal-DiEDPX8d.js";import{g as f,t as y,c as J,e as K,b as X}from"./helper-BS9GGV6j.js";import{S as q}from"./slick-theme-DlfmR5qH.js";import{b as Q,c as Z}from"./CreateAndEditModal-CQahSfqt.js";import{m as ee,g as te,b as ae}from"./elderlySupport-BdePv6fT.js";import{E as re}from"./index-uZMKWz3e.js";import"./line-DAnNicm2.js";function le({data:d=[],fromDate:m,toDate:s}){const n=((r,e)=>{const l=[];let u=x(r);for(;u.isBefore(e)||u.isSame(e,"day");)l.push(u.format("YYYY-MM-DD")),u=u.add(1,"day");return l})(m,s).map(r=>{const e=d.filter(o=>o.date===r&&o.alarm_group==="Critical").reduce((o,a)=>o+a.count,0),l=d.filter(o=>o.date===r&&o.alarm_group==="Warning").reduce((o,a)=>o+a.count,0),u=d.filter(o=>o.date===r&&o.alarm_group==="Info").reduce((o,a)=>o+a.count,0);return{day:x(r).format("ddd"),critical:e,warning:l,problem:u}}),i={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:n.map(r=>r.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:n.map(r=>r.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:n.map(r=>r.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:n.map(r=>r.problem),itemStyle:{color:"#800080"},smooth:!0}]};return d.length?t.jsx(re,{option:i,style:{width:"100% !important",height:"100%"}}):t.jsx("div",{className:"h-full flex items-center w-full justify-center",children:t.jsx(_,{description:"No data available to show"})})}x.extend(L);x.extend(I);const se=({placeholder:d,style:m,handleChange:s,value:c})=>{const[h,n]=p.useState("This Week"),i=e=>{const l=x(e).startOf("week").format("YYYY-MM-DD"),u=x(e).endOf("week").format("YYYY-MM-DD");return{week:x(e).week(),start:l,end:u}},r=e=>`Week ${i(e).week}`;return p.useEffect(()=>{if(c){const e=x().week(),l=x(c.start).week();l===e-1?n("Last Week"):n(`Week ${l}`)}else n("This Week")},[c]),t.jsx(F,{style:m,placeholder:h,size:"large",format:r,picker:"week",onChange:e=>{if(e){const l=i(e);s(l)}else s(""),n("This Week")}})};function ve(d){const{rolesFormatter:m}=p.useContext(E),s=k(),c=e=>{window.scrollTo(0,0),s(`/supporter/elderlies/elderly-profile/${e.elderly_id}?tab=overview`)},h={activeAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLife","address","viewElderly"],recentlyClosedAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLifetime","alertStatus","closedAt","closedBy","address","viewElderly"],eventsTableData:["eventName","elderlyName","eventTime","place","largeText","status","action"]},n={alertName:{title:"Alert Name",render:e=>t.jsx(V,{data:e})},alertType:{title:"Alert Type",render:e=>{var l;return t.jsx("span",{children:(l=f(e))==null?void 0:l.label})}},elderlyName:{title:"Elderly Name",dataIndex:"elderly_name",render:e=>t.jsx("span",{children:e})},roomName:{title:"Room Name",dataIndex:"room_name",render:e=>t.jsx("span",{children:e})},incidentTime:{title:"Incident Time",dataIndex:"created_at",render:e=>t.jsx("span",{className:"text-nowrap",children:y(e)})},alertLifetime:{title:"Alert Life",render:e=>t.jsx("span",{className:"text-nowrap",children:J(e==null?void 0:e.created_at,e==null?void 0:e.closed_at)})},alertLife:{title:"Alert Life",dataIndex:"created_at",render:e=>t.jsx("span",{className:"text-nowrap",children:t.jsx(S,{date:e})})},alertStatus:{title:"Alert Status",dataIndex:"status",render:e=>t.jsx("span",{className:"text-nowrap",children:e==0?"True Alert":"False Alert"})},address:{title:"Address",width:"230px",render:e=>t.jsx("span",{className:"!w-[230px] text-nowrap",children:e.address})},closedAt:{title:"Closed At",dataIndex:"closed_at",render:e=>t.jsx("span",{className:"text-nowrap",children:y(e)})},closedBy:{title:"Closed By",render:e=>t.jsxs("span",{className:"text-nowrap",children:[e.closed_by," (",m[e.closed_by_role]," )"]})},eventName:{title:"Event Name",dataIndex:"event_name",render:e=>t.jsx("span",{children:e})},eventTime:{title:"Event Time",dataIndex:"date_time",render:e=>t.jsx("span",{className:"text-nowrap",children:y(e)})},eventTimeline:{title:"Event Timeline",dataIndex:"alertLifetime",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},disabilityType:{title:"Disability Type",dataIndex:"disabilityType",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},place:{title:"Place",dataIndex:"place",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},status:{title:"Status",dataIndex:"event_status",render:e=>t.jsx("span",{className:"text-nowrap capitalize",children:e!=="open"?e:"Done"})},largeText:{title:()=>{switch(d){case"events":return"Note";default:return""}},render:e=>t.jsx(U,{data:e.note,title:"Additional Info"})},expandColumn:W.EXPAND_COLUMN,viewElderly:{render:e=>t.jsxs("span",{onClick:()=>c(e),className:"flex items-center transition-all duration-300 justify-center gap-2 text-sm font-medium text-text-primary hover:text-primary cursor-pointer p-2 rounded-md  text-center hover:bg-slate-100",children:["View ",t.jsx(B,{})]})},action:{title:"Action",render:e=>t.jsx(G,{row:e})}},[i,r]=p.useState(void 0);return p.useEffect(()=>{if(d=="activeAlert"){const e=h.activeAlertsTableData.map(l=>n[l]);r(e)}else if(d=="recentlyClosedAlert"){const e=h.recentlyClosedAlertsTableData.map(l=>n[l]);r(e)}else if(d=="events"){const e=h.eventsTableData.map(l=>n[l]);r(e)}else r([])},[]),i}const b=d=>{const m=["Critical","Info","Warning"],s=["Living Room","Kitchen","Bedroom","Bathroom"],c=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],h=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],n=["Medication Taken","Medication Not Taken","Medication Reminder"],i=["Wheelchair","Crutches","Cane","None"],r=["Yes","No"],e=["Yes","No"],l=["Yes","No"],u=["1","4","2","No"],o=["True","False"];return Array.from({length:d},(a,g)=>({_id:g+1,alertType:m[Math.floor(Math.random()*m.length)],elderlyName:c[Math.floor(Math.random()*c.length)],alertName:h[Math.floor(Math.random()*h.length)],roomId:String(g+1),roomName:s[Math.floor(Math.random()*s.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${h[Math.floor(Math.random()*h.length)]} in the ${s[Math.floor(Math.random()*s.length)]}`,status:"Active",isAlert:o[Math.floor(Math.random()*o.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:c[Math.floor(Math.random()*c.length)],eventName:n[Math.floor(Math.random()*n.length)],disabilityType:i[Math.floor(Math.random()*i.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:r[Math.floor(Math.random()*r.length)],diseases:e[Math.floor(Math.random()*e.length)],medications:l[Math.floor(Math.random()*l.length)],activeAlert:u[Math.floor(Math.random()*u.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};b(14);b(20);b(20);b(20);b(20);const Y="/assets/AlertBGABS-DeBC3eCX.svg";function ne({openAlertCloseModal:d,setOpenAlertCloseModal:m,selectedAlert:s=[],getAlertListDatas:c}){var l,u,o;const{handleSubmit:h,control:n,reset:i,formState:{errors:r}}=$({defaultValues:{status:"",comment:""}});async function e(a){await ee({id:s==null?void 0:s._id,data:{status:a.status.value,comment:a.comment}}).then(g=>{D.custom(v=>t.jsx(P,{t:v,text:"Alert has been marked as resolved!"})),c()}).catch(g=>{D.custom(v=>t.jsx(R,{t:v,title:"Error",text:g.message}))}),i(),m(!1)}return t.jsx(z,{open:d,onCancel:()=>{m(!1),i()},footer:null,children:t.jsxs("div",{id:"alertCloseModalHeader",children:[t.jsx("div",{id:"alertCardOverview",children:t.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((l=f(s))==null?void 0:l.label)==="Critical"?"bg-red-500":((u=f(s))==null?void 0:u.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full !flex justify-between items-center`,children:[t.jsx("div",{id:"leftSide",className:"z-50",children:t.jsx("div",{id:"alertItemHeader",children:t.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-4",children:[t.jsxs("div",{id:"time",className:"flex gap-2",children:[t.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:y(s==null?void 0:s.created_at)}),t.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:K(s==null?void 0:s.created_at)})]}),t.jsx("div",{id:"alertItemTitleAndDescription",children:t.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(o=f(s))==null?void 0:o.title})})]})})}),t.jsx("img",{src:Y,alt:"",className:"absolute top-0 right-0 w-[280px]"})]})}),t.jsx("div",{id:"alertsConfirmationAndComment",className:"mt-4 px-4",children:t.jsxs("form",{onSubmit:h(e),children:[t.jsx(T,{name:"status",control:n,rules:{required:"Please select alert status"},render:({field:a})=>t.jsx(Q,{label:"Alert Status",error:r.status,placeholder:"Select Alert Status",options:[{value:!0,label:"True Alert"},{value:!1,label:"False Alert"}],value:a.value,...a})}),t.jsx(T,{name:"comment",control:n,rules:{},render:({field:a})=>t.jsx(Z,{label:"Comment",placeholder:"Enter your comment",error:r.comment,...a})},"comment"),t.jsxs("div",{id:"alertCloseModalFooter",className:"py-4 flex  gap-4",children:[t.jsx(C,{type:"button",style:{width:"100%",background:"#F5F5F5",color:"#1B2559"},onClick:()=>{m(!1),i()},children:"Close"}),t.jsx(C,{type:"primary",htmlType:"submit",className:"w-full",children:"Mark as Done"})]})]})})]})})}function ye({refreshAlertList:d,isElderlyVisible:m=!1}){const[s,c]=p.useState(!1),[h,n]=p.useState(null),[i,r]=p.useState([]),e=k(),l=p.useCallback(()=>{te({to_date:"2024-11-30",from_date:x().format("YYYY-MM-DD"),is_resolved:!1,limit:20,...X("Critical")}).then(a=>{r(a.data)}).catch(a=>console.error(a))},[]);p.useEffect(()=>{l();const a=setInterval(()=>{l()},5e3);return()=>{clearInterval(a)}},[l]);const u={dots:i.length>=2,infinite:i.length>2,speed:500,slidesToShow:i.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:a=>t.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:t.jsxs("ul",{id:"dots",style:{margin:"0px"},children:[" ",a," "]})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(i.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},o=a=>{window.scrollTo(0,0),e(`/supporter/elderlies/elderly-profile/${a.elderly_id}?tab=overview`)};return t.jsxs(t.Fragment,{children:[ie.length>0&&t.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:t.jsx(q,{...u,className:"w-full transition-all duration-300",children:i.map((a,g)=>{var v,w,j,A,N,M;return t.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:t.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((v=f(a))==null?void 0:v.label)==="Critical"?"bg-red-500":((w=f(a))==null?void 0:w.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full !flex justify-between items-center`,children:[t.jsx("div",{id:"leftSide",className:"z-50",children:t.jsx("div",{id:"alertItemHeader",children:t.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[t.jsxs("div",{id:"time",className:"flex gap-2",children:[m&&t.jsxs("span",{onClick:()=>o(a),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[t.jsx(O,{size:22,style:{opacity:"0.8"}}),a==null?void 0:a.elderly_name]}),t.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[t.jsx("div",{id:"dot",className:`w-2 h-2 ${((j=f(a))==null?void 0:j.label)==="Critical"?"bg-red-500":((A=f(a))==null?void 0:A.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`})," ",y(a.created_at)]}),t.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:t.jsx(S,{date:a.created_at})})]}),t.jsxs("div",{id:"alertItemTitleAndDescription",children:[t.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(N=f(a))==null?void 0:N.title}),t.jsx("p",{className:"text-white text-base m-0 leading-none",children:(M=f(a))==null?void 0:M.message})]})]})})}),t.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:t.jsx("span",{onClick:()=>{n(a),c(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),t.jsx("img",{src:Y,alt:"",className:"absolute top-0 right-0 x-0"})]})},g)})})}),t.jsx(ne,{openAlertCloseModal:s,setOpenAlertCloseModal:c,selectedAlert:h,getAlertListDatas:()=>{l(),d()}})]})}const ie=[{title:"Fall Detected",description:"Fall Detected in the Basement",time:"10:00 AM",duration:"2min 45s ago",alertType:"Critical"},{title:"Fire Detected",description:"Fire Detected in the Kitchen",time:"10:00 AM",duration:"2min 45s ago",alertType:"Critical"}];function be(){const[d,m]=p.useState(x().subtract(6,"days").format("YYYY-MM-DD")),[s,c]=p.useState(x().format("YYYY-MM-DD")),[h,n]=p.useState([]),i=p.useCallback(()=>{ae({from_date:s,to_date:d}).then(e=>{n(e==null?void 0:e.data)}).catch(e=>{console.log(e)})},[s]);p.useEffect(()=>{i()},[i]);function r(e){e?(m(e.start),c(e.end)):(m(x().subtract(6,"days").format("YYYY-MM-DD")),c(x().format("YYYY-MM-DD")))}return t.jsxs("div",{className:"w-full h-full",children:[t.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[t.jsx("h1",{className:"text-[24px] font-bold",children:"Alerts Overview"}),t.jsx("div",{id:"chartController",className:"flex gap-4",children:t.jsx(H,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:t.jsx(se,{style:{height:"fit-content"},handleChange:e=>r(e)})})})]}),t.jsx("div",{className:"w-full h-full",children:t.jsx(le,{data:h,fromDate:d,toDate:s})})]})}export{ye as A,be as a,ne as b,ve as u};
