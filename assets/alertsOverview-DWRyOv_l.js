import{e as u,j as t,am as _,aw as I,a9 as L,r as d,D as E,S as C,u as k,I as g,ap as T,ax as W,ay as F,az as B,au as O,aA as R,as as P,C as $}from"./index-DJPLPkhr.js";import{A as z}from"./AlertName-BVo2p_G-.js";import{A as S,a as U}from"./ActionManu-C5WemPRu.js";import{L as G}from"./LargeTextViewerModal-Dx_C-mS8.js";import{S as H}from"./slick-theme-V1QFm-jN.js";import{a as V,A as J}from"./AlertCloseModal-CUWhOMj_.js";import{g as K,b as X}from"./elderlySupport-CdNLkXnl.js";import{E as q}from"./index-YLV9fS2A.js";import"./line-DmjAVVcl.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},h=new r.Error().stack;h&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[h]="944609c4-ed00-4d0d-b8ff-c45c9071fee5",r._sentryDebugIdIdentifier="sentry-dbid-944609c4-ed00-4d0d-b8ff-c45c9071fee5")}catch{}function Q({data:r=[],fromDate:h,toDate:c}){const n=((a,e)=>{const l=[];let p=u(a);for(;p.isBefore(e)||p.isSame(e,"day");)l.push(p.format("YYYY-MM-DD")),p=p.add(1,"day");return l})(h,c).map(a=>{const e=r.filter(i=>i.date===a&&i.alarm_group==="Critical").reduce((i,x)=>i+x.count,0),l=r.filter(i=>i.date===a&&i.alarm_group==="Warning").reduce((i,x)=>i+x.count,0),p=r.filter(i=>i.date===a&&i.alarm_group==="Info").reduce((i,x)=>i+x.count,0);return{day:u(a).format("ddd"),critical:e,warning:l,problem:p}}),o={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:n.map(a=>a.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:n.map(a=>a.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:n.map(a=>a.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:n.map(a=>a.problem),itemStyle:{color:"#800080"},smooth:!0}]};return r.length?t.jsx(q,{option:o,style:{width:"100% !important",height:"100%"}}):t.jsx("div",{className:"h-full flex items-center w-full justify-center",children:t.jsx(_,{description:"No data available to show"})})}u.extend(I);u.extend(L);const Z=({placeholder:r,style:h,handleChange:c,value:m})=>{const[f,n]=d.useState("This Week"),o=e=>{const l=u(e).startOf("week").format("YYYY-MM-DD"),p=u(e).endOf("week").format("YYYY-MM-DD");return{week:u(e).week(),start:l,end:p}},a=e=>`Week ${o(e).week}`;return d.useEffect(()=>{if(m){const e=u().week(),l=u(m.start).week();l===e-1?n("Last Week"):n(`Week ${l}`)}else n("This Week")},[m]),t.jsx(E,{style:h,placeholder:f,size:"large",format:a,picker:"week",onChange:e=>{if(e){const l=o(e);c(l)}else c(""),n("This Week")}})};function de(r){const{rolesFormatter:h}=d.useContext(C),c=k(),m=e=>{window.scrollTo(0,0),c(`/supporter/elderlies/elderly-profile/${e.elderly_id}?tab=overview`)},f={activeAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLife","address","viewElderly"],recentlyClosedAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLife","alertStatus","closedAt","closedBy","address","viewElderly"],eventsTableData:["eventName","elderlyName","eventTime","place","largeText","status","action"]},n={alertName:{title:"Notification Name",render:e=>t.jsx(z,{data:e})},alertType:{title:"Notification Type",render:e=>{var l;return t.jsx("span",{children:(l=g(e))==null?void 0:l.label})}},elderlyName:{title:"User Name",dataIndex:"elderly_name",render:e=>t.jsx("span",{children:e})},roomName:{title:"Room Name",dataIndex:"room_name",render:e=>t.jsx("span",{children:e})},incidentTime:{title:"Observation Time",dataIndex:"created_at",render:e=>t.jsx("span",{className:"text-nowrap",children:T(e)})},alertLifetime:{title:"Notification Duration",render:e=>t.jsx("span",{className:"text-nowrap",children:W(e==null?void 0:e.created_at,e==null?void 0:e.closed_at)})},alertLife:{title:"Notification Duration",dataIndex:"created_at",render:e=>t.jsx("span",{className:"text-nowrap",children:t.jsx(S,{date:e})})},alertStatus:{title:"Notification Status",dataIndex:"status",render:e=>t.jsx("span",{className:"text-nowrap",children:e==0?"True Notification":"False Notification"})},address:{title:"Address",width:"230px",render:e=>t.jsx("span",{className:"!w-[230px] text-nowrap",children:e.address})},closedAt:{title:"Closed At",dataIndex:"closed_at",render:e=>t.jsx("span",{className:"text-nowrap",children:T(e)})},closedBy:{title:"Closed By",render:e=>t.jsxs("span",{className:"text-nowrap",children:[e.closed_by," (",h[e.closed_by_role]," )"]})},eventName:{title:"Event Name",dataIndex:"event_name",render:e=>t.jsx("span",{children:e})},eventTime:{title:"Event Time",dataIndex:"date_time",render:e=>t.jsx("span",{className:"text-nowrap",children:T(e)})},eventTimeline:{title:"Event Timeline",dataIndex:"alertLifetime",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},disabilityType:{title:"Disability Type",dataIndex:"disabilityType",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},place:{title:"Place",dataIndex:"place",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},status:{title:"Status",dataIndex:"event_status",render:e=>t.jsx("span",{className:"text-nowrap capitalize",children:e!=="open"?e:"Done"})},largeText:{title:()=>{switch(r){case"events":return"Note";default:return""}},render:e=>t.jsx(G,{data:e.note,title:"Additional Info"})},expandColumn:F.EXPAND_COLUMN,viewElderly:{render:e=>t.jsxs("span",{onClick:()=>m(e),className:"flex items-center transition-all duration-300 justify-center gap-2 text-sm font-medium text-text-primary hover:text-primary cursor-pointer p-2 rounded-md  text-center hover:bg-slate-100",children:["View ",t.jsx(B,{})]})},action:{title:"Action",render:e=>t.jsx(U,{row:e})}},[o,a]=d.useState(void 0);return d.useEffect(()=>{if(r=="activeAlert"){const e=f.activeAlertsTableData.map(l=>n[l]);a(e)}else if(r=="recentlyClosedAlert"){const e=f.recentlyClosedAlertsTableData.map(l=>n[l]);a(e)}else if(r=="events"){const e=f.eventsTableData.map(l=>n[l]);a(e)}else a([])},[]),o}const N=r=>{const h=["Critical","Info","Warning"],c=["Living Room","Kitchen","Bedroom","Bathroom"],m=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],f=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],n=["Medication Taken","Medication Not Taken","Medication Reminder"],o=["Wheelchair","Crutches","Cane","None"],a=["Yes","No"],e=["Yes","No"],l=["Yes","No"],p=["1","4","2","No"],i=["True","False"];return Array.from({length:r},(x,M)=>({_id:M+1,alertType:h[Math.floor(Math.random()*h.length)],elderlyName:m[Math.floor(Math.random()*m.length)],alertName:f[Math.floor(Math.random()*f.length)],roomId:String(M+1),roomName:c[Math.floor(Math.random()*c.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${f[Math.floor(Math.random()*f.length)]} in the ${c[Math.floor(Math.random()*c.length)]}`,status:"Active",isAlert:i[Math.floor(Math.random()*i.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:m[Math.floor(Math.random()*m.length)],eventName:n[Math.floor(Math.random()*n.length)],disabilityType:o[Math.floor(Math.random()*o.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:a[Math.floor(Math.random()*a.length)],diseases:e[Math.floor(Math.random()*e.length)],medications:l[Math.floor(Math.random()*l.length)],activeAlert:p[Math.floor(Math.random()*p.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};N(14);N(20);N(20);N(20);N(20);function ce({refreshAlertList:r,isElderlyVisible:h=!1}){d.useContext(C);const[c,m]=d.useState(!1),[f,n]=d.useState(null),[o,a]=d.useState([]),e=["Critical","Warning"],l=k(),{notificationEvent:p}=O(),i=d.useRef(0),x=d.useCallback(async()=>{let s=[],y=30;for(const w of e){if(y<=0)break;const v=P(w);if(v)try{const A=(await K({to_date:"2024-11-30",from_date:u().format("YYYY-MM-DD"),is_resolved:!1,limit:y,...v})).data||[];if(s=[...s,...A],y-=A.length,y<=0)break}catch(b){console.error(`Error fetching ${w} alerts:`,b)}}s.length>i.current&&r(),i.current=s.length,a(s)},[]);d.useEffect(()=>{x()},[x]);const M={dots:o.length>=2,infinite:o.length>2,speed:500,slidesToShow:o.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:s=>t.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:t.jsx("ul",{id:"dots",style:{margin:"0px"},children:s})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(o.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},Y=s=>{window.scrollTo(0,0),l(`/supporter/elderlies/elderly-profile/${s.elderly_id}?tab=overview`)};return d.useEffect(()=>{p&&(console.log(p),x())},[p]),t.jsxs(t.Fragment,{children:[o.length>0&&t.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:t.jsx(H,{...M,className:"w-full transition-all duration-300",children:o.map((s,y)=>{var w,v,b,A,j,D;return t.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:t.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((w=g(s))==null?void 0:w.label)==="Critical"?"bg-red-500":((v=g(s))==null?void 0:v.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full flex justify-between items-center`,children:[t.jsx("div",{id:"leftSide",className:"z-50",children:t.jsx("div",{id:"alertItemHeader",children:t.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[t.jsxs("div",{id:"time",className:"flex gap-2",children:[h&&t.jsxs("span",{onClick:()=>Y(s),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[t.jsx(R,{size:22,style:{opacity:"0.8"}}),s==null?void 0:s.elderly_name]}),t.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[t.jsx("div",{id:"dot",className:`w-2 h-2 ${((b=g(s))==null?void 0:b.label)==="Critical"?"bg-red-500":((A=g(s))==null?void 0:A.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`}),T(s.created_at)]}),t.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:t.jsx(S,{date:s.created_at})})]}),t.jsxs("div",{id:"alertItemTitleAndDescription",children:[t.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(j=g(s))==null?void 0:j.title}),t.jsx("p",{className:"text-white text-base m-0 leading-none",children:(D=g(s))==null?void 0:D.message})]})]})})}),t.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:t.jsx("span",{onClick:()=>{n(s),m(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),t.jsx("img",{src:V,alt:"",className:"absolute top-0 right-0"})]})},y)})})}),t.jsx(J,{openAlertCloseModal:c,setOpenAlertCloseModal:m,selectedAlert:f,getAlertListDatas:()=>{x(),r()}})]})}function me(){const[r,h]=d.useState(u().subtract(6,"days").format("YYYY-MM-DD")),[c,m]=d.useState(u().format("YYYY-MM-DD")),[f,n]=d.useState([]),o=d.useCallback(()=>{X({from_date:c,to_date:r}).then(e=>{n(e==null?void 0:e.data)}).catch(e=>{console.log(e)})},[c]);d.useEffect(()=>{o()},[o]);function a(e){e?(h(e.start),m(e.end)):(h(u().subtract(6,"days").format("YYYY-MM-DD")),m(u().format("YYYY-MM-DD")))}return t.jsxs("div",{className:"w-full h-full",children:[t.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[t.jsx("h1",{className:"text-[24px] font-bold",children:"Overview"}),t.jsx("div",{id:"chartController",className:"flex gap-4",children:t.jsx($,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:t.jsx(Z,{style:{height:"fit-content"},handleChange:e=>a(e)})})})]}),t.jsx("div",{className:"w-full h-full",children:t.jsx(Q,{data:f,fromDate:r,toDate:c})})]})}export{ce as A,me as a,de as u};
//# sourceMappingURL=alertsOverview-DWRyOv_l.js.map
