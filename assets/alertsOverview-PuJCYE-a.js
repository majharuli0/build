import{d as m,j as t,bq as N,r as h,$ as D,u as j,F as C,bv as k,B as Y}from"./index-D0xmOMtE.js";import{A as S}from"./AlertName-DKoaU8y4.js";import{A as I}from"./ActionManu-U28gGkLS.js";import{L}from"./LargeTextViewerModal-DQFAE8dO.js";import{a as g,t as v,c as T,g as _}from"./helper-DzRZPsxz.js";import{S as W}from"./slick-theme-G0iNA-Fj.js";import{a as E,A as F}from"./AlertCloseModal-o6zZAhgT.js";import{g as B,b as O}from"./elderlySupport-CVRAyHaP.js";import{c as P}from"./SwapRightOutlined-DMXrNSIw.js";import{w as R}from"./weekOfYear-BkhFIwP_.js";import{D as $}from"./index-DG0K53Xh.js";import{E as z}from"./index-BxOk_HLZ.js";import"./line-NPKiGGRH.js";function G({data:o=[],fromDate:u,toDate:i}){const s=((r,e)=>{const l=[];let a=m(r);for(;a.isBefore(e)||a.isSame(e,"day");)l.push(a.format("YYYY-MM-DD")),a=a.add(1,"day");return l})(u,i).map(r=>{const e=o.filter(n=>n.date===r&&n.alarm_group==="Critical").reduce((n,f)=>n+f.count,0),l=o.filter(n=>n.date===r&&n.alarm_group==="Warning").reduce((n,f)=>n+f.count,0),a=o.filter(n=>n.date===r&&n.alarm_group==="Info").reduce((n,f)=>n+f.count,0);return{day:m(r).format("ddd"),critical:e,warning:l,problem:a}}),p={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:s.map(r=>r.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:s.map(r=>r.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:s.map(r=>r.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:s.map(r=>r.problem),itemStyle:{color:"#800080"},smooth:!0}]};return o.length?t.jsx(z,{option:p,style:{width:"100% !important",height:"100%"}}):t.jsx("div",{className:"h-full flex items-center w-full justify-center",children:t.jsx(N,{description:"No data available to show"})})}m.extend(P);m.extend(R);const H=({placeholder:o,style:u,handleChange:i,value:d})=>{const[c,s]=h.useState("This Week"),p=e=>{const l=m(e).startOf("week").format("YYYY-MM-DD"),a=m(e).endOf("week").format("YYYY-MM-DD");return{week:m(e).week(),start:l,end:a}},r=e=>`Week ${p(e).week}`;return h.useEffect(()=>{if(d){const e=m().week(),l=m(d.start).week();l===e-1?s("Last Week"):s(`Week ${l}`)}else s("This Week")},[d]),t.jsx($,{style:u,placeholder:c,size:"large",format:r,picker:"week",onChange:e=>{if(e){const l=p(e);i(l)}else i(""),s("This Week")}})};function ne(o){const{rolesFormatter:u}=h.useContext(D),i=j(),d=e=>{window.scrollTo(0,0),i(`/supporter/elderlies/elderly-profile/${e.elderly_id}?tab=overview`)},c={activeAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLifetime","address","viewElderly"],recentlyClosedAlertsTableData:["alertName","alertType","elderlyName","roomName","incidentTime","alertLifetime","alertStatus","closedAt","closedBy","address","viewElderly"],eventsTableData:["eventName","elderlyName","eventTime","place","largeText","status","action"]},s={alertName:{title:"Alert Name",render:e=>t.jsx(S,{data:e})},alertType:{title:"Alert Type",render:e=>{var l;return t.jsx("span",{children:(l=g(e))==null?void 0:l.label})}},elderlyName:{title:"Elderly Name",dataIndex:"elderly_name",render:e=>t.jsx("span",{children:e})},roomName:{title:"Room Name",dataIndex:"room_name",render:e=>t.jsx("span",{children:e})},incidentTime:{title:"Incident Time",dataIndex:"created_at",render:e=>t.jsx("span",{className:"text-nowrap",children:v(e)})},alertLifetime:{title:"Alert Life",dataIndex:"closed_at",render:e=>t.jsx("span",{className:"text-nowrap",children:T(e)})},alertStatus:{title:"Alert Status",dataIndex:"status",render:e=>t.jsx("span",{className:"text-nowrap",children:e==0?"True Alert":"False Alert"})},address:{title:"Address",width:"230px",render:e=>t.jsx("span",{className:"!w-[230px] text-nowrap",children:e.address})},closedAt:{title:"Closed At",dataIndex:"closed_at",render:e=>t.jsx("span",{className:"text-nowrap",children:v(e)})},closedBy:{title:"Closed By",render:e=>t.jsxs("span",{className:"text-nowrap",children:[e.closed_by," (",u[e.closed_by_role]," )"]})},eventName:{title:"Event Name",dataIndex:"event_name",render:e=>t.jsx("span",{children:e})},eventTime:{title:"Event Time",dataIndex:"date_time",render:e=>t.jsx("span",{className:"text-nowrap",children:v(e)})},eventTimeline:{title:"Event Timeline",dataIndex:"alertLifetime",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},disabilityType:{title:"Disability Type",dataIndex:"disabilityType",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},place:{title:"Place",dataIndex:"place",render:e=>t.jsx("span",{className:"text-nowrap",children:e})},status:{title:"Status",dataIndex:"event_status",render:e=>t.jsx("span",{className:"text-nowrap capitalize",children:e!=="open"?e:"Done"})},largeText:{title:()=>{switch(o){case"events":return"Note";default:return""}},render:e=>t.jsx(L,{data:e.note,title:"Additional Info"})},expandColumn:C.EXPAND_COLUMN,viewElderly:{render:e=>t.jsxs("span",{onClick:()=>d(e),className:"flex items-center transition-all duration-300 justify-center gap-2 text-sm font-medium text-text-primary hover:text-primary cursor-pointer p-2 rounded-md  text-center hover:bg-slate-100",children:["View ",t.jsx(k,{})]})},action:{title:"Action",render:e=>t.jsx(I,{row:e})}},[p,r]=h.useState(void 0);return h.useEffect(()=>{if(o=="activeAlert"){const e=c.activeAlertsTableData.map(l=>s[l]);r(e)}else if(o=="recentlyClosedAlert"){const e=c.recentlyClosedAlertsTableData.map(l=>s[l]);r(e)}else if(o=="events"){const e=c.eventsTableData.map(l=>s[l]);r(e)}else r([])},[]),p}const w=o=>{const u=["Critical","Info","Warning"],i=["Living Room","Kitchen","Bedroom","Bathroom"],d=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],c=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],s=["Medication Taken","Medication Not Taken","Medication Reminder"],p=["Wheelchair","Crutches","Cane","None"],r=["Yes","No"],e=["Yes","No"],l=["Yes","No"],a=["1","4","2","No"],n=["True","False"];return Array.from({length:o},(f,x)=>({_id:x+1,alertType:u[Math.floor(Math.random()*u.length)],elderlyName:d[Math.floor(Math.random()*d.length)],alertName:c[Math.floor(Math.random()*c.length)],roomId:String(x+1),roomName:i[Math.floor(Math.random()*i.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${c[Math.floor(Math.random()*c.length)]} in the ${i[Math.floor(Math.random()*i.length)]}`,status:"Active",isAlert:n[Math.floor(Math.random()*n.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:d[Math.floor(Math.random()*d.length)],eventName:s[Math.floor(Math.random()*s.length)],disabilityType:p[Math.floor(Math.random()*p.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:r[Math.floor(Math.random()*r.length)],diseases:e[Math.floor(Math.random()*e.length)],medications:l[Math.floor(Math.random()*l.length)],activeAlert:a[Math.floor(Math.random()*a.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};w(14);w(20);w(20);w(20);w(20);function ie({refreshAlertList:o}){const[u,i]=h.useState(!1),[d,c]=h.useState(null),[s,p]=h.useState([]),r=["Critical","Warning","Info"],e=h.useCallback(async()=>{let a=[],n=20;for(const f of r){if(n<=0)break;const x=_(f);if(x)try{const y=(await B({to_date:m().subtract(2,"days").format("YYYY-MM-DD"),from_date:m().format("YYYY-MM-DD"),is_resolved:!1,limit:n,...x})).data||[];if(a=[...a,...y],n-=y.length,n<=0)break}catch(A){console.error(`Error fetching ${f} alerts:`,A)}}p(a)},[]);h.useEffect(()=>{e();const a=setInterval(()=>{e()},5e3);return()=>{clearInterval(a)}},[e]);const l={dots:s.length>=2,infinite:s.length>2,speed:500,slidesToShow:s.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:a=>t.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:t.jsxs("ul",{id:"dots",style:{margin:"0px"},children:[" ",a," "]})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(s.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]};return t.jsxs(t.Fragment,{children:[J.length>0&&t.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:t.jsx(W,{...l,className:"w-full transition-all duration-300",children:s.map((a,n)=>{var f,x,A,y,M,b;return t.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:t.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((f=g(a))==null?void 0:f.label)==="Critical"?"bg-red-500":((x=g(a))==null?void 0:x.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full !flex justify-between items-center`,children:[t.jsx("div",{id:"leftSide",className:"z-50",children:t.jsx("div",{id:"alertItemHeader",children:t.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[t.jsxs("div",{id:"time",className:"flex gap-2",children:[t.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[t.jsx("div",{id:"dot",className:`w-2 h-2 ${((A=g(a))==null?void 0:A.label)==="Critical"?"bg-red-500":((y=g(a))==null?void 0:y.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`})," ",v(a.created_at)]}),t.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:T(a.created_at)})]}),t.jsxs("div",{id:"alertItemTitleAndDescription",children:[t.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(M=g(a))==null?void 0:M.title}),t.jsx("p",{className:"text-white text-base m-0 leading-none",children:(b=g(a))==null?void 0:b.message})]})]})})}),t.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:t.jsx("span",{onClick:()=>{c(a),i(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),t.jsx("img",{src:E,alt:"",className:"absolute top-0 right-0 x-0"})]})},n)})})}),t.jsx(F,{openAlertCloseModal:u,setOpenAlertCloseModal:i,selectedAlert:d,getAlertListDatas:()=>{e(),o()}})]})}const J=[{title:"Fall Detected",description:"Fall Detected in the Basement",time:"10:00 AM",duration:"2min 45s ago",alertType:"Critical"},{title:"Fire Detected",description:"Fire Detected in the Kitchen",time:"10:00 AM",duration:"2min 45s ago",alertType:"Critical"}];function oe(){const[o,u]=h.useState(m().subtract(6,"days").format("YYYY-MM-DD")),[i,d]=h.useState(m().format("YYYY-MM-DD")),[c,s]=h.useState([]),p=h.useCallback(()=>{O({from_date:i,to_date:o}).then(e=>{s(e==null?void 0:e.data)}).catch(e=>{console.log(e)})},[i]);h.useEffect(()=>{p()},[p]);function r(e){e?(u(e.start),d(e.end)):(u(m().subtract(6,"days").format("YYYY-MM-DD")),d(m().format("YYYY-MM-DD")))}return t.jsxs("div",{className:"w-full h-full",children:[t.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[t.jsx("h1",{className:"text-[24px] font-bold",children:"Alerts Overview"}),t.jsx("div",{id:"chartController",className:"flex gap-4",children:t.jsx(Y,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:t.jsx(H,{style:{height:"fit-content"},handleChange:e=>r(e)})})})]}),t.jsx("div",{className:"w-full h-full",children:t.jsx(G,{data:c,fromDate:o,toDate:i})})]})}export{ie as A,oe as a,ne as u};
