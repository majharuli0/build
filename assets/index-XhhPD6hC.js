import{u as Q,r as l,ag as C,ae as z,j as n,Z as I,$ as J,e as R,ad as k,a4 as X,ah as L,af as Z}from"./index-DioY2D19.js";import"./alertsOverview-1JHfcOlk.js";import{u as K,D,a as ee}from"./RoomMap4-B0DclUUG.js";import{g as A,t as te,d as ne,b as re}from"./helper-BpYgKHye.js";import{A as se}from"./ActionManu-CwIZSPi4.js";import{g as ie}from"./elderlySupport-DIdGTrk2.js";import{S as le}from"./index-DvaYlt4e.js";import{C as H}from"./Collapse-DSvFpOGD.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="34f04082-a28e-45ae-8b7c-75c393a9db6b",e._sentryDebugIdIdentifier="sentry-dbid-34f04082-a28e-45ae-8b7c-75c393a9db6b")}catch{}function ce({data:e={}}){var h,T,_,N,S,v,w;const s=Q(),[c,g]=l.useState(null),d=l.useRef(null),m=l.useRef(!1),[x,u]=l.useState(!1),f=l.useRef,p=b=>{switch(b){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};l.useEffect(()=>{var i;const b=(i=e==null?void 0:e.rooms)==null?void 0:i.device_no;return b&&(d.current&&d.current!==b&&C({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(t=>console.error(`Error unsubscribing: ${t}`)),z({uid:b,messageType:["1","2","3","4"],topics:{pub:[b]}}).then(()=>{}).catch(t=>console.error(`Error subscribing: ${t}`)),d.current=b),()=>{d.current&&C({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(t=>console.error(`Error during cleanup unsubscribe: ${t}`))}},[e]);function y(b){var r;const t=[...ne(b)];((r=t[0])==null?void 0:r.postureIndex)===4&&m.current&&(t[0].postureIndex=6,t[0].posture="Resident on Bed",t[0].color="#252F67"),g(t)}function j(){u(!0),m.current=!0,clearTimeout(f.current),f.current=setTimeout(()=>{u(!1),m.current=!1},5e3)}return K({onMessage:b=>{var t,r;const i=(t=JSON.parse(b==null?void 0:b.message))==null?void 0:t.payload;(i==null?void 0:i.deviceCode)===((r=e==null?void 0:e.rooms)==null?void 0:r.device_no)&&(i!=null&&i.position||i!=null&&i.heartbreath)&&(i!=null&&i.position&&y(i.position),i!=null&&i.heartbreath&&j())},dependencies:[e]}),n.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[n.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${p((h=A(e))==null?void 0:h.label)}`,children:[n.jsx("div",{className:"loader"}),n.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[n.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),n.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(T=A(e))==null?void 0:T.title})]}),n.jsx("span",{onClick:()=>{s(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[n.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),n.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),n.jsx("div",{})]}),n.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[n.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((_=e==null?void 0:e.rooms)==null?void 0:_.mount_type)===1&&((N=e==null?void 0:e.rooms)==null?void 0:N.is_device_bind)&&n.jsx(D,{roomInfo:e==null?void 0:e.rooms,position:c}),((S=e==null?void 0:e.rooms)==null?void 0:S.mount_type)===2&&((v=e==null?void 0:e.rooms)==null?void 0:v.is_device_bind)&&n.jsx(ee,{roomInfo:e==null?void 0:e.rooms,position:c}),!((w=e==null?void 0:e.rooms)!=null&&w.is_device_bind)&&n.jsx("span",{className:"w-full h-full flex items-center justify-center",children:n.jsx("p",{children:" No Device Data Available"})})]}),n.jsxs("div",{className:"details-container w-1/3 ",children:[n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:te(e.created_at)}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:n.jsx(se,{date:e.created_at})}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}function ae(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var U=ae,oe=typeof I=="object"&&I&&I.Object===Object&&I,de=oe,ue=de,fe=typeof self=="object"&&self&&self.Object===Object&&self,be=ue||fe||Function("return this")(),V=be,ge=V,me=function(){return ge.Date.now()},he=me,xe=/\s/;function pe(e){for(var s=e.length;s--&&xe.test(e.charAt(s)););return s}var ve=pe,je=ve,ye=/^\s+/;function Te(e){return e&&e.slice(0,je(e)+1).replace(ye,"")}var _e=Te,Se=V,we=Se.Symbol,Y=we,M=Y,q=Object.prototype,Ne=q.hasOwnProperty,$e=q.toString,$=M?M.toStringTag:void 0;function Ie(e){var s=Ne.call(e,$),c=e[$];try{e[$]=void 0;var g=!0}catch{}var d=$e.call(e);return g&&(s?e[$]=c:delete e[$]),d}var Ae=Ie,Ee=Object.prototype,Oe=Ee.toString;function Ce(e){return Oe.call(e)}var Re=Ce,B=Y,ke=Ae,Le=Re,Me="[object Null]",Be="[object Undefined]",P=B?B.toStringTag:void 0;function Pe(e){return e==null?e===void 0?Be:Me:P&&P in Object(e)?ke(e):Le(e)}var We=Pe;function Fe(e){return e!=null&&typeof e=="object"}var Ge=Fe,He=We,Ue=Ge,Ve="[object Symbol]";function Ye(e){return typeof e=="symbol"||Ue(e)&&He(e)==Ve}var qe=Ye,Qe=_e,W=U,ze=qe,F=NaN,Je=/^[-+]0x[0-9a-f]+$/i,Xe=/^0b[01]+$/i,Ze=/^0o[0-7]+$/i,Ke=parseInt;function De(e){if(typeof e=="number")return e;if(ze(e))return F;if(W(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=W(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=Qe(e);var c=Xe.test(e);return c||Ze.test(e)?Ke(e.slice(2),c?2:8):Je.test(e)?F:+e}var et=De,tt=U,E=he,G=et,nt="Expected a function",rt=Math.max,st=Math.min;function it(e,s,c){var g,d,m,x,u,f,p=0,y=!1,j=!1,h=!0;if(typeof e!="function")throw new TypeError(nt);s=G(s)||0,tt(c)&&(y=!!c.leading,j="maxWait"in c,m=j?rt(G(c.maxWait)||0,s):m,h="trailing"in c?!!c.trailing:h);function T(r){var a=g,o=d;return g=d=void 0,p=r,x=e.apply(o,a),x}function _(r){return p=r,u=setTimeout(v,s),y?T(r):x}function N(r){var a=r-f,o=r-p,O=s-a;return j?st(O,m-o):O}function S(r){var a=r-f,o=r-p;return f===void 0||a>=s||a<0||j&&o>=m}function v(){var r=E();if(S(r))return w(r);u=setTimeout(v,N(r))}function w(r){return u=void 0,h&&g?T(r):(g=d=void 0,x)}function b(){u!==void 0&&clearTimeout(u),p=0,g=f=d=u=void 0}function i(){return u===void 0?x:w(E())}function t(){var r=E(),a=S(r);if(g=arguments,d=this,f=r,a){if(u===void 0)return _(f);if(j)return clearTimeout(u),u=setTimeout(v,s),T(f)}return u===void 0&&(u=setTimeout(v,s)),x}return t.cancel=b,t.flush=i,t}var lt=it;const ct=J(lt),{Panel:at}=H;function pt(){l.useState("All");const[e,s]=l.useState([]),[c,g]=l.useState(null),[d,m]=l.useState(null),[x,u]=l.useState(null),[f,p]=l.useState(!1),[y,j]=l.useState(1),[h,T]=l.useState(!0),_=l.useRef(null),N=l.useCallback(()=>{!h||f||(p(!0),ie({to_date:"2024-11-30",from_date:R().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:y,...x}).then(t=>{s(r=>[...r,...t.data]),y>=t.totalPages&&T(!1),p(!1)}).catch(t=>{console.error(t),p(!1)}))},[x,y,h,f]);l.useEffect(()=>{N()},[y,x]),l.useEffect(()=>{if(e.length>0&&!c){const t=e[0];g(t._id),m(t)}},[e,c]);const S=t=>{g(t);const r=e.find(a=>a._id===t);m(r)},v=l.useCallback(ct(()=>{if(!_.current||f||!h)return;const{scrollTop:t,scrollHeight:r,clientHeight:a}=_.current;t+a>=r-50&&j(o=>o+1)},200),[f,h]),w=t=>{u(re(t)),j(1),s([]),T(!0)};l.useEffect(()=>{const t=_.current;return t&&t.addEventListener("scroll",v),()=>{t&&t.removeEventListener("scroll",v)}},[v]);const b=l.useMemo(()=>e.reduce((t,r)=>{const a=r.room_name;return t[a]||(t[a]=[]),t[a].push(r),t},{}),[e]),i=t=>{switch(t){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return n.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[n.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[n.jsx(le,{style:{width:"100%"},block:!0,options:ot,onChange:t=>w(t)}),n.jsxs("div",{ref:_,className:"w-full overflow-auto",style:{height:"440px"},children:[e.length===0&&!f&&n.jsx(k,{description:"No active alerts available"}),e.length>0&&n.jsx(H,{children:Object.entries(b).map(([t,r])=>{const a=[...new Set(r.map(o=>A(o).label))];return n.jsx(at,{header:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-black font-semibold",children:t}),n.jsx(X,{children:a.map(o=>n.jsx(L,{color:i(o)},o))})]}),children:r.map(o=>n.jsxs("div",{onClick:()=>S(o._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${c===o._id?"bg-gray-100":""}`,children:[n.jsx("span",{className:"text-[14px] font-semibold",children:R(o.created_at).format("hh:mm:ss a")}),n.jsx(L,{color:i(A(o).label),size:"large"})]},o._id))},t)})}),f&&n.jsx("div",{className:"w-full flex justify-center py-4",children:n.jsx(Z,{})}),!h&&e.length>0&&n.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),n.jsx("div",{className:"w-[70%] h-full",children:d?n.jsx(ce,{data:d}):n.jsx(k,{description:"Select an alert to view details"})})]})}const ot=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{pt as R};
//# sourceMappingURL=index-XhhPD6hC.js.map
