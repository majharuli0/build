import{r as i,j as e,fA as R}from"./index-C-3yAPic.js";import p from"./LiveRateChart-DEG94SsM.js";import{C as N}from"./UseCustomContext-yShnAv3k.js";import{b as w}from"./helper-DmUrDoc-.js";import"./index-DWsenQFU.js";function _(){var h,v,b;const{elderlyDetails:n,sleepData:t}=i.useContext(N),d=n==null?void 0:n.deviceId,[u,x]=i.useState({time:[],heartRate:[],breathRate:[]}),[r,m]=i.useState(null),[f,j]=i.useState(Date.now()),g=s=>{const o=w(s);m(o),j(Date.now())};return i.useEffect(()=>{const s=setInterval(()=>{if(Date.now()-f>5e3)m(null),x({time:[],heartRate:[],breathRate:[]});else if(r){const a=new Date().toLocaleTimeString();x(l=>({time:[...l.time,a].slice(-30),heartRate:[...l.heartRate,r.heartRateValue].slice(-30),breathRate:[...l.breathRate,r.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(s)},[r,f]),i.useEffect(()=>{const s=new WebSocket("wss://live.elderlycareplatform.com/ws/");return s.onopen=()=>{console.log("Connected to WebSocket server")},s.onmessage=o=>{var l;const c=JSON.parse(o==null?void 0:o.data),a=(l=JSON.parse(c==null?void 0:c.message))==null?void 0:l.payload;(a==null?void 0:a.deviceCode)===d&&(a!=null&&a.heartbreath)&&g(a.heartbreath)},s.onerror=o=>{},s.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>s.close()},[d]),e.jsxs("div",{className:"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"Live Breath Rate"}),e.jsx("div",{id:"LiveRate",className:"flex flex-col gap-1 pl-3 mb-2",children:e.jsxs("div",{className:"text-4xl font-bold flex items-center gap-2",style:{color:"#FFA54D"},children:[(r==null?void 0:r.breathingValue)??"--"," ",e.jsx("span",{className:"text-secondary/40",children:"BPM"}),e.jsx(R,{color:"#FFA54D",size:24})]})}),e.jsx(p,{data:u,color:"#FFA54D",type:"breathRate"}),e.jsx("div",{id:"footer",children:e.jsxs("div",{className:"flex justify-evenly items-center",children:[e.jsxs("div",{id:"avgRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsx("div",{className:"text-3xl text-primary font-bold",children:(h=t==null?void 0:t.breath_rate_vo)==null?void 0:h.avg}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Avg. Rate"})]}),e.jsxs("div",{id:"minRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(v=t==null?void 0:t.breath_rate_vo)==null?void 0:v.min]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Min Rate"})]}),e.jsxs("div",{id:"maxRate",className:"flex flex-col items-center justify-center gap-0",children:[e.jsxs("div",{className:"text-3xl text-primary font-bold",children:[" ",(b=t==null?void 0:t.breath_rate_vo)==null?void 0:b.max]}),e.jsx("div",{className:"text-sm text-gray-500 font-semibold",children:"Max Rate"})]})]})})]})}export{_ as default};
