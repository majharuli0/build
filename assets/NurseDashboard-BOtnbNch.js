import{r as s,j as e,b2 as te,b1 as se,b3 as le,b4 as ae,b5 as Q,b6 as ne,b7 as ie,u as re,ah as Z,e as H,b8 as b,b9 as ce,ba as K,bb as w,bc as oe,bd as de,be as ue,bf as fe,am as xe,bg as he,af as W,G as ge,bh as X,aZ as pe,bi as be,U as me,C as je,a_ as ve,Z as U,ad as G}from"./index-CRdRT3H9.js";import{A as we,a as ye}from"./alertsOverview-DLmZ-z3T.js";import"./WeeklyMonthlyPicker-D17QJiS9.js";import{C as Ce}from"./CreateAndEditModal-Dx5zaow-.js";import{R as Ae}from"./AimOutlined-1L2DdTO-.js";import{R as _e}from"./HomeOutlined-Cwyv9rVO.js";import"./index-DGYdUOGx.js";import"./leaflet-src-fOPAf0Ht.js";import"./leaflet-6q39rauI.js";import"./InfoCircleOutlined-DDjFYe2J.js";try{let c=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},h=new c.Error().stack;h&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[h]="839da3a7-ed26-4637-8c21-89e63786f645",c._sentryDebugIdIdentifier="sentry-dbid-839da3a7-ed26-4637-8c21-89e63786f645")}catch{}function Ne({rooms:c=[]}){const[h,j]=s.useState({}),t=s.useRef({}),v=s.useRef({}),S=s.useRef({});console.log(c);const C={dots:c.length>=2,infinite:c.length>2,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:l=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsxs("ul",{id:"dots",style:{margin:"0px"},children:[" ",l," "]})})};return s.useCallback((l,r)=>{var g;const f=te(l);v.current[r]&&((g=f[0])==null?void 0:g.postureIndex)===4&&(f[0].postureIndex=6,f[0].posture="Resident on Bed",f[0].color="#252F67"),j(x=>({...x,[r]:{...x[r],peopleData:f}}))},[]),s.useCallback(l=>{v.current[l]=!0,S.current[l]=Date.now(),t.current[l]&&clearTimeout(t.current[l]),t.current[l]=setTimeout(()=>{v.current[l]=!1,j(r=>{var f,g;return{...r,[l]:{...r[l],peopleData:(g=(f=r[l])==null?void 0:f.peopleData)==null?void 0:g.map(x=>({...x,postureIndex:x.postureIndex===6?4:x.postureIndex,posture:x.postureIndex===6?"Standing":x.posture,color:x.postureIndex===6?"#A7E2FE":x.color}))}}})},5e3),j(r=>({...r,[l]:{...r[l],heartBreathRateActive:!0}}))},[]),e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("div",{id:"rooms",className:"w-full mb-2 transition-all duration-300 h-full",children:e.jsx(se,{...C,className:"w-full transition-all duration-300 h-full",children:c.map((l,r)=>e.jsxs("div",{className:"px-2 overflow-hidden transition-all duration-300 w-full h-[355px] ",children:[e.jsxs("div",{id:"roomNmaeAndStatus",className:"flex items-center gap-2 w-fit bg-white pr-4 py-1.5 border border-gray-200 p-2 rounded-full absolute top-2 left-2",children:[e.jsx("div",{id:"dot",className:"size-3 rounded-full",style:{backgroundColor:(l==null?void 0:l.is_device_bind)===!0?"green":"red"}}),e.jsx("p",{children:l==null?void 0:l.name})]}),(l==null?void 0:l.is_device_bind)&&(l==null?void 0:l.mount_type)===2&&e.jsx(le,{roomInfo:l}),(l==null?void 0:l.is_device_bind)&&(l==null?void 0:l.mount_type)===1&&e.jsx(ae,{roomInfo:l}),!(l!=null&&l.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:"No Device Data Available"})})]},r))})}),c.length===0&&e.jsx(Q,{description:"No Room Found "})]})}function Se({style:c,rooms:h}){var y;const j=((y=h==null?void 0:h.rooms)==null?void 0:y.length)>0?h.rooms.filter(u=>u.device_no).map(u=>u.device_no).join(","):"",{deviceData:t}=s.useContext(ne),v=j?j.split(",").map(u=>u.trim()):[],[S,C]=s.useState({time:[],heartRate:[],breathRate:[]}),[l,r]=s.useState(null),[f,g]=s.useState(Date.now()),x=u=>{const m=ie(u);r(m),g(Date.now())};return s.useEffect(()=>{const u=setInterval(()=>{if(Date.now()-f>5e3)r(null),C({time:[],heartRate:[],breathRate:[]});else if(l){const D=new Date().toLocaleTimeString();C(A=>({time:[...A.time,D].slice(-30),heartRate:[...A.heartRate,l.heartRateValue].slice(-30),breathRate:[...A.breathRate,l.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(u)},[l,f]),s.useEffect(()=>{if(!v.length){r(null);return}for(const u of[v]){if(!t[u])continue;const{heartBreath:m}=t[u];if(m){console.log(u),x(m);return}}r(null)},[t]),e.jsxs("div",{id:"liveHeartAndBreathRate",className:"flex w-fit py-4 gap-8",children:[e.jsxs("div",{id:"heartRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${c.textColor}  text-nowrap`,children:[(l==null?void 0:l.heartRateValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${c.textColor} opacity-80 text-nowrap`,children:"Heart Activity"})]}),e.jsxs("div",{id:"breathRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${c.textColor}  text-nowrap`,children:[(l==null?void 0:l.breathingValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${c.textColor} opacity-80  text-nowrap`,children:"Breathing Pattern"})]})]})}function De({refreshAlertList:c,roomList:h=[],loadingsData:j}){var L,E,k,F,R;const[t,v]=s.useState(null),S=re(),[C,l]=s.useState(!1),[r,f]=s.useState(null),[g,x]=s.useState({textColor:"text-white",bodyColor:"text-white",txtc:"#fff",bgc:"#fff"});s.useState({time:[],heartRate:[],breathRate:[]}),s.useState(null),s.useState(Date.now());const[y,u]=s.useState([]),[m,N]=s.useState(!1),[D,A]=s.useState(1);s.useState(!0);const M=s.useRef(null),_=s.useCallback(()=>{m||(N(!0),Z({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t==null?void 0:t._id,limit:20,page:D}).then(a=>{u(i=>[...i,...a.data]),N(!1)}).catch(a=>{N(!1),console.error(a)}))},[t==null?void 0:t._id,D]);s.useEffect(()=>{t!=null&&t._id&&(u([]),A(1))},[t==null?void 0:t._id]),s.useEffect(()=>{t!=null&&t._id&&_()},[_]);const $=()=>{const{scrollTop:a,scrollHeight:i,clientHeight:o}=M.current;a+o>=i-10&&!m&&A(d=>d+1)};s.useEffect(()=>{var a,i,o,d;t&&x({textColor:((a=b(t))==null?void 0:a.label)!=="Critical"?"text-primary":"text-white",bodyColor:((i=b(t))==null?void 0:i.label)!=="Critical"?"text-primary":"text-white",txtc:((o=b(t))==null?void 0:o.label)!=="Critical"?"#fff":"#000",bgc:((d=b(t))==null?void 0:d.label)!=="Critical"?"#fff":"#000"})},[t]),s.useEffect(()=>{var i;const a=((i=t==null?void 0:t.rooms)==null?void 0:i.length)>0?t.rooms.filter(o=>o.device_no).map(o=>o.device_no).join(", "):"";a&&t&&a.split(", ").forEach(d=>{ce({uid:d,messageType:["1","2","3","4"],topics:{pub:[d]}}).then(p=>{console.log(`Subscription for Device No ${d}:`,p)}).catch(p=>{console.log(`Error for Device No ${d}:`,p)})})},[t]);const V=a=>{window.scrollTo(0,0),S(`/supporter/elderlies/elderly-profile/${a==null?void 0:a._id}`)},I=()=>{var i;const a=((i=t==null?void 0:t.rooms)==null?void 0:i.length)>0?t.rooms.filter(o=>o.device_no).map(o=>o.device_no).join(", "):"";a&&t&&a.split(", ").forEach(d=>{he({uid:d,messageType:["1","2","3","4"]}).then(p=>{}).catch(p=>{console.log(`Error unsubscribing for Device No ${d}:`,p)})}),v(null)};return j?e.jsx(e.Fragment,{children:j&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx(K,{})})}):h.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"NurseRoomView",className:"w-full h-full relative",children:[e.jsx("div",{className:"w-full h-full grid grid-cols-10  overflow-auto",children:h==null?void 0:h.map((a,i)=>{var o,d,p;return e.jsx(w.div,{layoutId:a==null?void 0:a._id,onClick:()=>v(a),className:`text-white text-base ${((o=b(a==null?void 0:a.alarms_data[0]))==null?void 0:o.label)==="Critical"?"bg-[#FF1D1D] animate-scaleUpDown1":((d=b(a==null?void 0:a.alarms_data[0]))==null?void 0:d.label)==="Warning"?"bg-[#FF9831] animate-scaleUpDown2":((p=b(a==null?void 0:a.alarms_data[0]))==null?void 0:p.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6] !text-primary"}  rounded-lg cursor-pointer flex justify-center m-2 items-center font-semibold min-w-[55px] min-h-[65px] h-fit `,children:e.jsx(w.h5,{children:(a==null?void 0:a.room_no)||"--"})},i)})}),e.jsx(oe,{deviceId:((L=t==null?void 0:t.rooms)==null?void 0:L.length)>0?t==null?void 0:t.rooms.filter(a=>a.device_no).map(a=>a.device_no).join(","):"",children:e.jsx(de,{children:t&&e.jsx(w.div,{className:"absolute inset-0 flex justify-center items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(w.div,{className:"bg-black bg-opacity-50 w-full h-full flex justify-center items-center",onClick:()=>I(),children:e.jsxs(w.div,{className:`${((E=b(t))==null?void 0:E.label)==="Critical"?"bg-[#FF1D1D]":((k=b(t))==null?void 0:k.label)==="Warning"?"bg-[#FF9831]":((F=b(t))==null?void 0:F.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6]"} p-4 rounded-xl w-[95%] h-[90%]`,onClick:a=>a.stopPropagation(),layoutId:t==null?void 0:t._id,children:[e.jsxs(w.div,{className:"flex justify-between items-start",children:[" ",e.jsx("div",{className:"w-[65%] flex items-start cursor-pointer bg-white hover:bg-white/75 rounded-xl transition-all duration-300 ease-in",onClick:()=>V(t),children:e.jsxs("div",{id:"elderly-profile",className:"flex items-center w-full  justify-between px-4 ",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col items-start w-full gap-1",children:[e.jsx("h2",{className:`text-xl font-bold ${g.textColor} text-center text-nowrap m-0  leading-none`,children:t==null?void 0:t.name}),e.jsxs("h2",{className:`text-base font-medium ${g.textColor} opacity-80 text-center text-nowrap m-0 leading-none`,children:["Age: ",e.jsx("span",{children:t==null?void 0:t.age})]})]})}),e.jsx(Se,{style:g,rooms:t})]})}),e.jsx(w.button,{className:"p-2 bg-black/5  hover:bg-black/10 rounded-full",onClick:()=>I(),children:e.jsx(ue,{size:24,className:g.textColor})})]}),e.jsxs(w.div,{className:"flex h-[80%] items-center mt-2",children:[e.jsx(w.div,{className:"h-full  w-[65%] bg-white rounded-xl flex flex-col items-center justify-center",children:e.jsx(Ne,{rooms:(R=t==null?void 0:t.rooms)==null?void 0:R.filter(a=>a.device_no)})}),e.jsxs(w.div,{className:"h-full w-[35%] rounded-xl p-2 border-1 overflow-y-auto overflow-x-hidden gap-2 flex flex-col pt-0",ref:M,onScroll:$,children:[y==null?void 0:y.map((a,i)=>{var o,d;return e.jsxs("div",{className:"flex items-center gap-2 w-[350px] bg-white p-2 rounded-lg cursor-pointer ",onClick:()=>{var p;((p=b(a))==null?void 0:p.label)!=="Info"&&(f(a),l(!0))},children:[e.jsx("div",{id:"Icon",className:"w-[38px] h-[38px]",children:(o=b(a))!=null&&o.icon?e.jsx("img",{src:b(a).icon,alt:"Alert Icon",width:38,height:38,className:"min-w-[38px]"}):null}),e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"w-fit",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:(d=b(a))==null?void 0:d.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:fe(a==null?void 0:a.created_at)})]})})]},i)}),y.length===0&&!m&&e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(Q,{description:"No alerts available to show"})}),m&&e.jsx("div",{className:"h-full w-full flex flex-col justify-center items-center",children:e.jsx(K,{})})]})]})]})})})})})]}),e.jsx(xe,{openAlertCloseModal:C,setOpenAlertCloseModal:l,selectedAlert:r,getAlertListDatas:()=>{_(),c()}})]}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(Q,{description:"No room available to show"})})}function $e(){s.useState("Map View");const[c,h]=s.useState(!1);s.useState([]);const j=W("activeAlert"),t=W("recentlyClosedAlert"),v=W("events");s.useState(ge.get("user"));const[S,C]=s.useState([]),[l,r]=s.useState(!0),[f,g]=s.useState([]),[x,y]=s.useState([]),[u,m]=s.useState(1),[N,D]=s.useState(1),[A,M]=s.useState([]),[_,$]=s.useState([]);s.useState({}),s.useState({});const[V,I]=s.useState(!0),[L,E]=s.useState(!0),[k,F]=s.useState(),[R,a]=s.useState(),[i,o]=s.useState(""),[d,p]=s.useState(!1),Y=s.useCallback(()=>{E(!0),Z({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!1,...u,...X("Critical")}).then(n=>{M(n==null?void 0:n.data),a(n==null?void 0:n.total),E(!1)}).catch(n=>{E(!1)})},[u]);s.useEffect(()=>{Y()},[Y]);const B=s.useCallback(()=>{I(!0),Z({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!0,page:N,...X("Critical")}).then(n=>{$(n.data),I(!1)}).catch(n=>{console.log(n),I(!1)})},[N]);s.useEffect(()=>{B()},[B]);const z=s.useCallback(()=>{pe({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),page:x}).then(n=>{n.data.length>0&&g(n.data)}).catch(n=>{console.log(n)})},[x]);s.useEffect(()=>{z()},[z]);const O=s.useCallback(()=>{r(!0),be().then(n=>{C(n.data),r(!1)}).catch(n=>{console.log(n),r(!1)})},[]);s.useEffect(()=>{O()},[O]);function q(){Y(),B(),O()}const J=s.useCallback(()=>{if(i.trim()===""){F([]);return}me({search:i}).then(n=>{F(n==null?void 0:n.data)}).catch(n=>{console.log(n)})},[i]);s.useEffect(()=>{J()},[J]);const T=(n,P)=>{if(!P)return n;const ee=new RegExp(`(${P})`,"gi");return n.replace(ee,'<mark style="background-color: #80CAA7; color: white;">$1</mark>')};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 flex-col pt-8 pb-8",children:[e.jsx("div",{className:"flex item-center justify-between w-full",children:e.jsx(je,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsxs("div",{className:"w-[350px] relative",children:[e.jsx(ve,{className:"rounded-[10px]  min-w-[350px] w-full ",size:"large",placeholder:"Search Anything",style:{height:"44px"},onChange:n=>o(n.target.value),onFocus:()=>p(!0)}),d&&i.trim()!==""&&e.jsx("div",{id:"searchResult",className:"mt-3 max-h-[600px] overflow-auto rounded-lg shadow-lg bg-white border border-gray-300 absolute top-10 left-0 z-[1000] w-full",children:e.jsx("ul",{children:k==null?void 0:k.map(n=>e.jsxs("li",{className:"p-4 hover:bg-gray-100 border-b border-gray-200 cursor-pointer",onClick:()=>{navigate(`/supporter/elderlies/elderly-profile/${n==null?void 0:n._id}`)},children:[e.jsx("div",{className:"font-semibold text-lg text-gray-800",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:T(n.name,i)}})}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Age:"})," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:T(n.age.toString(),i)}})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Address:"})," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:T(n.address||"N/A",i)}})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Sensitivity Factors:"})," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:T(n.diseases.join(", "),i)}})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Comments:"})," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:T(n.comments.map(P=>P.comment).join(", "),i)}})]})]},n._id))})})]})})}),e.jsx("div",{className:"w-full",children:e.jsx(we,{refreshAlertList:q,isElderlyVisible:!0})}),e.jsxs("div",{className:"w-full flex flex-col gap-4 lg3:flex-row",children:[e.jsx("div",{className:"w-full p-0",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 h-[650px] flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-5",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Room View"})}),e.jsx("div",{className:"w-full h-full overflow-y-auto rounded-xl",children:e.jsx(De,{refreshAlertList:q,roomList:S,loadingsData:l})})]})}),e.jsx("div",{className:"bg-white w-full lg3:w-[48%] rounded-2xl p-6 h-[650px] overflow-hidden",children:e.jsx(ye,{})})]}),e.jsxs("div",{id:"Active_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Active_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Active Notifications"}),e.jsx("div",{})]}),e.jsx("div",{id:"Active_Alerts_Table",className:"w-full",children:e.jsx(U.Provider,{value:{total:R,page:1,SetPage:m},children:e.jsx(G,{pageSize:6,loading:L,tableData:A,columns:j})})})]}),e.jsxs("div",{id:"Recently_Closed_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Recently_Closed_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Past Notifications"}),e.jsx("div",{})]}),e.jsx("div",{id:"Recently_Closed_Alerts_Table",className:"w-full",children:e.jsx(U.Provider,{value:{total:_==null?void 0:_.length,page:1,SetPage:D},children:e.jsx(G,{pageSize:6,loading:V,tableData:_,columns:t})})})]}),e.jsxs("div",{id:"Events",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsx("div",{id:"Events_Header",className:"w-full flex justify-between",children:e.jsx("h1",{className:"text-[24px] font-bold",children:"Events"})}),e.jsx("div",{id:"Events_Table",className:"w-full",children:e.jsx(U.Provider,{value:{total:f==null?void 0:f.length,page:1,SetPage:y,getList:()=>z},children:e.jsx(G,{pageSize:6,tableData:f,columns:v})})})]})]}),e.jsx(Ce,{modalOpen:c,setModalOpen:h,type:"event"})]})}const Ve=[{label:" Map View",value:"Map View",icon:e.jsx(Ae,{})},{label:"Room View",value:"Room View",icon:e.jsx(_e,{})}],Ye=[{label:"All Alerts",value:"All Alerts"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Informational",value:"Info"}];export{Ye as activeAlertSegmentOptions,Ve as alertViewSegmentOptions,$e as default};
//# sourceMappingURL=NurseDashboard-BOtnbNch.js.map
