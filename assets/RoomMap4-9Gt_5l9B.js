import{r as c,j as g}from"./index-CnZYSSOF.js";import{S as M,L as q,a as C,I as E,C as F}from"./to-C-nZNVPk.js";import{C as G}from"./UseCustomContext-BhgaKMIb.js";import{f as I,O as J,w as K,s as $,a as Q,b as U,c as V,l as Z}from"./RoomMap3-BiL8PluH.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new t.Error().stack;i&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[i]="1190f786-a945-49d1-ac18-07fc05b71563",t._sentryDebugIdIdentifier="sentry-dbid-1190f786-a945-49d1-ac18-07fc05b71563")}catch{}function ne({url:t="wss://live.elderlycareplatform.com/ws/",onOpen:i,onMessage:y,onError:b,onClose:w,dependencies:S=[]}){const d=c.useRef(null);return c.useEffect(()=>{const l=new WebSocket(t);return d.current=l,l.onopen=()=>{console.log("Connected to WebSocket server"),i==null||i(l)},l.onmessage=x=>{try{const m=JSON.parse(x.data);y==null||y(m,l)}catch(m){console.error("Error parsing WebSocket message:",m)}},l.onerror=x=>{console.error("WebSocket error:",x),b==null||b(x,l)},l.onclose=()=>{console.log("Disconnected from WebSocket server"),w==null||w(l)},()=>l.close()},S),d.current}const ie=({roomInfo:t=[],position:i=[]})=>{const y=c.useContext(G),{elderlyDetails:b}=y||{};t!=null&&t.room_no||(b==null||b.deviceId);const[w,S]=c.useState(null),d=c.useRef(),[l,x]=c.useState(1),m=600,j=500,[H,R]=c.useState(600),[N,X]=c.useState(500),[ee,Y]=c.useState(0),[te,L]=c.useState(0),[_,W]=c.useState({up_left:[0,0],low_left:[0,0],up_right:[0,0],low_right:[0,0],mount_type:"wall"}),k={0:null,1:K,2:$,3:Q,4:U,5:V,6:Z},[D,P]=c.useState([]),v=10,f={x:30*v,y:0},p=(e=[0,0])=>{if(!Array.isArray(e)||e.length<2)throw new Error("Invalid input: coords must be an array with at least two elements.");const[s=0,u=0]=e;return[f.x-s*v,f.y+u*v]},O=[...p(_.up_left),...p(_.low_left),...p(_.low_right),...p(_.up_right)],[T,z]=c.useState({});c.useEffect(()=>{(()=>{const s={};i==null||i.forEach(u=>{const o=k[u.postureIndex];if(o){const n=new window.Image;n.src=o,n.onload=()=>{s[o]=n,z(r=>({...r,...s}))}}})})()},[i]),c.useEffect(()=>{var u;if(t!=null&&t.device_boundaries&&typeof t.device_boundaries=="object"){const o=Object.fromEntries(Object.entries(t.device_boundaries).reduce((n,[r,a])=>(r==="_id"||n.push([r,a.split(",").map(Number)]),n),[]));W(o)}else console.error("device_boundaries is undefined or not an object"),W({});const e=(u=t==null?void 0:t.device_areas)==null?void 0:u.map(({_id:o,coordKey:n,...r})=>({...r,up_left:r.up_left.split(",").map(Number),low_left:r.low_left.split(",").map(Number),up_right:r.up_right.split(",").map(Number),low_right:r.low_right.split(",").map(Number)}));P(e);const s=new window.Image;s.src=I,s.onload=()=>{S(s)}},[t]);const A=e=>{const s=[],[u,o,n,r]=[Math.min(...e.filter((a,h)=>h%2===0)),Math.max(...e.filter((a,h)=>h%2===0)),Math.min(...e.filter((a,h)=>h%2!==0)),Math.max(...e.filter((a,h)=>h%2!==0))];for(let a=n+10;a<r;a+=10)s.push([u,a,o,a]);for(let a=u+10;a<o;a+=10)s.push([a,n,a,r]);return s};return c.useEffect(()=>{const e=()=>{if(d.current){const u=d.current.clientWidth/m,o=d.current.clientHeight/j,n=Math.min(u,o);x(n);const r=d.current.clientWidth,a=d.current.clientHeight;R(r),X(a);const h=(r-m*n)/2,B=(a-j*n)/2;Y(h),L(B)}};e();const s=new ResizeObserver(e);return d.current&&s.observe(d.current),()=>{s&&s.disconnect()}},[m,j]),g.jsx("div",{ref:d,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",margin:"0 auto",maxHeight:"500px",maxWidth:"600px"},children:g.jsx(M,{width:H||600,height:N||500,scaleX:l,scaleY:l,children:g.jsxs(q,{children:[g.jsx(C,{points:O,closed:!0,stroke:"rgba(250, 181, 21, 1",strokeWidth:2,dash:[10,5],fill:"rgba(250, 181, 21, 0.2)",opacity:.4}),A(O).map((e,s)=>g.jsx(C,{points:e,stroke:"rgba(250, 181, 21, 1",strokeWidth:.5,dash:[2,3]},s)),D&&D.map((e,s)=>g.jsx(J,{roomType:t==null?void 0:t.name,object:e,convertCoords:p},s)),w&&g.jsx(E,{image:w,x:f.x-50/2,y:f.y-50/2,width:50,height:50}),i==null?void 0:i.map((e,s)=>g.jsxs(g.Fragment,{children:[g.jsx(F,{x:f.x-e.coordinates.x*10,y:f.y+e.coordinates.y*10,radius:18,fill:e.color},`circle-${s}`),e.postureIndex&&g.jsx(E,{image:T[k[e.postureIndex]],x:f.x-e.coordinates.x*10-15,y:f.y+e.coordinates.y*10-15,width:30,height:30})]}))]})})})};export{ie as D,ne as u};
//# sourceMappingURL=RoomMap4-9Gt_5l9B.js.map
