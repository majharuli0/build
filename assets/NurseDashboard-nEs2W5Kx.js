import{bN as Oe,bO as q,ah as Pe,ai as Fe,am as ee,al as ze,bP as Te,an as Ee,r,ae as Be,bQ as He,bR as Ye,bS as Ue,bT as Ve,ag as J,ad as $,bU as Ge,as as We,aw as qe,bV as Je,bW as Ke,bX as Xe,bY as Qe,j as e,aZ as Y,bi as ae,l as Ze,q as U,B as F,bZ as de,b_ as ge,J as K,b$ as re,c0 as et,c1 as te,c2 as tt,c3 as st,c4 as ot,c5 as he,c6 as nt,c7 as it,c8 as at,c9 as rt,ca as be,cb as z,cc as lt,cd as ve,ce as ct,cf as je,cg as ye,ch as Ne,ci as _e,cj as dt,ck as we,cl as Ce,cm as Se,cn as mt,T as ft,co as ut,cp as Ie,cq as Q,cr as le,cs as pt,S as se,ct as xt,i as E,s as $e,aL as gt,cu as ht,bL as bt,cv as vt,u as jt,cw as Re,cx as De,cy as yt,cz as ke,cA as Nt,C as _t,D as wt,cB as Ct,cC as St,aP as It,cD as $t,cE as fe,cF as W,cG as Rt,cH as Dt,cI as kt,cJ as Mt,cK as At,cL as Lt,cM as Ot,cN as Pt,cO as Z,cP as Ft,cQ as zt,cR as Tt,cS as Et,cT as Bt}from"./index-BySX3t96.js";import{S as Ht}from"./index-SHoddRVv.js";import"./Steps-B3uY1WW8.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="ff20737d-df92-4e19-86db-70fd3a5e06d9",t._sentryDebugIdIdentifier="sentry-dbid-ff20737d-df92-4e19-86db-70fd3a5e06d9")}catch{}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ut=Oe("circle",Yt),Vt=t=>{const{componentCls:s,notificationMarginEdge:o,animationMaxHeight:n}=t,p=`${s}-notice`,c=new q("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),d=new q("antNotificationTopFadeIn",{"0%":{top:-n,opacity:0},"100%":{top:0,opacity:1}}),x=new q("antNotificationBottomFadeIn",{"0%":{bottom:t.calc(n).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),g=new q("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[s]:{[`&${s}-top, &${s}-bottom`]:{marginInline:0,[p]:{marginInline:"auto auto"}},[`&${s}-top`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:d}},[`&${s}-bottom`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:x}},[`&${s}-topRight, &${s}-bottomRight`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:c}},[`&${s}-topLeft, &${s}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:o,_skip_check_:!0},[p]:{marginInlineEnd:"auto",marginInlineStart:0},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:g}}}}},Gt=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],Wt={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},qt=(t,s)=>{const{componentCls:o}=t;return{[`${o}-${s}`]:{[`&${o}-stack > ${o}-notice-wrapper`]:{[s.startsWith("top")?"top":"bottom"]:0,[Wt[s]]:{value:0,_skip_check_:!0}}}}},Jt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={overflow:"hidden",[`& > ${t.componentCls}-notice`]:{opacity:0,transition:`opacity ${t.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${t.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},s)},Kt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={background:t.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},s)},Xt=t=>{const{componentCls:s}=t;return Object.assign({[`${s}-stack`]:{[`& > ${s}-notice-wrapper`]:Object.assign({transition:`transform ${t.motionDurationSlow}, backdrop-filter 0s`,willChange:"transform, opacity",position:"absolute"},Jt(t))},[`${s}-stack:not(${s}-stack-expanded)`]:{[`& > ${s}-notice-wrapper`]:Object.assign({},Kt(t))},[`${s}-stack${s}-stack-expanded`]:{[`& > ${s}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${t.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:t.margin,width:"100%",insetInline:0,bottom:t.calc(t.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},Gt.map(o=>qt(t,o)).reduce((o,n)=>Object.assign(Object.assign({},o),n),{}))},Qt=t=>{const{iconCls:s,componentCls:o,boxShadow:n,fontSizeLG:p,notificationMarginBottom:c,borderRadiusLG:d,colorSuccess:x,colorInfo:g,colorWarning:y,colorError:f,colorTextHeading:j,notificationBg:h,notificationPadding:C,notificationMarginEdge:v,notificationProgressBg:N,notificationProgressHeight:w,fontSize:a,lineHeight:i,width:l,notificationIconSize:m,colorText:u}=t,b=`${o}-notice`;return{position:"relative",marginBottom:c,marginInlineStart:"auto",background:h,borderRadius:d,boxShadow:n,[b]:{padding:C,width:l,maxWidth:`calc(100vw - ${ee(t.calc(v).mul(2).equal())})`,overflow:"hidden",lineHeight:i,wordWrap:"break-word"},[`${b}-message`]:{color:j,fontSize:p,lineHeight:t.lineHeightLG},[`${b}-description`]:{fontSize:a,color:u,marginTop:t.marginXS},[`${b}-closable ${b}-message`]:{paddingInlineEnd:t.paddingLG},[`${b}-with-icon ${b}-message`]:{marginInlineStart:t.calc(t.marginSM).add(m).equal(),fontSize:p},[`${b}-with-icon ${b}-description`]:{marginInlineStart:t.calc(t.marginSM).add(m).equal(),fontSize:a},[`${b}-icon`]:{position:"absolute",fontSize:m,lineHeight:1,[`&-success${s}`]:{color:x},[`&-info${s}`]:{color:g},[`&-warning${s}`]:{color:y},[`&-error${s}`]:{color:f}},[`${b}-close`]:Object.assign({position:"absolute",top:t.notificationPaddingVertical,insetInlineEnd:t.notificationPaddingHorizontal,color:t.colorIcon,outline:"none",width:t.notificationCloseButtonSize,height:t.notificationCloseButtonSize,borderRadius:t.borderRadiusSM,transition:`background-color ${t.motionDurationMid}, color ${t.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center",background:"none",border:"none","&:hover":{color:t.colorIconHover,backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive}},Ee(t)),[`${b}-progress`]:{position:"absolute",display:"block",appearance:"none",inlineSize:`calc(100% - ${ee(d)} * 2)`,left:{_skip_check_:!0,value:d},right:{_skip_check_:!0,value:d},bottom:0,blockSize:w,border:0,"&, &::-webkit-progress-bar":{borderRadius:d,backgroundColor:"rgba(0, 0, 0, 0.04)"},"&::-moz-progress-bar":{background:N},"&::-webkit-progress-value":{borderRadius:d,background:N}},[`${b}-actions`]:{float:"right",marginTop:t.marginSM}}},Zt=t=>{const{componentCls:s,notificationMarginBottom:o,notificationMarginEdge:n,motionDurationMid:p,motionEaseInOut:c}=t,d=`${s}-notice`,x=new q("antNotificationFadeOut",{"0%":{maxHeight:t.animationMaxHeight,marginBottom:o},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[s]:Object.assign(Object.assign({},ze(t)),{position:"fixed",zIndex:t.zIndexPopup,marginRight:{value:n,_skip_check_:!0},[`${s}-hook-holder`]:{position:"relative"},[`${s}-fade-appear-prepare`]:{opacity:"0 !important"},[`${s}-fade-enter, ${s}-fade-appear`]:{animationDuration:t.motionDurationMid,animationTimingFunction:c,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${s}-fade-leave`]:{animationTimingFunction:c,animationFillMode:"both",animationDuration:p,animationPlayState:"paused"},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationPlayState:"running"},[`${s}-fade-leave${s}-fade-leave-active`]:{animationName:x,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${d}-actions`]:{float:"left"}}})},{[s]:{[`${d}-wrapper`]:Object.assign({},Qt(t))}}]},es=t=>({zIndexPopup:t.zIndexPopupBase+Te+50,width:384}),ts=t=>{const s=t.paddingMD,o=t.paddingLG;return Fe(t,{notificationBg:t.colorBgElevated,notificationPaddingVertical:s,notificationPaddingHorizontal:o,notificationIconSize:t.calc(t.fontSizeLG).mul(t.lineHeightLG).equal(),notificationCloseButtonSize:t.calc(t.controlHeightLG).mul(.55).equal(),notificationMarginBottom:t.margin,notificationPadding:`${ee(t.paddingMD)} ${ee(t.paddingContentHorizontalLG)}`,notificationMarginEdge:t.marginLG,animationMaxHeight:150,notificationStackLayer:3,notificationProgressHeight:2,notificationProgressBg:`linear-gradient(90deg, ${t.colorPrimaryBorderHover}, ${t.colorPrimary})`})},ss=Pe("Notification",t=>{const s=ts(t);return[Zt(s),Vt(s),Xt(s)]},es);function Me(t,s){return s===null||s===!1?null:s||r.createElement(Be,{className:`${t}-close-icon`})}const os={success:Ve,info:Ue,error:Ye,warning:He},ns=t=>{const{prefixCls:s,icon:o,type:n,message:p,description:c,actions:d,role:x="alert"}=t;let g=null;return o?g=r.createElement("span",{className:`${s}-icon`},o):n&&(g=r.createElement(os[n]||null,{className:J(`${s}-icon`,`${s}-icon-${n}`)})),r.createElement("div",{className:J({[`${s}-with-icon`]:g}),role:x},g,r.createElement("div",{className:`${s}-message`},p),c&&r.createElement("div",{className:`${s}-description`},c),d&&r.createElement("div",{className:`${s}-actions`},d))};function is(t,s,o){let n;switch(t){case"top":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:s,bottom:"auto"};break;case"topLeft":n={left:0,top:s,bottom:"auto"};break;case"topRight":n={right:0,top:s,bottom:"auto"};break;case"bottom":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:o};break;case"bottomLeft":n={left:0,top:"auto",bottom:o};break;default:n={right:0,top:"auto",bottom:o};break}return n}function as(t){return{motionName:`${t}-fade`}}function rs(t,s,o){return typeof t<"u"?t:o==null?void 0:o.closeIcon}var ls=function(t,s){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,n=Object.getOwnPropertySymbols(t);p<n.length;p++)s.indexOf(n[p])<0&&Object.prototype.propertyIsEnumerable.call(t,n[p])&&(o[n[p]]=t[n[p]]);return o};const ue=24,cs=4.5,ds="topRight",ms=({children:t,prefixCls:s})=>{const o=Ke(s),[n,p,c]=ss(s,o);return n($.createElement(Xe,{classNames:{list:J(p,c,o)}},t))},fs=(t,{prefixCls:s,key:o})=>$.createElement(ms,{prefixCls:s,key:o},t),us=$.forwardRef((t,s)=>{const{top:o,bottom:n,prefixCls:p,getContainer:c,maxCount:d,rtl:x,onAllRemoved:g,stack:y,duration:f,pauseOnHover:j=!0,showProgress:h}=t,{getPrefixCls:C,getPopupContainer:v,notification:N,direction:w}=r.useContext(We),[,a]=qe(),i=p||C("notification"),l=k=>is(k,o??ue,n??ue),m=()=>J({[`${i}-rtl`]:x??w==="rtl"}),u=()=>as(i),[b,S]=Je({prefixCls:i,style:l,className:m,motion:u,closable:!0,closeIcon:Me(i),duration:f??cs,getContainer:()=>(c==null?void 0:c())||(v==null?void 0:v())||document.body,maxCount:d,pauseOnHover:j,showProgress:h,onAllRemoved:g,renderNotifications:fs,stack:y===!1?!1:{threshold:typeof y=="object"?y==null?void 0:y.threshold:void 0,offset:8,gap:a.margin}});return $.useImperativeHandle(s,()=>Object.assign(Object.assign({},b),{prefixCls:i,notification:N})),S});function ps(t){const s=$.useRef(null);return Ge(),[$.useMemo(()=>{const n=x=>{var g;if(!s.current)return;const{open:y,prefixCls:f,notification:j}=s.current,h=`${f}-notice`,{message:C,description:v,icon:N,type:w,btn:a,actions:i,className:l,style:m,role:u="alert",closeIcon:b,closable:S}=x,k=ls(x,["message","description","icon","type","btn","actions","className","style","role","closeIcon","closable"]),B=i??a,O=Me(h,rs(b,t,j));return y(Object.assign(Object.assign({placement:(g=void 0)!==null&&g!==void 0?g:ds},k),{content:$.createElement(ns,{prefixCls:h,icon:N,type:w,message:C,description:v,actions:B,role:u}),className:J(w&&`${h}-${w}`,l,j==null?void 0:j.className),style:Object.assign(Object.assign({},j==null?void 0:j.style),m),closeIcon:O,closable:S??!!O}))},c={open:n,destroy:x=>{var g,y;x!==void 0?(g=s.current)===null||g===void 0||g.close(x):(y=s.current)===null||y===void 0||y.destroy()}};return["success","info","warning","error"].forEach(x=>{c[x]=g=>n(Object.assign(Object.assign({},g),{type:x}))}),c},[]),$.createElement(us,Object.assign({key:"notification-holder"},t,{ref:s}))]}function xs(t){return ps(t)}function gs({isvisible:t,setVisible:s,id:o,firstAlarm:n}){var i;const p=()=>{s(!1),d([]),g(1),f(!1),h(!1)},[c,d]=r.useState([]),[x,g]=r.useState(1),[y,f]=r.useState(!1),[j,h]=r.useState(!1),[C,v]=r.useState(!1),N=r.useCallback(async(l=1,m=!1)=>{var u;m?v(!0):h(!0);try{const b=await Qe(o,{page:l,limit:50}),S=((u=b==null?void 0:b.data[0])==null?void 0:u.logs_before_resovle)||[];d(m?k=>[...k,...S]:S),f(S.length===50),m||g(1)}catch(b){console.log(b)}finally{h(!1),v(!1)}},[o]),w=()=>{const l=x+1;g(l),N(l,!0)};r.useEffect(()=>{o&&t&&N(1,!1)},[o,t,N]);const a=[...n?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(n.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:((i=Y(n))==null?void 0:i.title)||"Alarm Triggered"}),key:"first-alarm"}]:[],...c.map((l,m)=>{var u;return{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(l.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:(u=Y(l))==null?void 0:u.title}),key:`log-${m}`}}),...n!=null&&n.closed_at?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(n.closed_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:"Alarm Resolved"}),key:"resolved"}]:[]];return e.jsx(Ze,{open:t,onCancel:p,footer:null,centered:!0,className:"!w-[60vw] max-h-[90svh] bg-white !border-none overflow-x-hidden rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-[24px] font-semibold",children:"Alarm Logs"}),j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(U,{size:"large"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ht,{progressDot:!0,current:a.length,direction:"vertical",items:a,className:"max-h-[70vh] overflow-y-auto"}),C&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(U,{size:"small"})}),y&&!C&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(F,{type:"primary",onClick:w,className:"load-more-btn",children:"Load More"})}),c.length===0&&!n&&!j&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No logs found"})]})]})})}function hs({data:t={}}){var x,g,y,f,j,h,C;const{deviceData:s}=r.useContext(de),o=r.useContext(ge),{elderlyDetails:n}=o||{},p=(t==null?void 0:t.device_no)||(n==null?void 0:n.deviceId),c=r.useMemo(()=>{var v;return((v=s[p])==null?void 0:v.position)||[]},[(x=s[p])==null?void 0:x.position]),d=r.useMemo(()=>{const v=s[p],N=v==null?void 0:v.hbstaticsTimestamp,w=Date.now();return!(v!=null&&v.hbstatics)||!N||(w-N)/1e3>90?null:v.hbstatics},[s[p]]);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit",children:[(c==null?void 0:c.length)>0?e.jsx(K,{color:"white",overlayInnerStyle:{color:"black",padding:"10px"},title:c==null?void 0:c.map((v,N)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-2 rounded-full",children:e.jsx(re,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-[14px] m-0",children:v==null?void 0:v.posture})})]},N)),children:e.jsx("div",{className:"flex -space-x-4 cursor-pointer",children:c==null?void 0:c.map((v,N)=>e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-1 rounded-full border-2 border-white",children:e.jsx(re,{size:16,color:"white"})},N))})}):e.jsx("div",{className:"bg-primary p-1 rounded-full border-2 border-white",children:e.jsx(re,{size:16,color:"white"})}),e.jsx("span",{className:"font-bold text-[14px]",children:c?c==null?void 0:c.length:0})]}),(t==null?void 0:t.room_type)==2&&d&&e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit px-2 py-1",children:[e.jsx("div",{className:"pr-1",children:e.jsx(et,{size:20,color:`${(f=(y=(g=te(d))==null?void 0:g.statusEvents)==null?void 0:y.sleepState)==null?void 0:f.color}`})}),e.jsx("span",{className:"font-semibold",children:((C=(h=(j=te(d))==null?void 0:j.statusEvents)==null?void 0:h.sleepState)==null?void 0:C.label)||"--"})]})]})}function bs({data:t={},elderlyId:s}){const[o,n]=r.useState(!1),[p,c]=r.useState(!1),[d,x]=r.useState(null),g=r.useCallback(()=>{c(!0),tt({room_id:t==null?void 0:t.device_no,elderly_id:s}).then(f=>{x(f.data)}).catch(f=>console.log(f)).finally(()=>{c(!1)})},[t==null?void 0:t.device_no,s]);r.useEffect(()=>{g()},[g]);function y(f){f&&rt(f)}return e.jsxs("div",{className:"flex flex-col gap-2 h-full mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-[20px] font-medium",children:t==null?void 0:t.name}),e.jsx(hs,{data:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{icon:e.jsx(st,{}),onClick:()=>y(t==null?void 0:t.device_no),children:[" ","Call"]}),e.jsxs(F,{icon:e.jsx(ot,{}),onClick:()=>n(!0),children:[" ","Settings"]})]})]}),e.jsxs(U,{spinning:p,className:"relative",children:[(t==null?void 0:t.is_device_bind)==!1&&e.jsx("div",{className:"w-full h-full absolute bg-slate-400/20 top-0 z-10 backdrop-blur-sm flex items-center justify-center rounded-2xl",children:e.jsx(he,{size:40,color:"red"})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 h-full w-full border border-gray-200 rounded-2xl overflow-hidden relative z-1",children:[(t==null?void 0:t.mount_type)===2&&e.jsx(nt,{roomInfo:d}),(t==null?void 0:t.mount_type)===1&&e.jsx(it,{roomInfo:d})]})]}),e.jsx(at,{isvisible:o,setVisible:n,elderly_id:s,device_id:t==null?void 0:t.device_no,room_id:t==null?void 0:t._id})]})}const vs=r.forwardRef(({className:t,inset:s,children:o,...n},p)=>e.jsxs(be,{ref:p,className:z("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...n,children:[o,e.jsx(lt,{className:"ml-auto"})]}));vs.displayName=be.displayName;const js=r.forwardRef(({className:t,...s},o)=>e.jsx(ve,{ref:o,className:z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));js.displayName=ve.displayName;const ys=r.forwardRef(({className:t,sideOffset:s=4,...o},n)=>e.jsx(ct,{children:e.jsx(je,{ref:n,sideOffset:s,className:z("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...o})}));ys.displayName=je.displayName;const Ns=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(ye,{ref:n,className:z("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...o}));Ns.displayName=ye.displayName;const _s=r.forwardRef(({className:t,children:s,checked:o,...n},p)=>e.jsxs(Ne,{ref:p,className:z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:o,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(_e,{children:e.jsx(dt,{className:"h-4 w-4"})})}),s]}));_s.displayName=Ne.displayName;const ws=r.forwardRef(({className:t,children:s,...o},n)=>e.jsxs(we,{ref:n,className:z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(_e,{children:e.jsx(Ut,{className:"h-2 w-2 fill-current"})})}),s]}));ws.displayName=we.displayName;const Cs=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(Ce,{ref:n,className:z("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...o}));Cs.displayName=Ce.displayName;const Ss=r.forwardRef(({className:t,...s},o)=>e.jsx(Se,{ref:o,className:z("-mx-1 my-1 h-px bg-muted",t),...s}));Ss.displayName=Se.displayName;function Is({data:t={}}){var x,g,y,f;const[s,o]=r.useState(!1),[n,p]=r.useState(!1),c=(t==null?void 0:t.response_details)||((x=t==null?void 0:t.response_details)==null?void 0:x.length)>0&&(t==null?void 0:t.response_details[0])||null;function d(){o(!0)}return e.jsxs("div",{className:"p-4 border border-gray-200 rounded-md w-full",children:[e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h2",{className:"text-[18px] font-semibold",children:(g=Y(t))==null?void 0:g.title}),e.jsx("div",{className:"size-2 bg-slate-400 rounded-xl"}),e.jsx("span",{className:"text-[13px] font-medium opacity-80",children:mt(t==null?void 0:t.created_at)})]}),e.jsxs("div",{children:[t!=null&&t.res_time?e.jsxs(ft,{color:"purple",className:"font-semibold",children:[ut((t==null?void 0:t.res_time)||0)," Resp. Time"]}):null,(t==null?void 0:t.event)==2&&e.jsx(K,{title:"Fall Playback",children:e.jsx(F,{shape:"circle",onClick:()=>d(),icon:e.jsx(Ie,{})})})]})]}),e.jsx("div",{className:"bg-[#80CAA7]/5 mt-6 border border-[#0091DA] cursor-pointer hover:bg-[#0091DA]/10 rounded-sm",onClick:()=>p(!0),children:e.jsxs(Q,{separator:">",className:"text-[#0091DA] p-3",children:[e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(t==null?void 0:t.created_at)]})," ",(y=Y(t))==null?void 0:y.title]})}),c&&c!==null&&e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(c==null?void 0:c.created_at)]})," ",(f=Y(c))==null?void 0:f.title]})}),(t==null?void 0:t.closed_at)&&e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(t==null?void 0:t.closed_at)]})," Alarm Resolved"]})})]})})]}),e.jsx(pt,{isvisible:s,setVisible:o,data:t}),n&&e.jsx(gs,{isvisible:n,setVisible:p,id:t==null?void 0:t._id,firstAlarm:t})]})}function $s({id:t}){const[s,o]=$.useState(!1),[n,p]=$.useState([]),[c,d]=$.useState(0),[x,g]=$.useState(1),y=5,{resolvedAlarm:f,setResolvedAlarm:j}=r.useContext(se),h=$.useCallback((N=1)=>{o(!0),xt({room_id:t,page:N,limit:y,to_date:E().format("YYYY-MM-DD")}).then(w=>{p(N===1?w.data||[]:a=>[...a,...w.data||[]]),d(w.total)}).catch(w=>{console.error(w)}).finally(()=>o(!1))},[t,f]);$.useEffect(()=>{t&&(g(1),h(1))},[t,h]);const C=()=>{const N=x+1;g(N),h(N)},v=n.length<c;return e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Today’s Alarm Logs"}),e.jsx("hr",{className:"w-full m-0"})]}),(n==null?void 0:n.length)===0&&!s?e.jsx($e,{description:"Alarm Logs Not Available For Today",className:"mt-4"}):e.jsxs("div",{className:"flex flex-col w-full gap-3",children:[n==null?void 0:n.map((N,w)=>e.jsx(Is,{data:N},w)),s&&e.jsx("div",{className:"flex justify-center my-2",children:e.jsx(U,{})}),!s&&v&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(F,{onClick:C,children:"Load More"})})]})]})}function Rs({elderlyId:t}){const[s,o]=r.useState([]),n=["Critical"],p=r.useCallback(async()=>{const d=[];let x=10;for(const g of n){if(x<=0)break;const y=ht(g);if(y)try{const j=(await gt({to_date:"2024-11-30",from_date:E().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t,limit:x,lookup:!1,...y})).data||[];if(d.push(...j),x-=j.length,x<=0)break}catch(f){console.error(`Error fetching ${g} alerts:`,f)}}o(d)},[t]);r.useEffect(()=>{t&&(p(),console.log(s))},[p,t]);const c={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,centerMode:!1,variableWidth:!1,adaptiveHeight:!0,appendDots:d=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"5px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:d})})};return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(bt,{...c,className:"w-full transition-all duration-300",children:s==null?void 0:s.map((d,x)=>(console.log(d),e.jsx(vt,{item:d,onResolved:()=>p()},x+1)))})})})}const Ds=({open:t,setOpen:s,data:o})=>{var c,d,x,g,y,f,j;const n=()=>s(!1),p=jt();return e.jsx(Re,{deviceId:((c=o==null?void 0:o.details)==null?void 0:c.length)>0?(d=o==null?void 0:o.details)==null?void 0:d.filter(h=>h.device_no).map(h=>h.device_no).join(","):"",children:e.jsxs(De,{title:null,onClose:n,closeIcon:e.jsx(ke,{size:24}),size:"large",className:"relative ",open:t,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pt-2 pb-4 fixed w-[calc(736px-48px)] top-[calc(57px)] bg-white z-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:(o==null?void 0:o.name)||"Name not found"}),e.jsx("p",{className:"text-lg text-gray-600",children:(o==null?void 0:o.room)||"Room No. Not Found"})]}),e.jsx(F,{size:"large",icon:e.jsx(yt,{}),iconPosition:"end",type:"primary",onClick:()=>{window.scrollTo(0,0),p(`/supporter/elderlies/elderly-profile/${o.id}?tab=overview`)},children:"View Profile"})]}),e.jsx("div",{className:"mt-[77px]"}),e.jsx(Rs,{elderlyId:o==null?void 0:o.id}),e.jsxs("div",{className:"mb-8 mt-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Room Map"}),e.jsx("hr",{className:"w-full m-0"})]}),(x=o==null?void 0:o.details)==null?void 0:x.filter(h=>h==null?void 0:h.device_no).map((h,C)=>e.jsx(bs,{data:h,elderlyId:o==null?void 0:o.id},C)),((y=(g=o==null?void 0:o.details)==null?void 0:g.filter(h=>h==null?void 0:h.device_no))==null?void 0:y.length)==0&&e.jsx($e,{description:"No Room",className:"mt-4"})]}),e.jsx("div",{className:"mb-8 mt-8",children:e.jsx($s,{id:(j=(f=o==null?void 0:o.details)==null?void 0:f.filter(h=>(h==null?void 0:h.room_type)==2)[0])==null?void 0:j._id})})]})})},ks=$.memo(Ds);function Ms({setOpen:t,open:s,room_id:o}){const[n,p]=r.useState([]),[c,d]=r.useState(1),[x,g]=r.useState(!1),[y,f]=r.useState(!1),[j,h]=r.useState(1),[C,v]=r.useState(""),[N,w]=r.useState(null);function a(){t(!1)}const i=r.useCallback((u=1,b=!1)=>{g(!0),Nt({limit:30,page:u,room_no:o,to_date:N?N.format("YYYY-MM-DD"):E().format("YYYY-MM-DD"),sort_by:j}).then(S=>{p(k=>b?[...k,...S.data]:S.data),S.total_pages&&u<S.total_pages?f(!0):f(!1)}).catch(console.error).finally(()=>g(!1))},[j,C,N]);r.useEffect(()=>{d(1),i(1,!1)},[i]);const l=()=>{const u=c+1;d(u),i(u,!0)},m=[{title:e.jsx("span",{className:"px-0 block font-medium text-gray-700",children:"Check-In"}),dataIndex:"time_of_visit",key:"time_of_visit",render:u=>e.jsx("div",{className:"px-2",children:e.jsx("div",{className:"rounded-[6px] text-nowrap bg-white border border-[#E4E4E7] px-3 py-1 text-[12px] font-medium text-gray-700 inline-block",children:E(u).format("HH:mm:ss")})})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Check-Out"}),dataIndex:"exit_time",key:"exit_time",render:u=>e.jsx("div",{className:"px-2 ",children:u&&E(u).format("HH:mm:ss")||"-"})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Stay"}),key:"duration",render:u=>e.jsx("div",{className:"px-2 ",children:$t(u==null?void 0:u.time_of_visit,u==null?void 0:u.exit_time)})},{title:e.jsx("span",{className:"px-0 block text-nowrap font-medium text-gray-700",children:"Occupancy"}),key:"event_user_no",render:u=>e.jsx("div",{className:"px-2",children:u==null?void 0:u.event_user_no})}];return e.jsx(De,{title:null,onClose:a,closeIcon:e.jsx(ke,{size:24}),size:"large",open:!0,children:e.jsxs("div",{className:" bg-white rounded-[12px] w-full",children:[e.jsxs("h2",{className:"text-[22px] font-semibold mb-4",children:["Visit Logs - ",e.jsxs("small",{className:"text-slate-500",children:[" Room ",o]})]}),e.jsx(_t,{theme:{token:{colorPrimary:"#64748b"}},children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(wt,{onChange:u=>w(u),placeholder:"Today"}),e.jsxs("div",{className:"flex items-center px-3 py-1 border rounded cursor-pointer",onClick:()=>h(u=>u===1?0:1),children:["Sort ",j===1?e.jsx(Ct,{}):e.jsx(St,{})]})]})}),e.jsx("div",{style:{maxHeight:"auto",overflowY:"auto"},children:e.jsx("div",{className:"w-full ",children:e.jsx(It,{columns:m,dataSource:n,pagination:!1,loading:x&&c===1,size:"middle",rowClassName:(u,b)=>b===0?"bg-white":(b-1)%2===0?"bg-gray-50":"bg-white",className:`\r
      [&_.ant-table-thead>tr>th]:!bg-gray-100\r
      [&_.ant-table-thead>tr>th]:!py-3\r
      [&_.ant-table-thead>tr>th]:!text-gray-700\r
      [&_.ant-table-thead>tr>th]:!font-semibold\r
      [&_.ant-table-tbody_td]:!border-none\r
      [&_.ant-table-tbody_td]:!whitespace-normal\r
    `})})}),y&&!x&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(F,{onClick:l,type:"default",children:"Load More"})}),y&&x&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(U,{})})]})})}function pe({deviceCode:t="",selectedEvents:s=[],group:o="all",rooms:n=[],deviceOnline:p,visit_count:c}){var v,N,w,a;const{deviceData:d}=r.useContext(de),x=r.useMemo(()=>({0:null,1:Mt,2:kt,3:Dt,4:Rt,5:Ie,6:W,9:W,10:W,11:W,7:fe,8:fe}),[]),g=r.useMemo(()=>({2:1,1:2,3:3,4:4}),[]),y=i=>i.room_type===2?"Bedroom":i.name&&i.name.trim()!==""?i.name:{1:"Living Room",2:"Bedroom",3:"Bathroom",4:"Other Room"}[i.room_type]||"Unknown Room",f=r.useMemo(()=>{if(!n||n.length===0)return null;const i=[...n].sort((l,m)=>{const u=g[l.room_type]||999,b=g[m.room_type]||999;return u-b});for(const l of i){if(!l.device_no)continue;const m=d[l.device_no],u=(m==null?void 0:m.position)||[];if(u.length>0)return{room:l,deviceData:m,positionData:u,deviceCode:l.device_no}}return null},[n,d,g]),j=r.useMemo(()=>{var u,b;if(!f)return null;const i=f.deviceData,l=i==null?void 0:i.hbstaticsTimestamp;return!(i!=null&&i.hbstatics)||!l||(Date.now()-l)/1e3>90?null:(b=(u=te(i.hbstatics))==null?void 0:u.statusEvents)==null?void 0:b.sleepState},[f]),h=r.useMemo(()=>{if(!f)return[];const{positionData:i}=f;return!s||s.length===0?i:i.filter(l=>s.includes(l.posture))},[f,s]);if(!f)return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{className:"text-[#6B7280] w-fit p-[16px] bg-[#F3F4F6] rounded-full",style:{backgroundColor:(v=n[0])!=null&&v.is_device_bind?"#F3F4F6":"#FCA5A520"},children:e.jsx(K,{title:(N=n[0])!=null&&N.is_device_bind?"Out of Room":" Device Offline",children:(w=n[0])!=null&&w.is_device_bind?e.jsx(At,{size:20}):e.jsx(he,{size:20,color:"red"})})}),e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] font-medium text-primary/85",children:(a=n[0])!=null&&a.is_device_bind?"Out of Room":" Device Offline"})})]});const C=()=>{const{room:i}=f,l=h[0];return i.room_type===2?l.postureIndex===6&&j?j.label:l.posture:`In ${y(i)}`};return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{children:e.jsx(K,{color:"white",className:"flex -space-x-3 cursor-pointer",overlayInnerStyle:{color:"black",padding:"10px"},title:h.map((i,l)=>{let m=i==null?void 0:i.posture;const{room:u}=f;let b=!1,S=null;return u.room_type===2&&i.postureIndex===6&&j?(m=j.label,b=!0,S=j.color2):u.room_type!==2&&(m=`In ${y(u)}`),e.jsxs("div",{className:"flex items-center gap-2 w-fit",style:{marginBottom:l===h.length-1?"0":"8px"},children:[e.jsx("div",{style:{backgroundColor:b?S:i==null?void 0:i.color2},className:"p-2 rounded-full",children:e.jsx(Lt,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm m-0",children:m})})]},l)}),children:h.map((i,l)=>{let m=x[i.postureIndex],u=!1,b=null;const{room:S}=f;return S.room_type===2&&i.postureIndex===6&&j&&(u=!0,b=j.color2),e.jsx("div",{style:{backgroundColor:u?`${b}30`:`${i==null?void 0:i.color2}30`},className:"rounded-full p-[15px] flex items-center justify-center border-2 border-white",children:u?e.jsx(W,{size:20,color:b}):m&&e.jsx(m,{size:20,color:i==null?void 0:i.color2})},l)})})}),h.length>0&&e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] text-[#4B5563] font-medium",children:C()})})]})}function xe({deviceCode:t,visit_count:s=0,onClick:o}){const{visitCountMap:n,setInitialCount:p}=r.useContext(se);return r.useEffect(()=>{p(t,s)},[t,s]),e.jsxs("div",{onClick:o,className:"text-[12px] text-[#6B7280] font-medium cursor-pointer hover:text-slate-800",children:[n[t]||0," Visits"]})}const As=({name:t,room:s,deviceCode:o,selectedEvents:n,sleepScore:p,emergencyContacts:c=[],rooms:d=[],isDanger:x=!0,currentAlertDetails:g,priority:y=0,user:f})=>{var i;const[j,h]=r.useState(!1),[C,v]=r.useState(!1),[N,w]=$.useState(null),a=(i=d==null?void 0:d.filter(l=>(l==null?void 0:l.room_type)==2)[0])==null?void 0:i.is_device_bind;return e.jsxs(e.Fragment,{children:[y==1?e.jsx("div",{className:"relative rounded-[10px] min-w-[220px] max-w-[220px] w-full flex-grow h-fit cursor-pointer border-2 p0 card_UI",onClick:()=>h(!0),style:{borderColor:"#FCA5A5"},children:e.jsx("div",{className:"bg-white/90 rounded-[7px] border border-gray-200 p-[10px] flex flex-col gap-4 h-full ",children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-medium font-roboto text-gray-500 leading-none w-full justify-center flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(pe,{deviceCode:o,rooms:d,visit_count:f==null?void 0:f.visit_count,deviceOnline:a}),e.jsx(xe,{onClick:l=>{var m;l.stopPropagation(),v(!0),w((m=d[0])==null?void 0:m.room_no)},deviceCode:o,visit_count:f==null?void 0:f.visit_count})]})]})})}):e.jsx("div",{className:"relative bg-white rounded-[10px]  cursor-pointer border-2 border-[#8BD1A5] p-[10px] min-w-[220px] max-w-[220px] card_UI w-fit flex-grow flex flex-col h-fit",onClick:()=>h(!0),style:{borderColor:a?"#8BD1A5":"#00000010"},children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-semibold text-[#6B7280] leading-none w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(pe,{deviceCode:o,rooms:d,visit_count:f==null?void 0:f.visit_count}),e.jsx(xe,{onClick:l=>{var m;l.stopPropagation(),v(!0),w((m=d[0])==null?void 0:m.room_no)},deviceCode:o,visit_count:f==null?void 0:f.visit_count})]})]})}),C&&e.jsx(Ms,{open:C,setOpen:v,room_id:N}),j&&e.jsx(ks,{open:j,setOpen:h,data:f})]})},ce=$.memo(As),Ls=({users:t,selectedEvents:s,notVisitedRoom:o,isActiveAlertsSelect:n,loading:p})=>{const{deviceData:c}=r.useContext(de),[d,x]=r.useState([]),g="criticalAlarmCountsCache";r.useEffect(()=>{var i;const a=localStorage.getItem(g);if(a){const l=JSON.parse(a);Date.now()-l.timestamp<24*60*60*1e3&&x(l.data)}Ot({to_date:E().subtract(14,"day").format("YYYY-MM-DD"),from_date:(i=E())==null?void 0:i.format("YYYY-MM-DD"),limit:1e3}).then(l=>{const m=(l==null?void 0:l.data)||[];x(m),localStorage.setItem(g,JSON.stringify({data:m,timestamp:Date.now()}))}).catch(l=>{console.log(l)})},[]);const y=r.useMemo(()=>{const a={};for(const i of d){a[i.room_id]||(a[i.room_id]={});const l=i.event;a[i.room_id][l]=(a[i.room_id][l]||0)+i.count}return a},[d]),f={2:3},j=a=>{const i=y[a];return i?Object.entries(f).some(([l,m])=>(i[l]||0)>=m):!1},h=a=>!a.rooms||a.rooms.length===0?!1:a.rooms.some(i=>{if(!i.device_no)return!1;const l=c[i.device_no];return(l==null?void 0:l.position)&&l.position.length>0}),C=r.useMemo(()=>!s||s.length===0?t:s.includes("outOfRoom")?t.filter(a=>a.is_device_bind!==!1&&!h(a)):t.filter(a=>{var k,B,O;if(!h(a))return!1;const i={2:1,1:2,3:3,4:4,5:5},l=[...a.rooms||[]].sort((A,D)=>{const X=i[A.room_type]||999,V=i[D.room_type]||999;return X-V});let m=null;for(const A of l){if(!A.device_no)continue;const D=c[A.device_no];if(D!=null&&D.position&&D.position.length>0){m={room:A,deviceData:D};break}}if(!m)return!1;const u=m.deviceData.position||[];if(u.length===0)return!1;const b=m.deviceData;let S=null;return b!=null&&b.hbstatics&&(b!=null&&b.hbstaticsTimestamp)&&(Date.now()-b.hbstaticsTimestamp)/1e3<=90&&(S=((O=(B=(k=te(b.hbstatics))==null?void 0:k.statusEvents)==null?void 0:B.sleepState)==null?void 0:O.label)||null),u.every(A=>{const D=u[0];if(!D)return!1;if(D.postureIndex===6){if(s.some(V=>["awake","asleep"].includes(V))){if(!S)return!1;if(s.includes("awake"))return S==="Awake";if(s.includes("asleep"))return["Light Sleep","Deep Sleep"].includes(S)}return s.includes(6)}return s.includes(D.postureIndex)})}),[c,s,t,n,o]),[v,N,w]=r.useMemo(()=>{const a=[],i=[],l=[];return C.forEach(m=>{if(m.is_device_bind===!1){l.push(m);return}const u=m.room_id;j(u)?a.push(m):i.push(m)}),o?[a.filter(m=>!m.visit_count||m.visit_count==0),i.filter(m=>!m.visit_count||m.visit_count==0),l.filter(m=>!m.visit_count||m.visit_count==0)]:[a,i,l]},[C,y,n,o]);return e.jsxs("div",{className:"flex flex-col gap-6",children:[p&&(t==null?void 0:t.length)==0&&e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from({length:8}).map((a,i)=>e.jsx(Os,{},i))}),v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsxs("h2",{className:"text-sm text-primary/90 text-nowrap flex items-center",children:["High Risk Residents"," ",e.jsx(K,{className:"ml-2",title:"A room is marked as high risk if a resident has fallen 3 or more times in the last 2 weeks.",children:e.jsx(Pt,{className:"text-sm text-primary cursor-pointer"})})]}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((a,i)=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),N.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"All Residents"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map((a,i)=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"Offline Rooms"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(a=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]})]})},Os=()=>e.jsx("div",{className:"relative rounded-[9px] min-w-[220px] max-w-[280px] w-fit flex-grow h-fit cursor-pointer border-2",children:e.jsxs("div",{className:"bg-white/90 rounded-[7px]  p-[10px] flex flex-col gap-4 h-full relative",children:[e.jsx("div",{className:"bg-[linear-gradient(to_bottom,_#fef2f2_20%,_#ffffff_80%)] absolute inset-[1px] rounded-[6px] -z-10"}),e.jsxs("div",{className:"flex flex-col justify-between items-center w-full",children:[e.jsxs("div",{className:"text-[14px] font-semibold text-gray-500 leading-none w-full flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-gray-300"}),e.jsx(Z.Input,{active:!0,size:"small",style:{width:80}})]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-1 w-full",children:e.jsx(Z.Input,{active:!0,size:"small",style:{width:100}})}),e.jsx("div",{className:"mt-4 mb-1",children:e.jsx(Z.Button,{active:!0,size:"small",style:{width:120}})})]}),e.jsx("div",{className:"flex justify-between z-10 absolute top-2 right-2",children:e.jsx(Z.Avatar,{active:!0,size:"small",shape:"circle"})})]})}),Ps=(t,s=24*60*60*1e3)=>{const o=localStorage.getItem(t);if(!o)return null;const n=JSON.parse(o);return Date.now()-n.timestamp<s?n.data:null},Fs=(t,s)=>{localStorage.setItem(t,JSON.stringify({data:s,timestamp:Date.now()}))};function Bs(){const[t,s]=r.useState(""),[o,n]=r.useState(""),[p,c]=r.useState([]),[d,x]=r.useState(!1),[g,y]=r.useState(1),f=30,{totalResident:j,setTotalResident:h,setActiveAlerts:C,activeAlerts:v,selectedEvents:N,setSelectedEvents:w,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l,setNotVisitRoomCount:m,offlineRoomCount:u,setOfflineRoomCount:b}=r.useContext(se),{resolvedAlarm:S,setResolvedAlarm:k}=r.useContext(se),{notificationEvent:B}=xs(),O="roomListCache",A="allUIDsCache",D=r.useCallback(async(P=1,T=!1)=>{var oe,G;try{if(P===1&&!T){const _=localStorage.getItem(O);if(_){const I=JSON.parse(_);Date.now()-I.timestamp<24*60*60*1e3&&(c(I.data),h(I.totalResident||0),m(I.notVisitRoomCount||0))}}x(!0);const R=await Ft({page:P,limit:f});h((R==null?void 0:R.total)||0);const ne=_=>{const I=[2,1,3,4];for(const L of I){const M=_.find(H=>(H==null?void 0:H.room_type)===L&&(H==null?void 0:H.device_no));if(M)return M}return _.find(L=>L==null?void 0:L.device_no)||""},ie=R.data.map(_=>{var L;const I=ne(_.rooms);return{id:_._id,name:_.name||"N/A",room:_.room_no||"N/A",visit_count:_.visit_count||0,room_id:I==null?void 0:I._id,is_device_bind:(I==null?void 0:I.is_device_bind)||!1,sleepScore:Math.floor(Math.random()*100),emergency_contacts:_.emergency_contacts||[],deviceCode:I==null?void 0:I.device_no,rooms:(_.rooms||[]).filter(M=>M.device_no&&M.device_no.trim()!=="").map(M=>({room:M.name||"N/A",device_no:M.device_no,room_no:_.room_no,room_type:M.room_type,id:M._id,is_device_bind:M.is_device_bind})),currentAlertDetails:{...Y(_==null?void 0:_.alarms_data[0]),created_at:(L=_==null?void 0:_.alarms_data[0])==null?void 0:L.created_at},priority:_==null?void 0:_.highest_priority,details:_==null?void 0:_.rooms}});c(_=>T?[..._,...ie]:ie);const Ae=R.data.map(_=>{const I=ne(_.rooms);return(I==null?void 0:I.device_no)||null}).filter(Boolean),Le=(oe=R.data.filter(_=>{const I=ne(_.rooms);return(I==null?void 0:I.is_device_bind)===!1}))==null?void 0:oe.length;b(Le);const me=(G=R.data.filter(_=>!_.visit_count||_.visit_count==0))==null?void 0:G.length;m(me||0),n(Ae.join(",")),localStorage.setItem(O,JSON.stringify({data:ie,timestamp:Date.now(),totalResident:(R==null?void 0:R.total)||0,notVisitRoomCount:me||0}))}catch(R){console.log(R)}finally{x(!1)}},[S,B]),X=r.useCallback(async()=>{var P;try{const T=Ps(A);T&&s(T);const G=(P=(await zt()).data)==null?void 0:P.map(R=>R==null?void 0:R.uid).filter(Boolean).join(",");s(G),Fs(A,G)}catch(T){console.log(T)}},[]);r.useEffect(()=>{D(1),X()},[D]);const V=()=>{if(p.length<j){const P=g+1;y(P),D(P,!0)}};return e.jsx(Re,{deviceId:t||o,children:e.jsx(ge.Provider,{value:{selectedEvents:N,setSelectedEvents:w,setActiveAlerts:C,activeAlerts:v,totalResident:j,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l},children:e.jsxs("div",{className:"w-full bg-[#F4F4F4] h-[calc(100svh-100px)] flex flex-col items-start font-poppins relative ",children:[e.jsxs("div",{className:"p-[20px] w-full flex lg:flex-nowrap flex-wrap gap-2 lg:gap-8 sticky top-0 bg-gradient-to-b from-[#F4F4F4] via-[#F4F4F4]/70 to-[#F4F4F4]/10 z-50",children:[e.jsx("div",{className:"lg:w-[60%] w-[100%]",children:e.jsx(Tt,{})}),e.jsx("div",{className:"lg:w-[40%] w-[100%]",children:e.jsx(Et,{})})]}),e.jsx("div",{className:"w-full p-5 pt-1 h-[calc(100svh-100px)] overflow-auto",children:e.jsx(Ls,{users:p,selectedEvents:N,loading:d&&p.length===0,isActiveAlertsSelect:v,notVisitedRoom:i})}),p.length<j&&e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2",children:e.jsx(F,{shape:"round",onClick:V,disabled:d,className:"shadow-lg",children:d?e.jsx(U,{size:"small"}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Load More ",e.jsx(Bt,{size:12})]})})})]})})})}export{Bs as default};
//# sourceMappingURL=NurseDashboard-nEs2W5Kx.js.map
