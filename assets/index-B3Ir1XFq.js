import{u as q,r as i,al as O,ah as Q,j as n,G as E,aj as z,af as J,a0 as A,a1 as X,S as K,ao as Z,e as R,ag as k,ap as D,ai as ee,am as te}from"./index-C49nTNx_.js";import"./alertsOverview-DmHdDNHL.js";import{u as ne,a as re,D as se}from"./RoomMap4-CCZTNaoh.js";import{A as ie}from"./ActionManu-D-zxp6tb.js";import{g as le}from"./elderlySupport-gujQ2ZFU.js";import{S as ce}from"./index-BKfkMZj3.js";import{C as F}from"./Collapse-BWTAgPwU.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="5864c7c8-56bb-4417-b99a-613b02faf409",e._sentryDebugIdIdentifier="sentry-dbid-5864c7c8-56bb-4417-b99a-613b02faf409")}catch{}function ae({data:e={}}){var j,p,N,y,w,T,_;const r=q(),[d,b]=i.useState(null),f=i.useRef(null),m=i.useRef(!1),[v,o]=i.useState(!1),h=i.useRef,g=u=>{switch(u){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};i.useEffect(()=>{var s;const u=(s=e==null?void 0:e.rooms)==null?void 0:s.device_no;return u&&(f.current&&f.current!==u&&O({uid:f.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(c=>console.error(`Error unsubscribing: ${c}`)),Q({uid:u,messageType:["1","2","3","4"],topics:{pub:[u]}}).then(()=>{}).catch(c=>console.error(`Error subscribing: ${c}`)),f.current=u),()=>{f.current&&O({uid:f.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(c=>console.error(`Error during cleanup unsubscribe: ${c}`))}},[e]);function S(u){var t;const c=[...J(u)];((t=c[0])==null?void 0:t.postureIndex)===4&&m.current&&(c[0].postureIndex=6,c[0].posture="Resident on Bed",c[0].color="#252F67"),b(c)}function x(){o(!0),m.current=!0,clearTimeout(h.current),h.current=setTimeout(()=>{o(!1),m.current=!1},5e3)}return ne({onMessage:u=>{var c,t;const s=(c=JSON.parse(u==null?void 0:u.message))==null?void 0:c.payload;(s==null?void 0:s.deviceCode)===((t=e==null?void 0:e.rooms)==null?void 0:t.device_no)&&(s!=null&&s.position||s!=null&&s.heartbreath)&&(s!=null&&s.position&&S(s.position),s!=null&&s.heartbreath&&x())},dependencies:[e]}),n.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[n.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${g((j=E(e))==null?void 0:j.label)}`,children:[n.jsx("div",{className:"loader"}),n.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[n.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),n.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(p=E(e))==null?void 0:p.title})]}),n.jsx("span",{onClick:()=>{r(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[n.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),n.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),n.jsx("div",{})]}),n.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[n.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((N=e==null?void 0:e.rooms)==null?void 0:N.mount_type)===1&&((y=e==null?void 0:e.rooms)==null?void 0:y.is_device_bind)&&n.jsx(re,{roomInfo:e==null?void 0:e.rooms,position:d}),((w=e==null?void 0:e.rooms)==null?void 0:w.mount_type)===2&&((T=e==null?void 0:e.rooms)==null?void 0:T.is_device_bind)&&n.jsx(se,{roomInfo:e==null?void 0:e.rooms,position:d}),!((_=e==null?void 0:e.rooms)!=null&&_.is_device_bind)&&n.jsx("span",{className:"w-full h-full flex items-center justify-center",children:n.jsx("p",{children:" No Device Data Available"})})]}),n.jsxs("div",{className:"details-container w-1/3 ",children:[n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:z(e.created_at)}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:n.jsx(ie,{date:e.created_at})}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}function oe(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var H=oe,de=typeof A=="object"&&A&&A.Object===Object&&A,fe=de,ue=fe,be=typeof self=="object"&&self&&self.Object===Object&&self,ge=ue||be||Function("return this")(),U=ge,me=U,he=function(){return me.Date.now()},xe=he,pe=/\s/;function ve(e){for(var r=e.length;r--&&pe.test(e.charAt(r)););return r}var je=ve,ye=je,Te=/^\s+/;function _e(e){return e&&e.slice(0,ye(e)+1).replace(Te,"")}var Se=_e,we=U,Ne=we.Symbol,V=Ne,L=V,Y=Object.prototype,Ie=Y.hasOwnProperty,$e=Y.toString,I=L?L.toStringTag:void 0;function Ae(e){var r=Ie.call(e,I),d=e[I];try{e[I]=void 0;var b=!0}catch{}var f=$e.call(e);return b&&(r?e[I]=d:delete e[I]),f}var Ee=Ae,Ce=Object.prototype,Oe=Ce.toString;function Re(e){return Oe.call(e)}var ke=Re,M=V,Le=Ee,Me=ke,Be="[object Null]",Pe="[object Undefined]",B=M?M.toStringTag:void 0;function We(e){return e==null?e===void 0?Pe:Be:B&&B in Object(e)?Le(e):Me(e)}var Ge=We;function Fe(e){return e!=null&&typeof e=="object"}var He=Fe,Ue=Ge,Ve=He,Ye="[object Symbol]";function qe(e){return typeof e=="symbol"||Ve(e)&&Ue(e)==Ye}var Qe=qe,ze=Se,P=H,Je=Qe,W=NaN,Xe=/^[-+]0x[0-9a-f]+$/i,Ke=/^0b[01]+$/i,Ze=/^0o[0-7]+$/i,De=parseInt;function et(e){if(typeof e=="number")return e;if(Je(e))return W;if(P(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=P(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=ze(e);var d=Ke.test(e);return d||Ze.test(e)?De(e.slice(2),d?2:8):Xe.test(e)?W:+e}var tt=et,nt=H,C=xe,G=tt,rt="Expected a function",st=Math.max,it=Math.min;function lt(e,r,d){var b,f,m,v,o,h,g=0,S=!1,x=!1,j=!0;if(typeof e!="function")throw new TypeError(rt);r=G(r)||0,nt(d)&&(S=!!d.leading,x="maxWait"in d,m=x?st(G(d.maxWait)||0,r):m,j="trailing"in d?!!d.trailing:j);function p(t){var a=b,l=f;return b=f=void 0,g=t,v=e.apply(l,a),v}function N(t){return g=t,o=setTimeout(T,r),S?p(t):v}function y(t){var a=t-h,l=t-g,$=r-a;return x?it($,m-l):$}function w(t){var a=t-h,l=t-g;return h===void 0||a>=r||a<0||x&&l>=m}function T(){var t=C();if(w(t))return _(t);o=setTimeout(T,y(t))}function _(t){return o=void 0,j&&b?p(t):(b=f=void 0,v)}function u(){o!==void 0&&clearTimeout(o),g=0,b=h=f=o=void 0}function s(){return o===void 0?v:_(C())}function c(){var t=C(),a=w(t);if(b=arguments,f=this,h=t,a){if(o===void 0)return N(h);if(x)return clearTimeout(o),o=setTimeout(T,r),p(h)}return o===void 0&&(o=setTimeout(T,r)),v}return c.cancel=u,c.flush=s,c}var ct=lt;const at=X(ct),{Panel:ot}=F;function pt(){i.useContext(K);const{notificationEvent:e}=Z();i.useState("All");const[r,d]=i.useState([]),[b,f]=i.useState(null),[m,v]=i.useState(null),[o,h]=i.useState(null),[g,S]=i.useState(!1),[x,j]=i.useState(1),[p,N]=i.useState(!0),y=i.useRef(null),w=i.useCallback(()=>{!p||g||(S(!0),le({to_date:"2024-11-30",from_date:R().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:x,...o}).then(t=>{d(a=>[...a,...t.data]),x>=t.totalPages&&N(!1),S(!1)}).catch(t=>{console.error(t),S(!1)}))},[o,x,p,g]);i.useEffect(()=>{w()},[x,o]),i.useEffect(()=>{if(r.length>0&&!b){const t=r[0];f(t._id),v(t)}},[r,b]);const T=t=>{f(t);const a=r.find(l=>l._id===t);v(a)},_=i.useCallback(at(()=>{if(!y.current||g||!p)return;const{scrollTop:t,scrollHeight:a,clientHeight:l}=y.current;t+l>=a-50&&j($=>$+1)},200),[g,p]),u=t=>{h(te(t)),j(1),d([]),N(!0)};i.useEffect(()=>{e&&w()},[e]),i.useEffect(()=>{const t=y.current;return t&&t.addEventListener("scroll",_),()=>{t&&t.removeEventListener("scroll",_)}},[_]);const s=i.useMemo(()=>r.reduce((t,a)=>{const l=a.room_name;return t[l]||(t[l]=[]),t[l].push(a),t},{}),[r]),c=t=>{switch(t){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return n.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[n.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[n.jsx(ce,{style:{width:"100%"},block:!0,options:dt,onChange:t=>u(t)}),n.jsxs("div",{ref:y,className:"w-full overflow-auto",style:{height:"440px"},children:[r.length===0&&!g&&n.jsx(k,{description:"No active alerts available"}),r.length>0&&n.jsx(F,{children:Object.entries(s).map(([t,a])=>([...new Set(a.map(l=>E(l).label))],n.jsx(ot,{header:n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("span",{className:"text-black font-semibold",children:t})}),children:a.map(l=>n.jsxs("div",{onClick:()=>T(l._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${b===l._id?"bg-gray-100":""}`,children:[n.jsx("span",{className:"text-[14px] font-semibold",children:R(l.created_at).format("hh:mm:ss a")}),n.jsx(D,{color:c(E(l).label),size:"large"})]},l._id))},t)))}),g&&n.jsx("div",{className:"w-full flex justify-center py-4",children:n.jsx(ee,{})}),!p&&r.length>0&&n.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),n.jsx("div",{className:"w-[70%] h-full",children:m?n.jsx(ae,{data:m}):n.jsx(k,{description:"Select an alert to view details"})})]})}const dt=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{pt as R};
//# sourceMappingURL=index-B3Ir1XFq.js.map
