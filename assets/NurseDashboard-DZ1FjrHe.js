import{r as s,j as e,bq as q,u as ne,d as H,br as ae,S as X,bs as ie,B as O,I as re,a6 as W,aN as U}from"./index-CfoUWzUu.js";import{a as oe}from"./index-DsKOFD2w.js";import{u as Q,A as ce,a as de}from"./alertsOverview-C-ezvIWW.js";import{g as J,a as fe}from"./elderlySupport-BdzHWfDx.js";import{d as ue,a as y,b as he,g as Z}from"./helper-DzRZPsxz.js";import{g as xe}from"./elderly-BztRwgfP.js";import{S as pe}from"./slick-theme-COuthfbV.js";import{u as me,D as ge,a as je}from"./RoomMap4-BVpCUatQ.js";import{A as ve}from"./AlertCloseModal-mYu4j9qX.js";import{M as be,u as le,P as we,a as Ce,L as ye,m as D}from"./proxy-B9nYe0nz.js";import"./index-DNIPEMeC.js";import"./line-rn7SarKG.js";import"./WeeklyMonthlyPicker-NMTARwjC.js";import{C as Ne}from"./CreateAndEditModal-BZUa_kom.js";import{S as ee}from"./index-3Ush5jaf.js";import{R as Ae}from"./AimOutlined-DBwiLxiG.js";import{R as Se}from"./HomeOutlined-zwtVd_Hf.js";import"./AlertName-CB1y5ZVv.js";import"./ActionManu-B6dXt2Nv.js";import"./index-CTSLk77N.js";import"./SuccessModal-CokJ-1V0.js";import"./index-BmtjIrYI.js";import"./UseCustomContext-C6J-BSFQ.js";import"./LargeTextViewerModal-SQ-e2Y2h.js";import"./SwapRightOutlined-CC7gMM_3.js";import"./weekOfYear-DCUpgP3v.js";import"./index-IZ5_rnW_.js";import"./weekday-pyubuRdr.js";import"./index-C2p3B1US.js";import"./leaflet-src-CLdFMALI.js";/* empty css                */import"./InfoCircleOutlined-DMVlhSXk.js";import"./index-DSgOvMtf.js";class _e extends s.Component{getSnapshotBeforeUpdate(f){const r=this.props.childRef.current;if(r&&f.isPresent&&!this.props.isPresent){const t=this.props.sizeRef.current;t.height=r.offsetHeight||0,t.width=r.offsetWidth||0,t.top=r.offsetTop,t.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function De({children:c,isPresent:f}){const r=s.useId(),t=s.useRef(null),w=s.useRef({width:0,height:0,top:0,left:0}),{nonce:n}=s.useContext(be);return s.useInsertionEffect(()=>{const{width:d,height:a,top:g,left:N}=w.current;if(f||!t.current||!d||!a)return;t.current.dataset.motionPopId=r;const j=document.createElement("style");return n&&(j.nonce=n),document.head.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${a}px !important;
            top: ${g}px !important;
            left: ${N}px !important;
          }
        `),()=>{document.head.removeChild(j)}},[f]),e.jsx(_e,{isPresent:f,childRef:t,sizeRef:w,children:s.cloneElement(c,{ref:t})})}const Ee=({children:c,initial:f,isPresent:r,onExitComplete:t,custom:w,presenceAffectsLayout:n,mode:d})=>{const a=le(Me),g=s.useId(),N=s.useCallback(x=>{a.set(x,!0);for(const v of a.values())if(!v)return;t&&t()},[a,t]),j=s.useMemo(()=>({id:g,initial:f,isPresent:r,custom:w,onExitComplete:N,register:x=>(a.set(x,!1),()=>a.delete(x))}),n?[Math.random(),N]:[r,N]);return s.useMemo(()=>{a.forEach((x,v)=>a.set(v,!1))},[r]),s.useEffect(()=>{!r&&!a.size&&t&&t()},[r]),d==="popLayout"&&(c=e.jsx(De,{isPresent:r,children:c})),e.jsx(we.Provider,{value:j,children:c})};function Me(){return new Map}const z=c=>c.key||"";function te(c){const f=[];return s.Children.forEach(c,r=>{s.isValidElement(r)&&f.push(r)}),f}const ke=({children:c,exitBeforeEnter:f,custom:r,initial:t=!0,onExitComplete:w,presenceAffectsLayout:n=!0,mode:d="sync"})=>{const a=s.useMemo(()=>te(c),[c]),g=a.map(z),N=s.useRef(!0),j=s.useRef(a),x=le(()=>new Map),[v,k]=s.useState(a),[A,S]=s.useState(a);Ce(()=>{N.current=!1,j.current=a;for(let b=0;b<A.length;b++){const p=z(A[b]);g.includes(p)?x.delete(p):x.get(p)!==!0&&x.set(p,!1)}},[A,g.length,g.join("-")]);const m=[];if(a!==v){let b=[...a];for(let p=0;p<A.length;p++){const C=A[p],F=z(C);g.includes(F)||(b.splice(p,0,C),m.push(C))}d==="wait"&&m.length&&(b=m),S(te(b)),k(a);return}const{forceRender:E}=s.useContext(ye);return e.jsx(e.Fragment,{children:A.map(b=>{const p=z(b),C=a===A||g.includes(p),F=()=>{if(x.has(p))x.set(p,!0);else return;let M=!0;x.forEach(R=>{R||(M=!1)}),M&&(E==null||E(),S(j.current),w&&w())};return e.jsx(Ee,{isPresent:C,initial:!N.current||t?void 0:!1,custom:C?void 0:r,presenceAffectsLayout:n,mode:d,onExitComplete:C?void 0:F,children:b},p)})})};function Fe({rooms:c=[]}){const[f,r]=s.useState({}),t={dots:c.length>=2,infinite:c.length>2,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:n=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsxs("ul",{id:"dots",style:{margin:"0px"},children:[" ",n," "]})})},w=s.useCallback((n,d)=>{const a=ue(n);r(g=>({...g,[d]:a}))},[]);return me({onMessage:n=>{var a;const d=(a=JSON.parse(n==null?void 0:n.message))==null?void 0:a.payload;console.log(d),d!=null&&d.position&&w(d.position,d.deviceCode)},dependencies:[]}),e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("div",{id:"rooms",className:"w-full mb-2 transition-all duration-300 h-full",children:e.jsx(pe,{...t,className:"w-full transition-all duration-300 h-full ",children:c.map((n,d)=>e.jsxs("div",{className:"px-2 overflow-hidden transition-all duration-300 w-full h-[355px] ",children:[e.jsxs("div",{id:"roomNmaeAndStatus",className:"flex items-center gap-2 w-fit bg-white pr-4 py-1.5 border border-gray-200 p-2 rounded-full absolute top-2 left-2",children:[e.jsx("div",{id:"dot",className:"size-3 rounded-full",style:{backgroundColor:(n==null?void 0:n.is_device_bind)===!0?"green":"red"}}),e.jsx("p",{children:n==null?void 0:n.name})]}),(n==null?void 0:n.is_device_bind)&&(n==null?void 0:n.mount_type)===1&&e.jsx(ge,{roomInfo:n,position:f[n.device_no]}),(n==null?void 0:n.is_device_bind)&&(n==null?void 0:n.mount_type)===2&&e.jsx(je,{roomInfo:n,position:f[n.device_no]}),!(n!=null&&n.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:"No Device Data Available"})})]},d))})}),c.length===0&&e.jsx(q,{description:"No Room Found "})]})}function Re({refreshAlertList:c}){var $,B,o,G;const[f,r]=s.useState([]),[t,w]=s.useState(null),n=ne(),[d,a]=s.useState(!1),[g,N]=s.useState(null),[j,x]=s.useState(!0),[v,k]=s.useState({textColor:"text-white",bodyColor:"text-white",txtc:"#fff",bgc:"#fff"}),[A,S]=s.useState({time:[],heartRate:[],breathRate:[]}),[m,E]=s.useState(null),[b,p]=s.useState(Date.now()),[C,F]=s.useState([]),[M,R]=s.useState(!0),P=s.useCallback(()=>{x(!0),xe().then(l=>{r(l.data),x(!1)}).catch(l=>{console.log(l),x(!1)})},[]);s.useEffect(()=>{P()},[P]);const L=s.useCallback(()=>{R(!0),J({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t==null?void 0:t._id}).then(l=>{F(l.data),R(!1)}).catch(l=>{R(!1),console.log(l)})},[t==null?void 0:t._id]);s.useEffect(()=>{t!=null&&t._id&&L()},[L]),s.useEffect(()=>{var l,u,i,h;t&&k({textColor:((l=y(t))==null?void 0:l.label)!=="Critical"?"text-primary":"text-white",bodyColor:((u=y(t))==null?void 0:u.label)!=="Critical"?"text-primary":"text-white",txtc:((i=y(t))==null?void 0:i.label)!=="Critical"?"#fff":"#000",bgc:((h=y(t))==null?void 0:h.label)!=="Critical"?"#fff":"#000"})},[t]),s.useEffect(()=>{var u;const l=((u=t==null?void 0:t.rooms)==null?void 0:u.length)>0?t.rooms.filter(i=>i.device_no).map(i=>i.device_no).join(", "):"";l&&t&&ae({uid:l,messageType:["1","2","3","4"],topics:{pub:[l]}}).then(i=>{console.log(i)}).catch(i=>{console.log(i)})},[t]);const T=l=>{const u=he(l);E(u),p(Date.now())};s.useEffect(()=>{const l=setInterval(()=>{if(Date.now()-b>5e3)E(null),S({time:[],heartRate:[],breathRate:[]});else if(m){const h=new Date().toLocaleTimeString();S(_=>({time:[..._.time,h].slice(-30),heartRate:[..._.heartRate,m.heartRateValue].slice(-30),breathRate:[..._.breathRate,m.breathingValue].slice(-30)}))}},1e3);return()=>clearInterval(l)},[m,b]),s.useEffect(()=>{var i;if(!t)return;const l=((i=t==null?void 0:t.rooms)==null?void 0:i.length)>0?t.rooms.filter(h=>h.device_no).map(h=>h.device_no).join(", "):"",u=new WebSocket("wss://live.elderlycareplatform.com/ws/");return u.onopen=()=>{console.log("Connected to WebSocket server")},u.onmessage=h=>{var K;const _=JSON.parse(h==null?void 0:h.data),I=(K=JSON.parse(_==null?void 0:_.message))==null?void 0:K.payload;l.includes(I==null?void 0:I.deviceCode)&&(I!=null&&I.heartbreath)&&T(I.heartbreath)},u.onerror=h=>{console.error("WebSocket error:",h)},u.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>u.close()},[t]);const V=l=>{window.scrollTo(0,0),n(`/supporter/elderlies/elderly-profile/${l==null?void 0:l._id}`)},Y=()=>{var u;const l=((u=t==null?void 0:t.rooms)==null?void 0:u.length)>0?t.rooms.filter(i=>i.device_no).map(i=>i.device_no).join(", "):"";l&&t&&ie({uid:l,messageType:["1","2","3","4"]}).then(i=>{}).catch(i=>{console.log(i)}),w(null)};return j?e.jsx(e.Fragment,{children:j&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx(X,{})})}):f.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"NurseRoomView",className:"w-full h-full relative",children:[e.jsx("div",{className:"w-full h-full grid grid-cols-10  overflow-auto",children:f==null?void 0:f.map((l,u)=>{var i,h,_;return e.jsx(D.div,{layoutId:l==null?void 0:l._id,onClick:()=>w(l),className:`text-white text-base ${((i=y(l==null?void 0:l.alarms_data[0]))==null?void 0:i.label)==="Critical"?"bg-[#FF1D1D] animate-scaleUpDown1":((h=y(l==null?void 0:l.alarms_data[0]))==null?void 0:h.label)==="Warning"?"bg-[#FF9831] animate-scaleUpDown2":((_=y(l==null?void 0:l.alarms_data[0]))==null?void 0:_.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6] !text-primary"}  rounded-lg cursor-pointer flex justify-center m-2 items-center font-semibold min-w-[55px] min-h-[65px] h-fit `,children:e.jsx(D.h5,{children:(l==null?void 0:l.room_no)||"--"})},u)})}),e.jsx(ke,{children:t&&e.jsx(D.div,{className:"absolute inset-0 flex justify-center items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(D.div,{className:"bg-black bg-opacity-50 w-full h-full flex justify-center items-center",onClick:()=>Y(),children:e.jsxs(D.div,{className:`${(($=y(t))==null?void 0:$.label)==="Critical"?"bg-[#FF1D1D]":((B=y(t))==null?void 0:B.label)==="Warning"?"bg-[#FF9831]":((o=y(t))==null?void 0:o.label)==="Info"?"bg-[#6471FF]":"bg-[#F4F4F6]"} p-4 rounded-xl w-[95%] h-[90%]`,onClick:l=>l.stopPropagation(),layoutId:t==null?void 0:t._id,children:[e.jsxs(D.div,{className:"flex justify-between items-start",children:[" ",e.jsx("div",{className:"w-[65%] flex items-start cursor-pointer bg-white hover:bg-white/75 rounded-xl transition-all duration-300 ease-in",onClick:()=>V(t),children:e.jsxs("div",{id:"elderly-profile",className:"flex items-center w-full  justify-between px-4 ",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col items-start w-full gap-1",children:[e.jsx("h2",{className:`text-xl font-bold ${v.textColor} text-center text-nowrap m-0  leading-none`,children:t==null?void 0:t.name}),e.jsxs("h2",{className:`text-base font-medium ${v.textColor} opacity-80 text-center text-nowrap m-0 leading-none`,children:["Age: ",e.jsx("span",{children:t==null?void 0:t.age})]})]})}),e.jsxs("div",{id:"liveHeartAndBreathRate",className:"flex w-fit py-4 gap-8",children:[e.jsxs("div",{id:"heartRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${v.textColor}  text-nowrap`,children:[(m==null?void 0:m.heartRateValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${v.textColor} opacity-80 text-nowrap`,children:"Heart Rate"})]}),e.jsxs("div",{id:"breathRate",className:"flex flex-col items-start justify-start w-full",children:[e.jsxs("h2",{className:`text-[27px] font-bold leading-none ${v.textColor}  text-nowrap`,children:[(m==null?void 0:m.breathingValue)??"--"," ",e.jsx("span",{className:"text-sm",children:"/BPM"})]}),e.jsx("h2",{className:`text-sm font-medium ${v.textColor} opacity-80  text-nowrap`,children:"Breath Rate"})]})]})]})}),e.jsx(D.button,{className:"p-2 bg-black/5  hover:bg-black/10 rounded-full",onClick:()=>Y(),children:e.jsx(oe,{size:24,className:v.textColor})})]}),e.jsxs(D.div,{className:"flex h-[80%] items-center mt-2",children:[e.jsx(D.div,{className:"h-full  w-[65%] bg-white rounded-xl flex flex-col items-center justify-center",children:e.jsx(Fe,{rooms:(G=t==null?void 0:t.rooms)==null?void 0:G.filter(l=>l.device_no)})}),e.jsxs(D.div,{className:"h-full w-[35%] rounded-xl p-2 border-1 overflow-y-auto overflow-x-hidden gap-2 flex flex-col pt-0",children:[C==null?void 0:C.map((l,u)=>{var i,h;return e.jsxs("div",{className:"flex items-center gap-2 w-[350px] bg-white p-2 rounded-lg cursor-pointer",onClick:()=>{N(l),a(!0)},children:[e.jsx("div",{id:"Icon",children:y(l).icon?e.jsx("img",{src:y(l).icon,alt:"Alert Icon",width:38,height:38,className:"min-w-[38px]"}):null}),e.jsxs("div",{className:"w-full",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:(i=y(l))==null?void 0:i.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:(h=y(l))==null?void 0:h.message})]})]},u)}),C.length===0&&!M&&e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(q,{description:"No alerts available to show"})}),M&&e.jsx("div",{className:"h-full w-full flex flex-col justify-center items-center",children:e.jsx(X,{})})]})]})]})})})})]}),e.jsx(ve,{openAlertCloseModal:d,setOpenAlertCloseModal:a,selectedAlert:g,getAlertListDatas:()=>{L(),c()}})]}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(q,{description:"No room available to show"})})}function ht(){s.useState("Map View");const[c,f]=s.useState(!1);s.useState([]);const r=Q("activeAlert"),t=Q("recentlyClosedAlert"),w=Q("events"),[n,d]=s.useState([]),[a,g]=s.useState([]),[N,j]=s.useState(1),[x,v]=s.useState(1),[k,A]=s.useState([]),[S,m]=s.useState([]),[E,b]=s.useState({}),[p,C]=s.useState({}),[F,M]=s.useState(!0),[R,P]=s.useState(!0),L=s.useCallback(()=>{P(!0),J({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!1,page:N,...E}).then(o=>{A(o==null?void 0:o.data),P(!1)}).catch(o=>{console.log(o),P(!1)})},[N,E]);s.useEffect(()=>{L()},[L]);const T=s.useCallback(()=>{M(!0),J({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),is_resolved:!0,page:x,...p}).then(o=>{m(o.data),M(!1)}).catch(o=>{console.log(o),M(!1)})},[x,p]);s.useEffect(()=>{T()},[T]);const V=s.useCallback(()=>{fe({to_date:"2024-11-30",from_date:H().format("YYYY-MM-DD"),page:a}).then(o=>{o.data.length>0&&d(o.data)}).catch(o=>{console.log(o)})},[a]);s.useEffect(()=>{V()},[V]);function Y(){L(),T()}function $(o){b(Z(o))}function B(o){C(Z(o))}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 flex-col pt-8 pb-8",children:[e.jsx("div",{className:"flex item-center justify-between w-full",children:e.jsx(O,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx("div",{children:e.jsx(re,{className:"rounded-[10px]",size:"large",placeholder:"Search Anything",style:{height:"44px"}})})})}),e.jsx("div",{className:"w-full",children:e.jsx(ce,{refreshAlertList:Y})}),e.jsxs("div",{className:"w-full flex flex-col gap-4 lg3:flex-row",children:[e.jsx("div",{className:"w-full p-0",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 h-[650px] flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-5",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Room View"})}),e.jsx("div",{className:"w-full h-full overflow-y-auto rounded-xl",children:e.jsx(Re,{refreshAlertList:Y})})]})}),e.jsx("div",{className:"bg-white w-full lg3:w-[48%] rounded-2xl p-6 h-[650px] overflow-hidden",children:e.jsx(de,{})})]}),e.jsxs("div",{id:"Active_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Active_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Active Alerts"}),e.jsx("div",{children:e.jsx(O,{theme:{components:{Segmented:{itemSelectedBg:"#252F67",itemSelectedColor:"#fff",fontFamily:"Baloo2"}}},children:e.jsx(ee,{options:se,onChange:o=>$(o)})})})]}),e.jsx("div",{id:"Active_Alerts_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:k==null?void 0:k.length,page:1,SetPage:j},children:e.jsx(U,{pageSize:6,loading:R,tableData:k,columns:r})})})]}),e.jsxs("div",{id:"Recently_Closed_Alerts",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsxs("div",{id:"Recently_Closed_Alerts_Header",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Recently Closed Alerts"}),e.jsx("div",{children:e.jsx(O,{theme:{components:{Segmented:{itemSelectedBg:"#252F67",itemSelectedColor:"#fff",fontFamily:"Baloo2"}}},children:e.jsx(ee,{options:se,onChange:o=>B(o)})})})]}),e.jsx("div",{id:"Recently_Closed_Alerts_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:S==null?void 0:S.length,page:1,SetPage:v},children:e.jsx(U,{pageSize:6,loading:F,tableData:S,columns:t})})})]}),e.jsxs("div",{id:"Events",className:"w-full flex flex-col gap-4 justify-center items-center bg-white rounded-2xl p-6",children:[e.jsx("div",{id:"Events_Header",className:"w-full flex justify-between",children:e.jsx("h1",{className:"text-[24px] font-bold",children:"Events"})}),e.jsx("div",{id:"Events_Table",className:"w-full",children:e.jsx(W.Provider,{value:{total:n==null?void 0:n.length,page:1,SetPage:g,getList:()=>V},children:e.jsx(U,{pageSize:6,tableData:n,columns:w})})})]})]}),e.jsx(Ne,{modalOpen:c,setModalOpen:f,type:"event"})]})}const xt=[{label:" Map View",value:"Map View",icon:e.jsx(Ae,{})},{label:"Room View",value:"Room View",icon:e.jsx(Se,{})}],se=[{label:"All Alerts",value:"All Alerts"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Informational",value:"Info"}];export{se as activeAlertSegmentOptions,xt as alertViewSegmentOptions,ht as default};
