import{j as e,E as G,hC as ne,ad as le,r as T,hD as ie,i as p,hE as ce,hF as de,hG as fe,hH as me,hI as he,hJ as ue,co as xe,hK as pe,hL as ge,hM as ve,he as ye,hN as be,hO as De,hP as we,hQ as je,hR as Se,hS as Ye,hT as Me,hU as Ae,hq as I,hg as Ne}from"./index-2UQ-37Xq.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g=new n.Error().stack;g&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[g]="a7e5a19e-9487-4736-a0cd-e27cde252cdd",n._sentryDebugIdIdentifier="sentry-dbid-a7e5a19e-9487-4736-a0cd-e27cde252cdd")}catch{}function Le({width:n="100%",height:g=400,data:S=[]}){const s=()=>{if(!S||S.length===0)return f();const a=new Map;S.forEach(l=>{const y=new Date(l.year,l.month-1,l.day),k=y.toISOString().split("T")[0],N=l.event==="5"?"Device Offline":"Fall Alert";a.has(k)||a.set(k,{date:y,timestamp:y.getTime(),dateFormatted:A(y,S),tooltipDate:v(y),"Fall Alert":0,"Device Offline":0});const H=a.get(k);H[N]+=l.count||0});const i=Array.from(a.values()).sort((l,y)=>l.timestamp-y.timestamp),Y=i.map(l=>l.dateFormatted),M=i.map(l=>l.tooltipDate),r=i.map(l=>l["Fall Alert"]),w=i.map(l=>l["Device Offline"]);return{dates:Y,tooltipDates:M,fallAlertData:r,deviceOfflineData:w}},A=(a,i)=>{if(!i||i.length===0)return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});const Y=i.map(y=>new Date(y.year,y.month-1,y.day)),M=new Date(Math.min(...Y)),r=new Date(Math.max(...Y)),w=Math.abs(r-M);return Math.ceil(w/(1e3*60*60*24))<=60?a.toLocaleDateString("en-US",{month:"short",day:"numeric"}):a.toLocaleDateString("en-US",{month:"short",year:"2-digit"})},v=a=>a.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),f=()=>{const a=[],i=[],Y=[],M=[],r=new Date;for(let w=9;w>=0;w--){const l=new Date(r);l.setDate(r.getDate()-w),a.push(l.toLocaleDateString("en-US",{month:"short",day:"numeric"})),i.push(l.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),Y.push(Math.floor(0)),M.push(Math.floor(0))}return{dates:a,tooltipDates:i,fallAlertData:Y,deviceOfflineData:M}},{dates:t,tooltipDates:u,fallAlertData:x,deviceOfflineData:O}=s(),E=a=>a<=10?0:a<=20?1:a<=40?2:a<=60?3:Math.floor(a/12),W=x.reduce((a,i)=>a+i,0),_=O.reduce((a,i)=>a+i,0),D={tooltip:{trigger:"axis",backgroundColor:"transparent",borderWidth:0,className:"!shadow-none",axisPointer:{type:"line",lineStyle:{color:"rgb(var(--ms-text-color)/0.2)",width:1}},formatter:a=>{const i=a[0].dataIndex,Y=u[i],M=a.find(w=>w.seriesName==="Fall Alert"),r=a.find(w=>w.seriesName==="Device Offline");return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[180px]">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${Y}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #ef4444"></div>
                  <span class="text-text/80 text-sm">Fall Alert</span>
                </div>
                <span class="font-mono font-medium text-text">${(M==null?void 0:M.value)||0}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #f59e0b"></div>
                  <span class="text-text/80 text-sm">Device Offline</span>
                </div>
                <span class="font-mono font-medium text-text">${(r==null?void 0:r.value)||0}</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!0,bottom:10,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"normal"},formatter:function(a){return a==="Fall Alert"?`Fall Alert: ${W.toLocaleString()}`:a==="Device Offline"?`Device Offline: ${_.toLocaleString()}`:a}},grid:{left:"3%",right:"4%",bottom:t.length>15?"80px":"50px",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.2)"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:11,interval:E(t.length),rotate:t.length>15?45:0,margin:t.length>15?15:8,formatter:a=>a},axisTick:{alignWithLabel:!0,interval:E(t.length)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12}},series:[{name:"Fall Alert",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#ef4444"},itemStyle:{color:"#ef4444"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(239, 68, 68, 0.3)"},{offset:1,color:"rgba(239, 68, 68, 0.05)"}]}},data:x},{name:"Device Offline",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#f59e0b"},itemStyle:{color:"#f59e0b"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 158, 11, 0.3)"},{offset:1,color:"rgba(245, 158, 11, 0.05)"}]}},data:O}],dataZoom:[{type:"inside",start:t.length>30?100-Math.floor(3e3/t.length):0,end:100},{show:!1}]};return e.jsx("div",{style:{width:n,height:g},children:e.jsx(G,{option:D,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Te({data:n=[],width:g="100%",height:S=350}){const A=(()=>{const f=n.map(x=>x.score),t=Math.max(...f),u=Math.min(...f);return n.map(x=>({...x,isHighest:x.score===t,isLowest:x.score===u,itemStyle:{color:x.score===t?"#10b981":x.score===u?"#ef4444":"rgb(var(--ms-primary-color))"}}))})(),v={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:f=>{const{name:t,value:u,color:x}=f;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${x}"></div>
              <span class="font-semibold text-text text-sm">${t}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm pr-1">Performance Score: </span>
                <span class="font-mono font-bold text-text text-sm">${u}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",show:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12,formatter:"{value}%"}},series:[{name:"Performance Score",type:"bar",barWidth:"60%",itemStyle:{borderRadius:[7,7,0,0],borderWidth:0},label:{show:!0,position:"top",color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"bold",formatter:"{c}%"},emphasis:{disabled:!0},data:A.map(f=>({value:f.score,name:f.name,itemStyle:{...f.itemStyle,borderWidth:0},emphasis:f.isHighest||f.isLowest?void 0:{itemStyle:{opacity:.8}}}))}]};return e.jsx("div",{style:{width:g,height:S},children:e.jsx(G,{option:v,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Pe({data:n,centerLabel:g,width:S="100%",height:s=400}){const A=n.reduce((t,u)=>t+u.value,0),v=Math.max(...n.map(t=>t.value)),f={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:t=>{const u=(t.value/A*100).toFixed(1);return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${t.color}"></div>
              <span class="font-semibold text-text text-sm">${t.name}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Count</span>
                <span class="font-mono font-medium text-text">${t.value.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Percent</span>
                <span class="font-mono font-medium text-text">${u}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},series:[{type:"pie",radius:["37%","77%"],roseType:"area",emphasis:{scale:!0,scaleSize:10,focus:"self"},itemStyle:{borderWidth:0,borderColor:"#fff"},label:{show:!0,fontSize:14,color:"rgb(var(--ms-text-color))",formatter:({name:t,value:u})=>`${t}
{value|${u.toLocaleString()}}`,rich:{value:{fontSize:24,fontWeight:600,color:"rgb(var(--ms-text-color)/0.7)",padding:[2,0,0,0]}}},labelLine:{show:!0,length:20,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},data:n.map(t=>({...t,...t.value===v&&{emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{...t.itemStyle,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}))}]};return e.jsxs("div",{className:"relative",style:{width:S,height:s},children:[e.jsx(G,{option:f,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-[22px] font-bold text-text",children:A.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0",children:g||"Total"})]})]})}function Ge(){var X;const{appName:n,logoUrl:g,logoDarkUrl:S}=ne().branding,[s,A]=le.useState({from:null,to:null}),[v,f]=T.useState([]),[t,u]=T.useState([]),[x,O]=T.useState({}),[E,W]=T.useState(0),_={2:{name:"Fall Alerts",color:"#ef4444"},5:{name:"Device Offline",color:"#f59e0b"}},{data:D,isLoading:a,isError:i,isSuccess:Y,error:M}=ie({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var j,L;const o=((j=D==null?void 0:D.data)==null?void 0:j.device_uptime)??0,b=((L=D==null?void 0:D.data)==null?void 0:L.device_downtime)??0,h=o+b,c=h>0?Math.round(o/h*100):0;W(c)},[D,Y]);const{data:r,isLoading:w,isError:l,isSuccess:y,error:k}=ce({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var b,h;const o=Array.isArray(r==null?void 0:r.data)&&((b=r==null?void 0:r.data)==null?void 0:b.length)>0?(h=r==null?void 0:r.data)==null?void 0:h.map(c=>{var j,L;return{value:(c==null?void 0:c.count)??0,name:((j=_[c==null?void 0:c._id])==null?void 0:j.name)||"Unknown",itemStyle:{color:((L=_[c==null?void 0:c._id])==null?void 0:L.color)||"#9ca3af"}}}):[{value:0,name:"No Data",itemStyle:{color:"#9ca3af"}}];f(o)},[r,y]);const{data:N,isLoading:H,isError:Oe,error:_e,isSuccess:ke}=de({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")}),{data:F,isLoading:Fe,isError:Ce,isSuccess:K,error:$e}=fe({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var b;const o=(b=F==null?void 0:F.data)==null?void 0:b.map(h=>{const c=(h.countLessThan2Min??0)+(h.countGreaterThan2Min??0),j=c>0?(h.countLessThan2Min??0)/c*100:0;return{name:h.closed_by,score:Math.round(j)}});u(o)},[F,K]);const{data:m,isLoading:Ue,isError:We,isSuccess:ze,error:Ie}=me({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});function Q(o){if(!o||o.length===0)return 0;const h=o.filter(c=>c.sla_status).length/o.length*100;return Math.round(h*100)/100}const te=he("(max-width: 1366px)"),C=ue(t),ae=o=>o.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return T.useEffect(()=>{var V,q,J,Z,R,ee;const o={companyName:n,startDate:s.from||p().format("YYYY-MM-DD"),endDate:s.to||p().subtract(30,"day").format("YYYY-MM-DD"),totalAlerts:((V=r==null?void 0:r.data)==null?void 0:V.reduce((d,P)=>d+P.count,0))||0,avgResponseTime:xe(((q=D==null?void 0:D.data)==null?void 0:q.avg_res_time)||0),slaCompliance:((J=(m==null?void 0:m.data)&&Q(m==null?void 0:m.data))==null?void 0:J.toFixed(2))||"0%",deviceUptime:Math.round(E)+"%"},b=((Z=v==null?void 0:v.filter(d=>d.name=="Fall Alerts")[0])==null?void 0:Z.value)||0,h=((R=v==null?void 0:v.filter(d=>d.name=="Device Offline")[0])==null?void 0:R.value)||0,c={fall:b,offline:h,total:b+h},j=new Map;(ee=N==null?void 0:N.data)==null||ee.forEach(d=>{const P=new Date(d.year,d.month-1,d.day),z=P.toISOString().split("T")[0],oe=d.event==="5"?"offline":"fall";j.has(z)||j.set(z,{timestamp:P.getTime(),date:ae(P),fall:0,offline:0,total:0});const $=j.get(z);$[oe]+=d.count||0,$.total=$.fall+$.offline});const L=Array.from(j.values()).sort((d,P)=>d.timestamp-P.timestamp);L.forEach(d=>{delete d.timestamp});const se=t==null?void 0:t.map(d=>({...d,score:`${d.score}%`})),re=pe((m==null?void 0:m.data)||[]);O({basicInfo:o,totalAlertOverview:c,alertTrends:L,agentPerformance:se,slaCompliance:re})},[s.to,s.form,r,N,t,K,m]),e.jsxs("div",{className:"mb-6",children:[" ",e.jsxs("div",{id:"customer_heading",className:"flex justify-between sm:flex-row flex-col gap-4 items-center mb-6",children:[e.jsx(Ee,{}),e.jsxs("div",{className:"flex gap-2  items-center",children:[e.jsxs(ge,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(ye,{variant:"tertiary",children:[e.jsx(be,{}),s!=null&&s.from&&(s!=null&&s.to)?`${s.from} - ${s.to}`:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Start Date"})," ",e.jsx(De,{})," ",e.jsx("span",{children:"End Date"})]})]})}),e.jsx(we,{className:"overflow-hidden p-0",align:"end",children:e.jsx(je,{className:"w-full border-border",mode:"range",selected:s,onSelect:o=>{if(!(o!=null&&o.from)||!(o!=null&&o.to)){A({from:null,to:null});return}A({from:p(o.from).format("YYYY-MM-DD"),to:p(o.to).format("YYYY-MM-DD")})},captionLayout:"dropdown",fixedWeeks:!0,showOutsideDays:!0})})]}),e.jsx(Se,{pdfProps:x})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:" items-center justify-between grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 lg:auto-rows-fr",children:[e.jsx(B,{label:"Total Alerts",value:((X=r==null?void 0:r.data)==null?void 0:X.reduce((o,b)=>o+b.count,0))||0,icon:e.jsx(Ye,{size:20,color:"white"})}),e.jsx(B,{label:"SLA Compliance",value:((m==null?void 0:m.data)&&Q(m==null?void 0:m.data)||0)+"%"||"0%",icon:e.jsx(Me,{size:20,color:"white"})}),e.jsx(B,{label:"Device Uptime",value:Math.round(E)+"%",icon:e.jsx(Ae,{size:20,color:"white"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsx("div",{id:"Total Alert Overview Graph",children:e.jsx(I,{title:e.jsx("h1",{className:"text-lg",children:"Total Alert Overview"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4 !h-full flex items-center justify-center",children:e.jsx(Pe,{data:v,centerLabel:" ",width:"100%",height:te?340:400})})})}),e.jsx("div",{id:"Agent Performance Graph",children:e.jsx(I,{title:e.jsx("h1",{className:"text-lg",children:"Agent Performance"}),headerPadding:"p-4 !text-lg border-none",children:e.jsxs("div",{className:"p-4",children:[e.jsx(Te,{data:t,height:340}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-center gap-4 justify-center mt-4",children:[e.jsx(U,{title:"Total Agent",value:C.totalAgents}),e.jsx(U,{title:"Avg. Performance",value:C.averagePerformance+"%"}),e.jsx(U,{title:"Highest Performance",value:C.highestPerformance+"%"}),e.jsx(U,{title:"Lowest Performance",value:C.lowestPerformance+"%"})]})]})})}),e.jsx("div",{id:"Alert Trends Graph",className:"lg:col-span-2",children:e.jsx(I,{title:e.jsx("h1",{className:"text-lg",children:"Alert Trends"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4",children:e.jsx(Le,{data:N==null?void 0:N.data})})})})]})]})]})}const Ee=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-start gap-2 w-full",children:[e.jsx("h1",{className:"text-text sm:text-xl text-lg",children:"Reporting & Analytics"}),e.jsx("div",{className:"opacity-95",children:e.jsx(Ne,{})})]})}),B=({label:n="",value:g="",icon:S})=>e.jsxs("div",{className:"bg-card p-4 flex items-center justify-between gap-3 rounded-md w-full",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx("h1",{className:"text-lg font-semibold",children:g})]}),e.jsx("div",{className:"p-2 bg-primary w-fit rounded-md text-lg",children:S})]}),U=({title:n,value:g})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsxs("div",{className:"p-2 px-3 bg-primary rounded-lg text-white font-medium text-sm",children:[" ",g]}),e.jsxs("div",{className:"rounded-lg text-sm text-wrap",children:[" ",n]})]})});export{Ge as default};
//# sourceMappingURL=Analytics-DeoTbDG4.js.map
