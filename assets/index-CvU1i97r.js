import{r as o,p as W,j as e,b0 as se,O as oe,C as v,d as S,o as H,b1 as re,t as w,l as q,_ as ie,T as N,E as de,D as ce,b2 as j}from"./index-C49nTNx_.js";import{k as V}from"./Dashboard-BasFdk9c.js";import{W as xe}from"./WeeklyMonthlyPicker-dqONhIas.js";import{F as ue}from"./FileSaver.min-up16P1FK.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},f=new r.Error().stack;f&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[f]="8e55941d-902d-4cd6-8644-eedbb17e2b7f",r._sentryDebugIdIdentifier="sentry-dbid-8e55941d-902d-4cd6-8644-eedbb17e2b7f")}catch{}function pe({data:r}){const[f,i]=o.useState(!1),t=o.useContext(W),[l,n]=o.useState([]),[d,u]=o.useState([]),[h,x]=o.useState(!1),[y,_]=o.useState("");function g(){x(!0),w({role:"installer"}).then(s=>{s&&(n(s==null?void 0:s.data),x(!1))})}function D(s){u(s)}function P(){console.log("cliekd"),x(!0),re(r==null?void 0:r._id,{installer_id:d}).then(s=>{s&&(console.log(s),i(!1),x(!1),t.getlist())}).finally(()=>{i(!1)})}function A(){g()}return e.jsxs("div",{children:[e.jsxs("span",{onClick:()=>{i(!0),A()},className:"flex items-center gap-2 text-blue-500 font-baloo font-semibold",children:[e.jsx(se,{size:18})," Assign Installer"]}),e.jsx(oe,{modalOPen:f,setModalOpen:i,onCancel:()=>i(!1),title:"Assign Installer",isBottomButtomShow:!1,children:e.jsx(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsxs("div",{id:"addSalesAgent",className:"flex gap-4 mb-5  justify-between items-center",children:[e.jsx(S,{mode:"single",maxTagCount:"responsive",optionFontSize:18,optionHeight:50,placeholder:"Search Installer",value:d,onChange:D,onSearch:s=>_(s),style:{width:"100%",borderRadius:"13px"},filterOption:!1,className:"agentSelection h-[40px]",children:l==null?void 0:l.map(s=>e.jsxs(Option,{value:s._id,children:[s.name," ",s.last_name]},s._id))}),e.jsx(H,{onClick:()=>P(),children:"Assign Installer"})]})})})]})}function fe(r){return[...q.get("user").role!=="office"?[{title:"Office Identifier",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.office_name})})}]:[{title:"Action",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap ",children:t.installation_date===null?e.jsx("span",{className:"",children:"N/A"}):t.installer_id?e.jsx("span",{className:"italic",children:"Assigned"}):e.jsx(pe,{data:t})})})},{title:"Installer Status",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.installation_date===null?"N/A":t.installer_id?"Assigned":"Not Assigned"})})},{title:"Report",render:t=>e.jsx("div",{className:"flex justify-center",children:e.jsx(ie,{report:t})})},{title:"Installation Status",render:t=>{let l;switch(t.installation_status){case"not_started":l="bg-red-500";break;case"pending":l="bg-yellow-500";break;case"completed":l="bg-[#1EB564]";break;default:l="bg-black"}const n={not_started:"Not Started",pending:"Pending",completed:"Completed"};return e.jsx("button",{children:e.jsx("span",{className:`text-[14px] xl:text-base capitalize font-normal text-white p-2 px-3 py-1 ${t.installer_id?l:"bg-transparent !text-black"} rounded-lg`,children:t.installer_id?n[t.installation_status]||"Unknown":"N/A"})})}}],{title:"Agent Name (ID Number)",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:[t.agent_name," (",t.agent_unique_id,")"]})})},{title:"Date of Sales",render:t=>{const l=new Date(t.created_at).toLocaleDateString("en-CA");return e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:l})})}},{title:"Preferred Installation Date",render:t=>{const l=t.installation_date?new Date(t.installation_date).toLocaleDateString("en-CA"):"--";return e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:l})})}},{title:"Product Name",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary flex  gap-2",children:t.products.filter((l,n,d)=>{const u=l.type==="Seenyor Kit"&&d.findIndex(h=>h.type==="Seenyor Kit")===n;return!/^AI Sensor/.test(l.type)&&(l.type!=="Seenyor Kit"||u)}).map((l,n)=>{const d=l.type==="Seenyor Kit"?"blue":l.type==="Installation"?"orange":"default";return e.jsx(N,{color:d,children:l.type==="Seenyor Kit"?"Package":l.type},n)})})})},{title:"Product Price",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary",children:["$",t.products.filter(l=>["Seenyor Kit","Installation","AI Monitoring"].includes(l.type)).reduce((l,n)=>l+n.price,0).toFixed(2)]})})},{title:"Addon Name",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary flex gap-2",children:t.products.filter(l=>!["Seenyor Kit","Installation","AI Monitoring"].includes(l.type)).map((l,n)=>e.jsx(N,{children:l.type},n)).length===0?e.jsx("span",{children:"--"}):t.products.filter(l=>!["Seenyor Kit","Installation","AI Monitoring"].includes(l.type)).map((l,n)=>e.jsx(N,{children:l.type},n))})})},{title:"Addon Price",render:t=>e.jsx("button",{children:e.jsx("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:t.products.map((l,n)=>["Seenyor Kit","Installation","AI Monitoring"].includes(l.type)?null:e.jsxs("span",{children:["$",l.price.toFixed(2)]},n)).filter(Boolean).length===0?e.jsx("span",{children:"--"}):t.products.map((l,n)=>["Seenyor Kit","Installation","AI Monitoring"].includes(l.type)?null:e.jsxs("span",{children:["$",l.price.toFixed(2)]},n))})})},{title:"Total Price",render:t=>e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:["$",t.total.toFixed(2)]})})},{title:"Location",render:t=>{var l,n,d,u,h,x;return e.jsx("button",{children:e.jsxs("span",{className:"text-[14px] xl:text-base font-normal text-text-secondary text-nowrap",children:[(l=t.address)==null?void 0:l.line1,","," ",(n=t.address)!=null&&n.line2?((d=t.address)==null?void 0:d.line2)+", ":"",","," ",(u=t.address)==null?void 0:u.city,", ",(h=t.address)==null?void 0:h.state,","," ",t.address?t.address.postal_code:" ",","," ",(x=t.address)==null?void 0:x.country]})})}},{title:"Payment Status",dataIndex:"payment_status",key:"payment_status",filters:[{text:"Completed",value:"completed"},{text:"Pending",value:"pending"},{text:"Cancelled",value:"cancelled"}],filterMultiple:!0,onFilter:(t,l)=>l.payment_status.includes(t),render:(t,l)=>{let n="";switch(t){case"pending":n="orange";break;case"cancelled":n="red";break;case"completed":n="green";break;default:n="black"}return e.jsx("span",{style:{backgroundColor:n,color:"white",padding:"4px 8px",borderRadius:"4px",fontWeight:500,textTransform:"capitalize"},children:t})}}]}const{RangePicker:he}=ce,je=()=>{var E;const[r,f]=o.useState(null),[i,t]=o.useState("all"),[l,n]=o.useState(q.get("user")),[d,u]=o.useState([]),[h,x]=o.useState([]),[y,_]=o.useState(null),[g,D]=o.useState([]),[P,A]=o.useState([]),[s,F]=o.useState({}),[Q,L]=o.useState(!1),[C,U]=o.useState(1),[M,O]=o.useState(null),[k,R]=o.useState(null),Y=fe(),G=async()=>{try{const a=await J(i==="all"?null:i,r==="all"?null:r);if(!a||a.length===0)throw new Error("No data available to download");const m=a.map((p,ne)=>{var z;const K=new Date(p.created_at);return{"No.":ne+1,"Office Name":p.office_name,"Agent ID":p.agent_unique_id,"Agent Name":p.agent_name,"Sale Date":K.toLocaleDateString("en-CA"),"Sale Time":K.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),Products:p.products.map((b,$)=>`${$+1}. ${b.name}`).join(""),"Extra Product":p.products.map((b,$)=>{if(b.type!=="Seenyor Kit"&&b.type!=="Installation"&&b.type!=="AI Monitoring")return b.type}).join(""),"Current Sale Status":p.saleStatus,"City Location":((z=p.address)==null?void 0:z.city)||"N/A"}}),c=j.utils.json_to_sheet(m),B=j.utils.book_new();j.utils.book_append_sheet(B,c,"Sales Report");const te=j.write(B,{bookType:"xlsx",type:"array"}),le=new Blob([te],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ae=`Sales_Report_${new Date().toISOString().split("T")[0]}.xlsx`;ue.saveAs(le,ae)}catch(a){console.error("Error downloading the sales report:",a)}},J=(a,m)=>V({...s,agent_id:a,payment_status:m,from_date:M,to_date:k,limit:1e5}).then(c=>(A(c),c.data)).catch(c=>{throw console.log(c),c}),I=o.useCallback((a,m)=>{L(!0),V({...C,...s,agent_id:a,payment_status:m,from_date:M,to_date:k}).then(c=>{console.log(c),D(c),L(!1)}).catch(c=>{console.log(c)})},[r,i,s.office_id,k,C]);function X(){w({role:"office"}).then(a=>{u(a.data)}).catch(a=>{console.log(a)})}function T(){w({...s,role:"sales_agent"}).then(a=>{x(a.data)}).catch(a=>{console.log(a)})}o.useEffect(()=>{X(),T()},[]),o.useEffect(()=>{T()},[s]),o.useEffect(()=>{I(i==="all"?null:i,r==="all"?null:r)},[I]);function Z(a){console.log(a),O(a.start),R(a.end)}function ee(a){O(a[0]),R(a[1])}return o.useEffect(()=>{if(y)if(y==="all"){if(s.office_id){const a={...s};delete a.office_id,F(a)}}else F(a=>({...a,office_id:y})),t("all")},[y]),e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"Distributor_Dash_Top",className:"flex justify-between w-full mb-5 flex-wrap gap-5 pt-[30px]",children:e.jsxs(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:[l.role=="office"?e.jsx("div",{className:"p-2 px-4 rounded-lg text-[36px] font-bold  text-primary",children:l.office}):l.role=="sales_agent"?null:e.jsx(S,{showSearch:!0,optionFilterProp:"label",onChange:a=>_(a.value),defaultValue:"all",size:"large",className:"custom-select",labelInValue:!0,options:[{value:"all",label:e.jsxs(e.Fragment,{children:["All Offices"," ",e.jsx("span",{className:"highlighted-number",children:d.length})]})},...d.map(a=>({value:a._id,label:a.name}))]}),e.jsxs("div",{id:"DatePickers",className:"flex gap-4 items-center",children:[e.jsx(xe,{placeholder:"Weekly/Monthly",style:{width:"140px",borderRadius:"10px"},handleChnage:Z}),e.jsx(he,{showTime:!1,style:{width:"200px",borderRadius:"10px"},size:"large",placeholder:["Pick Data Range (Start)","End"],format:"YYYY-MM-DD",onChange:(a,m)=>{ee(m)}}),e.jsx(H,{disabled:((E=g==null?void 0:g.data)==null?void 0:E.length)<=0,onClick:G,type:"text",children:"Download"})]})]})}),e.jsxs("div",{id:"dealsDetails",className:" p-[25px] rounded-2xl  bg-white w-full mb-[20px]",children:[e.jsxs("div",{id:"DealsHeader",className:"w-full flex justify-between mb-8",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"All Deal"}),l.role=="sales_agent"?null:e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsxs(v,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:[e.jsx(S,{optionFilterProp:"label",onChange:a=>f(a.value),defaultValue:"all",size:"large",labelInValue:!0,options:[{value:"all",label:"All Sales"},{value:"completed",label:"Completed"},{value:"pending",label:"Pending"},{value:"cancelled",label:"Cancelled"}]}),e.jsx(S,{showSearch:!0,optionFilterProp:"label",onChange:a=>t(a.value),defaultValue:"all",size:"large",value:i,style:{maxWidth:150,zIndex:"400"},labelInValue:!0,options:[{value:"all",label:"All Agents"},...h.map(a=>({value:a._id,label:a.name+" "+a.last_name}))]})]})})]}),e.jsx(W.Provider,{value:{getlist:I,total:g.total||[],page:C,SetPage:U},children:e.jsx(de,{loading:Q,tableData:g.data,columns:Y})})]})]})};export{je as default};
//# sourceMappingURL=index-CvU1i97r.js.map
