import{r,j as g}from"./index-Cx2ZnkBC.js";import{h as F}from"./helper-DZks3_Jq.js";import{L as W,I as z,R as V,T as _,S as q,a as T,C as G}from"./ReactKonvaCore-BbjkCW5f.js";import{C as Z}from"./UseCustomContext-B_8njEg6.js";const $="data:image/png;base64,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",ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAUHSURBVHgB7dvhbdtWGIbRqyL/7U4QdYK4E1SZIN0gyQbdIPIETSdoukE6QeQNkg3UDZwJ1I+wAhiJ/Yq2KZuUzgEuriARsELeJxQpuzUAAAAAACZs1piszWYz3z68nM1ml43BCWQCtiGc1Xi+nbvRPXd6bbMPNc4rlHVjMAIZkZ4hJOsavzqbDEcgT2CAEJJlBXLeGIRA9mjPIdymux75uTEIgQzgiUK4VQXiuA7kWaO3sYXA/gnkBkLgm6MORAjschSBCIH7OqhAKoRuwXeL/0W7CuBbDELgXiYZyJGEsK7x+dr8pcZvNd43Hs2oAzniENY3fRte++Os8ahGFUgtgEVNr9qRhzAW147HvI3zWKxrrGpc7Ot30EYTSB2MZU3v2vSt28RCuMmEjsebGut6vy/3EckoAploHN2C/3xtTDKEm0zweMxrfKr3Pfgvao7lDPK6jdf1ENbb+cuB/8bsmI/Hbebt6n3/1Qb05IFsv6OYt6d3jCH8YETH4z4Gv4kxhjPIvD0uIdDbIX+TLoR76C506yzS7aNDuoN4b4cQiBCG1/3B1Z+NSQUihEdS+/R9nUVO6uGyHbkpBXJWB+6/xqPo/my3IlnVw9/bOD5uPcn78Pcg3Koiuajpoo3A9u7aoj2ynxpwK4FAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEDxrDGaz2SxqelXjtMZljYvZbPaxMVkCGUjFsazp3XdP/1HPf6hI3jYmyUesAVQEb9qPcXzzpl5/15gkgQxjVwDdmeS0MTkCeaBa+POa5js2O+2xDSMkkMdz0pgcgTxQXYCv29Udq12+NCZHIMM43/H6skLqExEjI5AB1OJ/X9Pylpe727y7AmKkfA8ykC6CumD/px6+blcX5N0Z42M9f9GYLIEMaHs94mxxQHzEgkAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFA8OwuG282m9Oa5jVO23Be9NzurH7+L+249d1Xx+q01sgivH5ZYz2bzS5bT7M+G9UPndf0d41FY/RqAfQ6rlNSa/BTG279rWq8rd203rXhzo9Y2ziGfHPw1BY1Pm3XdtTnGqQ7c8wbHJZ5u1rbUQxke82xaHCYFts1fqtdZ5AhL8bhIXpfWN/RSXpxVyD7elPsz6Ees3Xbj6/pxRjI9nbYqjElH9th+rcNb7Xrlm+fi/S3bX/1Mqx1jfN2gGohr2patuGs29XajnYGsr1X/LI5k4zdqsbLPvf2p6r+bV38y/bw/7BXree+utMXStsr/pPG2Hy9y7fDh6DW4vN2P0e3rwAAAAAAjtj/LOk4KUbNh4YAAAAASUVORK5CYII=",te="data:image/png;base64,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",L=({object:a=[],convertCoords:E})=>{const{type:x,up_left:S,low_left:f,up_right:k,low_right:m}=a,M=[...E(S),...E(f),...E(m),...E(k)],C={0:{fill:"black",label:"Invalid Area",stroke:"darkred",icon:"oth"},1:{fill:"black",label:"Custom Area",stroke:"black",icon:"oth"},2:{fill:"black",label:"Bed",stroke:"darkblue",icon:"bed"},3:{fill:"black",label:"Interference Area",stroke:"darkorange",icon:"oth"},4:{fill:"black",label:"Door",stroke:"darkgreen",icon:"door"},5:{fill:"black",label:"Monitoring Area",stroke:"darkpurple",icon:"oth"}}[x]||{fill:"lightgray",label:"Unknown",stroke:"gray"},p=r.useRef(),Q=r.useRef(),[b,y]=r.useState(0),[w,O]=r.useState(0),[P,D]=r.useState(0),[R,Y]=r.useState(0),[K,B]=r.useState(null);r.useEffect(()=>{p.current&&(y(p.current.getWidth()),O(p.current.getHeight()));const h=new window.Image;h.src=C.icon==="bed"?$:C.icon==="door"?ee:te,h.onload=()=>{B(h),D(40),Y(40)}},[C.icon]);const v=h=>{let i=Math.min(...h.filter((H,e)=>e%2===0)),d=Math.max(...h.filter((H,e)=>e%2===0)),X=Math.min(...h.filter((H,e)=>e%2!==0)),U=Math.max(...h.filter((H,e)=>e%2!==0));return[(i+d)/2,(X+U)/2]},[I,j]=v(M);return g.jsxs(g.Fragment,{children:[g.jsx(W,{points:M,closed:!0,fill:C.fill,strokeWidth:2}),K&&g.jsx(z,{ref:Q,image:K,x:I-40/2,y:j-40/2,width:40,height:40}),g.jsx(V,{x:I-b/2-5,y:j-(w+60)/2-5,width:b+10,height:w+10,fill:"rgba(0, 0, 0, 0.7)",cornerRadius:4}),g.jsx(_,{ref:p,text:C.label,fontSize:14,fontStyle:"bold",fill:"white",x:I-b/2,y:j-(w+60)/2})]})},J="/assets/full-Bjw9MgTV.png",ne=({roomInfo:a=[]})=>{console.log(a);const E=r.useContext(Z),{elderlyDetails:x}=E||{},S=(a==null?void 0:a.device_no)||(x==null?void 0:x.deviceId),[f,k]=r.useState([]),[m,M]=r.useState(null),u=r.useRef(),[C,p]=r.useState(1),Q=600,b=500,[y,w]=r.useState(600),[O,P]=r.useState(500),[D,R]=r.useState(0),[Y,K]=r.useState(0),[B,v]=r.useState({up_left:[0,0],low_left:[0,0],up_right:[0,0],low_right:[0,0]}),[I,j]=r.useState([]),h=10,i={x:30*h,y:25*h},d=([e,t])=>[i.x-e*h,i.y+t*h],X=[...d(B.up_left),...d(B.low_left),...d(B.low_right),...d(B.up_right)];function U(e){const t=F(e);let n=t==null?void 0:t.map(s=>s==null?void 0:s.coordinates);k(n)}r.useEffect(()=>{const e=new WebSocket("wss://live.elderlycareplatform.com/ws/");return e.onopen=()=>{console.log("Connected to WebSocket server")},e.onmessage=t=>{var o;const n=JSON.parse(t==null?void 0:t.data),s=(o=JSON.parse(n==null?void 0:n.message))==null?void 0:o.payload;(s==null?void 0:s.deviceCode)===S&&(s!=null&&s.position)&&U(s.position)},e.onerror=t=>{console.error("WebSocket error:",t)},e.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>e.close()},[S]),r.useEffect(()=>{var s;const e=Object.fromEntries(Object.entries(a.device_boundaries).reduce((o,[c,A])=>(c==="_id"||o.push([c,A.split(",").map(Number)]),o),[])),t=(s=a==null?void 0:a.device_areas)==null?void 0:s.map(({_id:o,coordKey:c,...A})=>({...A,up_left:A.up_left.split(",").map(Number),low_left:A.low_left.split(",").map(Number),up_right:A.up_right.split(",").map(Number),low_right:A.low_right.split(",").map(Number)}));v(e),j(t);const n=new window.Image;n.src=J,n.onload=()=>{M(n)}},[a]);const H=e=>{const t=[],[n,s,o,c]=[Math.min(...e.filter((A,l)=>l%2===0)),Math.max(...e.filter((A,l)=>l%2===0)),Math.min(...e.filter((A,l)=>l%2!==0)),Math.max(...e.filter((A,l)=>l%2!==0))];for(let A=o+10;A<c;A+=10)t.push([n,A,s,A]);for(let A=n+10;A<s;A+=10)t.push([A,o,A,c]);return t};return r.useEffect(()=>{const e=()=>{if(u.current){const n=u.current.clientWidth/Q,s=u.current.clientHeight/b,o=Math.min(n,s);p(o);const c=u.current.clientWidth,A=u.current.clientHeight;w(c),P(A);const l=(c-Q*o)/2,N=(A-b*o)/2;R(l),K(N)}};e();const t=new ResizeObserver(e);return u.current&&t.observe(u.current),()=>{t&&t.disconnect()}},[Q,b]),g.jsx("div",{ref:u,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",margin:"0 auto",maxHeight:"500px",maxWidth:"600px"},children:g.jsx(q,{width:y||600,height:O||500,scaleX:C,scaleY:C,children:g.jsxs(T,{x:(y-600*C)/2,y:(O-500*C)/2,children:[g.jsx(W,{points:X,closed:!0,stroke:"rgba(0,0,255, 0.5",strokeWidth:2,dash:[10,5],fill:"rgba(173, 216, 230, 0.3)",opacity:.4}),H(X).map((e,t)=>g.jsx(W,{points:e,stroke:"rgba(0,0,255, 0.8",strokeWidth:.5,dash:[2,3]},t)),g.jsx(W,{points:[i.x-5,i.y-5,i.x+5,i.y-5,i.x+5,i.y+5,i.x-5,i.y+5],closed:!0,stroke:"black",strokeWidth:1,fill:"gray"}),I.map((e,t)=>g.jsx(L,{object:e,convertCoords:d},t)),m&&g.jsx(z,{image:m,x:i.x-50/2,y:i.y-50/2,width:50,height:50}),f==null?void 0:f.map((e,t)=>g.jsx(G,{x:i.x-e.x*10,y:i.y+e.y*10,radius:10,fill:"blue",stroke:"black",strokeWidth:1},t))]})})})},ce=({roomInfo:a=[]})=>{const E=r.useContext(Z),{elderlyDetails:x}=E||{},S=(a==null?void 0:a.room_no)||(x==null?void 0:x.deviceId),[f,k]=r.useState([]),[m,M]=r.useState(null),u=r.useRef(),[C,p]=r.useState(1),Q=600,b=500,[y,w]=r.useState(600),[O,P]=r.useState(500),[D,R]=r.useState(0),[Y,K]=r.useState(0),[B,v]=r.useState({up_left:[0,0],low_left:[0,0],up_right:[0,0],low_right:[0,0],mount_type:"wall"}),[I,j]=r.useState([]),h=10,i={x:30*h,y:0},d=([e,t])=>[i.x-e*h,i.y+t*h],X=[...d(B.up_left),...d(B.low_left),...d(B.low_right),...d(B.up_right)];function U(e){const t=F(e);let n=t==null?void 0:t.map(s=>s==null?void 0:s.coordinates);k(n)}r.useEffect(()=>{const e=new WebSocket("wss://live.elderlycareplatform.com/ws/");return e.onopen=()=>{console.log("Connected to WebSocket server")},e.onmessage=t=>{var o;const n=JSON.parse(t==null?void 0:t.data),s=(o=JSON.parse(n==null?void 0:n.message))==null?void 0:o.payload;(s==null?void 0:s.deviceCode)===S&&(s!=null&&s.position)&&U(s.position)},e.onerror=t=>{console.error("WebSocket error:",t)},e.onclose=()=>{console.log("Disconnected from WebSocket server")},()=>e.close()},[S]),d([f.x,f.y]),r.useEffect(()=>{var n;if(a!=null&&a.device_boundaries){const s=Object.fromEntries(Object.entries(a.device_boundaries).reduce((o,[c,A])=>(c==="_id"||o.push([c,A.split(",").map(Number)]),o),[]));v(s)}const e=(n=a==null?void 0:a.device_areas)==null?void 0:n.map(({_id:s,coordKey:o,...c})=>({...c,up_left:c.up_left.split(",").map(Number),low_left:c.low_left.split(",").map(Number),up_right:c.up_right.split(",").map(Number),low_right:c.low_right.split(",").map(Number)}));j(e);const t=new window.Image;t.src=J,t.onload=()=>{M(t)}},[a]);const H=e=>{const t=[],[n,s,o,c]=[Math.min(...e.filter((A,l)=>l%2===0)),Math.max(...e.filter((A,l)=>l%2===0)),Math.min(...e.filter((A,l)=>l%2!==0)),Math.max(...e.filter((A,l)=>l%2!==0))];for(let A=o+10;A<c;A+=10)t.push([n,A,s,A]);for(let A=n+10;A<s;A+=10)t.push([A,o,A,c]);return t};return r.useEffect(()=>{const e=()=>{if(u.current){const n=u.current.clientWidth/Q,s=u.current.clientHeight/b,o=Math.min(n,s);p(o);const c=u.current.clientWidth,A=u.current.clientHeight;w(c),P(A);const l=(c-Q*o)/2,N=(A-b*o)/2;R(l),K(N)}};e();const t=new ResizeObserver(e);return u.current&&t.observe(u.current),()=>{t&&t.disconnect()}},[Q,b]),g.jsx("div",{ref:u,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",margin:"0 auto",maxHeight:"500px",maxWidth:"600px"},children:g.jsx(q,{width:y||600,height:O||500,scaleX:C,scaleY:C,children:g.jsxs(T,{children:[g.jsx(W,{points:X,closed:!0,stroke:"rgba(0,0,255, 0.5",strokeWidth:2,dash:[10,5],fill:"rgba(173, 216, 230, 0.3)",opacity:.4}),H(X).map((e,t)=>g.jsx(W,{points:e,stroke:"rgba(0,0,255, 0.8",strokeWidth:.5,dash:[2,3]},t)),m&&g.jsx(z,{image:m,x:i.x-50/2,y:i.y-50/2,width:50,height:50}),f==null?void 0:f.map((e,t)=>g.jsx(G,{x:i.x-e.x*10,y:i.y+e.y*10,radius:10,fill:"blue",stroke:"black",strokeWidth:1},t)),I.map((e,t)=>g.jsx(L,{object:e,convertCoords:d},t))]})})})};export{ce as D,ne as a};
