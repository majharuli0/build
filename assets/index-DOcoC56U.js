import{u as W,r as i,au as C,aq as F,j as n,N as A,as as H,ao as P,ab as V,S as Y,ax as q,e as R,ap as $,ay as G,ar as U,av as Q}from"./index-BrMMENGu.js";import"./ActiveAlertsCards-C_g2Jylx.js";import{D as z}from"./RoomMap3-BerE-b19.js";import{u as J,D as X}from"./RoomMap4-DJVmbZjs.js";import{A as K}from"./ActionManu-DaFDU5Aj.js";import{g as Z}from"./elderlySupport-BZa5z82x.js";import{_ as D,a as ee}from"./_baseGetTag-DL1DPc5i.js";import{S as te}from"./index-DfD8IKkv.js";import{C as O}from"./Collapse-CHhx4_wj.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="6d339fbe-c319-4b25-bd94-45d277114e5b",e._sentryDebugIdIdentifier="sentry-dbid-6d339fbe-c319-4b25-bd94-45d277114e5b")}catch{}function ne({data:e={}}){var j,g,I,y,T,_,N;const s=W(),[u,m]=i.useState(null),f=i.useRef(null),p=i.useRef(!1),[v,d]=i.useState(!1),h=i.useRef,x=o=>{switch(o){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};i.useEffect(()=>{var r;const o=(r=e==null?void 0:e.rooms)==null?void 0:r.device_no;return o&&(f.current&&f.current!==o&&C({uid:f.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(c=>console.error(`Error unsubscribing: ${c}`)),F({uid:o,messageType:["1","2","3","4"],topics:{pub:[o]}}).then(()=>{}).catch(c=>console.error(`Error subscribing: ${c}`)),f.current=o),()=>{f.current&&C({uid:f.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(c=>console.error(`Error during cleanup unsubscribe: ${c}`))}},[e]);function w(o){var t;const c=[...P(o)];((t=c[0])==null?void 0:t.postureIndex)===4&&p.current&&(c[0].postureIndex=6,c[0].posture="Resident on Bed",c[0].color="#252F67"),m(c)}function b(){d(!0),p.current=!0,clearTimeout(h.current),h.current=setTimeout(()=>{d(!1),p.current=!1},5e3)}return J({onMessage:o=>{var c,t;const r=(c=JSON.parse(o==null?void 0:o.message))==null?void 0:c.payload;(r==null?void 0:r.deviceCode)===((t=e==null?void 0:e.rooms)==null?void 0:t.device_no)&&(r!=null&&r.position||r!=null&&r.heartbreath)&&(r!=null&&r.position&&w(r.position),r!=null&&r.heartbreath&&b())},dependencies:[e]}),n.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[n.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${x((j=A(e))==null?void 0:j.label)}`,children:[n.jsx("div",{className:"loader"}),n.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[n.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),n.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(g=A(e))==null?void 0:g.title})]}),n.jsx("span",{onClick:()=>{s(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[n.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),n.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),n.jsx("div",{})]}),n.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[n.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((I=e==null?void 0:e.rooms)==null?void 0:I.mount_type)===1&&((y=e==null?void 0:e.rooms)==null?void 0:y.is_device_bind)&&n.jsx(z,{roomInfo:e==null?void 0:e.rooms,position:u}),((T=e==null?void 0:e.rooms)==null?void 0:T.mount_type)===2&&((_=e==null?void 0:e.rooms)==null?void 0:_.is_device_bind)&&n.jsx(X,{roomInfo:e==null?void 0:e.rooms,position:u}),!((N=e==null?void 0:e.rooms)!=null&&N.is_device_bind)&&n.jsx("span",{className:"w-full h-full flex items-center justify-center",children:n.jsx("p",{children:" No Device Data Available"})})]}),n.jsxs("div",{className:"details-container w-1/3 ",children:[n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:H(e.created_at)}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),n.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[n.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:n.jsx(K,{date:e.created_at})}),n.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}function se(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var B=se,re=D,ie=function(){return re.Date.now()},le=ie,ce=/\s/;function ae(e){for(var s=e.length;s--&&ce.test(e.charAt(s)););return s}var de=ae,oe=de,ue=/^\s+/;function fe(e){return e&&e.slice(0,oe(e)+1).replace(ue,"")}var xe=fe;function me(e){return e!=null&&typeof e=="object"}var he=me,be=ee,ge=he,pe="[object Symbol]";function ve(e){return typeof e=="symbol"||ge(e)&&be(e)==pe}var je=ve,ye=xe,k=B,_e=je,L=NaN,Ne=/^[-+]0x[0-9a-f]+$/i,we=/^0b[01]+$/i,Te=/^0o[0-7]+$/i,Ie=parseInt;function Se(e){if(typeof e=="number")return e;if(_e(e))return L;if(k(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=k(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=ye(e);var u=we.test(e);return u||Te.test(e)?Ie(e.slice(2),u?2:8):Ne.test(e)?L:+e}var Ae=Se,Ee=B,E=le,M=Ae,Ce="Expected a function",Re=Math.max,$e=Math.min;function ke(e,s,u){var m,f,p,v,d,h,x=0,w=!1,b=!1,j=!0;if(typeof e!="function")throw new TypeError(Ce);s=M(s)||0,Ee(u)&&(w=!!u.leading,b="maxWait"in u,p=b?Re(M(u.maxWait)||0,s):p,j="trailing"in u?!!u.trailing:j);function g(t){var a=m,l=f;return m=f=void 0,x=t,v=e.apply(l,a),v}function I(t){return x=t,d=setTimeout(_,s),w?g(t):v}function y(t){var a=t-h,l=t-x,S=s-a;return b?$e(S,p-l):S}function T(t){var a=t-h,l=t-x;return h===void 0||a>=s||a<0||b&&l>=p}function _(){var t=E();if(T(t))return N(t);d=setTimeout(_,y(t))}function N(t){return d=void 0,j&&m?g(t):(m=f=void 0,v)}function o(){d!==void 0&&clearTimeout(d),x=0,m=h=f=d=void 0}function r(){return d===void 0?v:N(E())}function c(){var t=E(),a=T(t);if(m=arguments,f=this,h=t,a){if(d===void 0)return I(h);if(b)return clearTimeout(d),d=setTimeout(_,s),g(h)}return d===void 0&&(d=setTimeout(_,s)),v}return c.cancel=o,c.flush=r,c}var Le=ke;const Me=V(Le),{Panel:Oe}=O;function Qe(){i.useContext(Y);const{notificationEvent:e}=q();i.useState("All");const[s,u]=i.useState([]),[m,f]=i.useState(null),[p,v]=i.useState(null),[d,h]=i.useState(null),[x,w]=i.useState(!1),[b,j]=i.useState(1),[g,I]=i.useState(!0),y=i.useRef(null),T=i.useCallback(()=>{!g||x||(w(!0),Z({to_date:"2024-11-30",from_date:R().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:b,...d}).then(t=>{u(a=>[...a,...t.data]),b>=t.totalPages&&I(!1),w(!1)}).catch(t=>{console.error(t),w(!1)}))},[d,b,g,x]);i.useEffect(()=>{T()},[b,d]),i.useEffect(()=>{if(s.length>0&&!m){const t=s[0];f(t._id),v(t)}},[s,m]);const _=t=>{f(t);const a=s.find(l=>l._id===t);v(a)},N=i.useCallback(Me(()=>{if(!y.current||x||!g)return;const{scrollTop:t,scrollHeight:a,clientHeight:l}=y.current;t+l>=a-50&&j(S=>S+1)},200),[x,g]),o=t=>{h(Q(t)),j(1),u([]),I(!0)};i.useEffect(()=>{e&&T()},[e]),i.useEffect(()=>{const t=y.current;return t&&t.addEventListener("scroll",N),()=>{t&&t.removeEventListener("scroll",N)}},[N]);const r=i.useMemo(()=>s.reduce((t,a)=>{const l=a.room_name;return t[l]||(t[l]=[]),t[l].push(a),t},{}),[s]),c=t=>{switch(t){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return n.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[n.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[n.jsx(te,{style:{width:"100%"},block:!0,options:Be,onChange:t=>o(t)}),n.jsxs("div",{ref:y,className:"w-full overflow-auto",style:{height:"440px"},children:[s.length===0&&!x&&n.jsx($,{description:"No active alerts available"}),s.length>0&&n.jsx(O,{children:Object.entries(r).map(([t,a])=>([...new Set(a.map(l=>A(l).label))],n.jsx(Oe,{header:n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("span",{className:"text-black font-semibold",children:t})}),children:a.map(l=>n.jsxs("div",{onClick:()=>_(l._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${m===l._id?"bg-gray-100":""}`,children:[n.jsx("span",{className:"text-[14px] font-semibold",children:R(l.created_at).format("hh:mm:ss a")}),n.jsx(G,{color:c(A(l).label),size:"large"})]},l._id))},t)))}),x&&n.jsx("div",{className:"w-full flex justify-center py-4",children:n.jsx(U,{})}),!g&&s.length>0&&n.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),n.jsx("div",{className:"w-[70%] h-full",children:p?n.jsx(ne,{data:p}):n.jsx($,{description:"Select an alert to view details"})})]})}const Be=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{Qe as R};
//# sourceMappingURL=index-DOcoC56U.js.map
