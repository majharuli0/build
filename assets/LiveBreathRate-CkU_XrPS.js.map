{"version":3,"file":"LiveBreathRate-CkU_XrPS.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Health/Components/LiveBreathRate.jsx"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport LiveRateChart from \"@/Components/GraphAndChart/LiveRateChart\";\nimport { FaLungs } from \"react-icons/fa\";\nimport { CustomContext } from \"@/Context/UseCustomContext\";\nimport { decodeHeartBreath } from \"@/utils/helper\";\nimport { Tooltip } from \"antd\";\nimport { IoMdInformationCircle } from \"react-icons/io\";\nexport default function BreathRate() {\n  const { elderlyDetails, sleepData } = useContext(CustomContext);\n  const deviceCode = elderlyDetails?.deviceId;\n\n  const [data, setData] = useState({\n    time: [],\n    heartRate: [],\n    breathRate: [],\n  });\n\n  const [liveRateData, setLiveRateData] = useState(null);\n  const [lastUpdate, setLastUpdate] = useState(Date.now());\n\n  // Decode action handler\n  const handleDecode = (base64Input) => {\n    const data = decodeHeartBreath(base64Input);\n    setLiveRateData(data);\n    setLastUpdate(Date.now());\n  };\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      const isStale = now - lastUpdate > 5000; // Data is stale if older than 5 seconds\n\n      if (isStale) {\n        setLiveRateData(null);\n        setData({ time: [], heartRate: [], breathRate: [] }); // Reset to empty arrays, not just an empty array\n      } else if (liveRateData) {\n        const newTime = new Date().toLocaleTimeString();\n\n        // Update the data state with liveRateData values\n        setData((prevData) => ({\n          time: [...prevData.time, newTime].slice(-30),\n          heartRate: [...prevData.heartRate, liveRateData.heartRateValue].slice(\n            -30\n          ),\n          breathRate: [\n            ...prevData.breathRate,\n            liveRateData.breathingValue,\n          ].slice(-30),\n        }));\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [liveRateData, lastUpdate]);\n\n  useEffect(() => {\n    const ws = new WebSocket(\"wss://live.elderlycareplatform.com/ws/\");\n    ws.onopen = () => {\n      console.log(\"Connected to WebSocket server\");\n      // ws.send(JSON.stringify({ uid: deviceCode }));\n    };\n    ws.onmessage = (event) => {\n      const data = JSON.parse(event?.data);\n      const payload = JSON.parse(data?.message)?.payload;\n      if (payload?.deviceCode === deviceCode && payload?.heartbreath) {\n        handleDecode(payload.heartbreath);\n      }\n    };\n    ws.onerror = (error) => {\n      // console.error(\"WebSocket error:\", error);\n    };\n    ws.onclose = () => {\n      console.log(\"Disconnected from WebSocket server\");\n    };\n    return () => ws.close();\n  }, [deviceCode]);\n  return (\n    <div className=\"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto\">\n      <div className=\"text-2xl font-bold text-primary flex items-center gap-2\">\n        Current Breathing Pattern\n        <Tooltip\n          title=\"This feature functions only if the user is in the monitoring bed.\"\n          className=\"cursor-pointer\"\n        >\n          <IoMdInformationCircle size=\"18px\" />\n        </Tooltip>\n      </div>\n      <div id=\"LiveRate\" className=\"flex flex-col gap-1 pl-3 mb-2\">\n        <div\n          className={`text-4xl font-bold flex items-center gap-2`}\n          style={{\n            color: \"#FFA54D\",\n          }}\n        >\n          {liveRateData?.breathingValue ?? \"--\"}{\" \"}\n          <span className=\"text-secondary/40\">BPM</span>\n          <FaLungs color=\"#FFA54D\" size={24} />\n        </div>\n      </div>\n      <LiveRateChart data={data} color=\"#FFA54D\" type=\"breathRate\" />\n      <div id=\"footer\">\n        <div className=\"flex justify-evenly items-center\">\n          <div\n            id=\"avgRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {sleepData?.breath_rate_vo?.avg ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Avgerage</div>\n          </div>\n          <div\n            id=\"minRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {\" \"}\n              {sleepData?.breath_rate_vo?.min ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Minimum</div>\n          </div>\n          <div\n            id=\"maxRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {\" \"}\n              {sleepData?.breath_rate_vo?.max ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Maximum</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["BreathRate","elderlyDetails","sleepData","useContext","CustomContext","deviceCode","data","setData","useState","liveRateData","setLiveRateData","lastUpdate","setLastUpdate","handleDecode","base64Input","decodeHeartBreath","useEffect","interval","newTime","prevData","ws","event","payload","_a","error","jsxs","jsx","Tooltip","IoMdInformationCircle","FaLungs","LiveRateChart","_b","_c"],"mappings":"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"}