{"version":3,"file":"index-CqaxYaLU.js","sources":["../../src/Pages/UserProfileView/index.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\nimport { useParams, useLocation } from \"react-router-dom\";\nimport ls from \"store2\";\nimport { getUserDetails, getUserToken } from \"@/api/Users\";\nimport { useCountStore } from \"@/store/index\";\nimport { useNavigate } from \"react-router-dom\";\nimport Loader from \"@/Components/Loader\";\nimport { getToken, setToken } from \"@/utils/auth\";\nexport default function UserProfileView() {\n  const params = useParams();\n  const location = useLocation();\n  const { role } = location.state || {};\n  const [loading, setLoading] = useState(true);\n  const { setStoreRole, setUser } = useCountStore();\n  const navigate = useNavigate();\n  let param = params.id.split(\"-\");\n  const [userRole, setUserRole] = useState(\"\");\n  // Store the original token in localStorage when switching roles\n  const storeOriginalToken = () => {\n    let user = ls.get(\"user\");\n    const currentToken = getToken(); // Get the current token from storage\n\n    if (!ls.get(\"rootToken\")) {\n      ls.set(\"rootToken\", currentToken);\n      ls.set(\"rootRole\", user.role);\n    }\n  };\n\n  // Switch to the new user's token\n  const switchToNewToken = (newToken) => {\n    setToken(newToken); // Replace the token with the new user's token\n  };\n\n  const getUserDetailAndSetRole = useCallback(() => {\n    getUserDetails({\n      id: param[0],\n    })\n      .then((res) => {\n        if (res?.data?.role) {\n          getUserDetail(res?.data?.role);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n  const getUserDetail = useCallback(\n    (role) => {\n      if (param.length >= 2) {\n        getUserToken({\n          id: param[0],\n          params: {\n            role: role === \"nursing_home\" ? \"nurse\" : \"supports_agent\",\n          },\n        })\n          .then(async (res) => {\n            await storeOriginalToken();\n            await setUpEverythingForViewProfile({\n              ...res.data,\n              sub_role: \"elderly\",\n            });\n            await switchToNewToken(res.data.access_token);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n        getUserDetails({\n          id: param[0],\n        })\n          .then((res) => {\n            storeOriginalToken();\n            if (res.data.role !== \"nursing_home\") {\n              setUpEverythingForViewProfile({\n                ...res.data,\n                sub_role: \"elderly\",\n              });\n            }\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        return;\n      }\n      getUserDetails({\n        id: params.id,\n      })\n        .then((res) => {\n          setUpEverythingForViewProfile(res.data);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n      getUserToken({\n        id: params.id,\n      })\n        .then((res) => {\n          storeOriginalToken();\n          switchToNewToken(res.data.access_token);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    [role, params.id]\n  );\n  const nvto = (active) => {\n    if (active == \"super_admin\") {\n      navigate(\"/support-agent/dashboard/\");\n    } else if (active == \"supports_agent\") {\n      navigate(\"/supporter/support-agent/dashboard\");\n    } else if (active == \"nurse\") {\n      navigate(\"/supporter/nurse/dashboard\");\n    } else if (active == \"end_user\") {\n      navigate(\"/supporter/end-user/dashboard\");\n    } else if (active == \"elderly\") {\n      navigate(`/supporter/elderlies/elderly-profile/${param[1]}?tab=overview`);\n    } else {\n      navigate(\"/support-nurnt/dashboard\");\n    }\n  };\n\n  function setUpEverythingForViewProfile(data) {\n    ls.set(\"user\", data);\n    ls.set(\"mainRole\", data.role);\n    ls.set(\"role\", data.role);\n    setStoreRole({ role: data.role });\n    setUser({ role: data.role });\n    setTimeout(() => {\n      setLoading(false);\n      nvto(data?.sub_role || data?.role);\n    }, 1500);\n  }\n\n  useEffect(() => {\n    getUserDetailAndSetRole();\n  }, [getUserDetailAndSetRole]);\n  if (loading) return <Loader loaderTitle=\"Loading User Profile\" />;\n}\n"],"names":["UserProfileView","params","useParams","location","useLocation","role","loading","setLoading","useState","setStoreRole","setUser","useCountStore","navigate","useNavigate","param","userRole","setUserRole","storeOriginalToken","user","ls","currentToken","getToken","switchToNewToken","newToken","setToken","getUserDetailAndSetRole","useCallback","getUserDetails","res","_a","getUserDetail","_b","err","getUserToken","setUpEverythingForViewProfile","nvto","active","data","useEffect","jsx","Loader"],"mappings":"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"}