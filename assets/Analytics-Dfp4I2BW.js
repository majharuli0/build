import{j as e,E as B,hu as de,bA as fe,r as T,hv as me,i as p,hw as he,hx as xe,hy as ue,hz as pe,hA as ge,hB as ve,c8 as re,hC as be,hD as ye,hE as De,h7 as we,hF as je,hG as Se,hH as Ye,hI as Me,hJ as Ae,hK as Ne,hL as Le,hM as Te,hN as Pe,hi as $,hO as Oe,h9 as Ee}from"./index-Cuh2cJkw.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g=new n.Error().stack;g&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[g]="94d33e62-99fb-4569-80db-853636d10794",n._sentryDebugIdIdentifier="sentry-dbid-94d33e62-99fb-4569-80db-853636d10794")}catch{}function _e({width:n="100%",height:g=400,data:S=[]}){const r=()=>{if(!S||S.length===0)return d();const s=new Map;S.forEach(t=>{const w=new Date(t.year,t.month-1,t.day),_=w.toISOString().split("T")[0],U=t.event==="5"?"Device Offline":"Fall Alert";s.has(_)||s.set(_,{date:w,timestamp:w.getTime(),dateFormatted:M(w,S),tooltipDate:v(w),"Fall Alert":0,"Device Offline":0});const K=s.get(_);K[U]+=t.count||0});const i=Array.from(s.values()).sort((t,w)=>t.timestamp-w.timestamp),y=i.map(t=>t.dateFormatted),D=i.map(t=>t.tooltipDate),b=i.map(t=>t["Fall Alert"]),u=i.map(t=>t["Device Offline"]);return{dates:y,tooltipDates:D,fallAlertData:b,deviceOfflineData:u}},M=(s,i)=>{if(!i||i.length===0)return s.toLocaleDateString("en-US",{month:"short",day:"numeric"});const y=i.map(w=>new Date(w.year,w.month-1,w.day)),D=new Date(Math.min(...y)),b=new Date(Math.max(...y)),u=Math.abs(b-D);return Math.ceil(u/(1e3*60*60*24))<=60?s.toLocaleDateString("en-US",{month:"short",day:"numeric"}):s.toLocaleDateString("en-US",{month:"short",year:"2-digit"})},v=s=>s.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),d=()=>{const s=[],i=[],y=[],D=[],b=new Date;for(let u=9;u>=0;u--){const t=new Date(b);t.setDate(b.getDate()-u),s.push(t.toLocaleDateString("en-US",{month:"short",day:"numeric"})),i.push(t.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),y.push(Math.floor(0)),D.push(Math.floor(0))}return{dates:s,tooltipDates:i,fallAlertData:y,deviceOfflineData:D}},{dates:a,tooltipDates:m,fallAlertData:h,deviceOfflineData:E}=r(),P=s=>s<=10?0:s<=20?1:s<=40?2:s<=60?3:Math.floor(s/12),x=h.reduce((s,i)=>s+i,0),G=E.reduce((s,i)=>s+i,0),H={tooltip:{trigger:"axis",backgroundColor:"transparent",borderWidth:0,className:"!shadow-none",axisPointer:{type:"line",lineStyle:{color:"rgb(var(--ms-text-color)/0.2)",width:1}},formatter:s=>{const i=s[0].dataIndex,y=m[i],D=s.find(u=>u.seriesName==="Fall Alert"),b=s.find(u=>u.seriesName==="Device Offline");return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[180px]">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${y}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #ef4444"></div>
                  <span class="text-text/80 text-sm">Fall Alert</span>
                </div>
                <span class="font-mono font-medium text-text">${(D==null?void 0:D.value)||0}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #f59e0b"></div>
                  <span class="text-text/80 text-sm">Device Offline</span>
                </div>
                <span class="font-mono font-medium text-text">${(b==null?void 0:b.value)||0}</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!0,bottom:10,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"normal"},formatter:function(s){return s==="Fall Alert"?`Fall Alert: ${x.toLocaleString()}`:s==="Device Offline"?`Device Offline: ${G.toLocaleString()}`:s}},grid:{left:"3%",right:"4%",bottom:a.length>15?"80px":"50px",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:a,axisLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.2)"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:11,interval:P(a.length),rotate:a.length>15?45:0,margin:a.length>15?15:8,formatter:s=>s},axisTick:{alignWithLabel:!0,interval:P(a.length)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12}},series:[{name:"Fall Alert",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#ef4444"},itemStyle:{color:"#ef4444"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(239, 68, 68, 0.3)"},{offset:1,color:"rgba(239, 68, 68, 0.05)"}]}},data:h},{name:"Device Offline",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#f59e0b"},itemStyle:{color:"#f59e0b"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 158, 11, 0.3)"},{offset:1,color:"rgba(245, 158, 11, 0.05)"}]}},data:E}],dataZoom:[{type:"inside",start:a.length>30?100-Math.floor(3e3/a.length):0,end:100},{show:!1}]};return e.jsx("div",{style:{width:n,height:g},children:e.jsx(B,{option:H,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function ke({data:n=[],width:g="100%",height:S=350}){const M=(()=>{const d=n.map(h=>h.score),a=Math.max(...d),m=Math.min(...d);return n.map(h=>({...h,isHighest:h.score===a,isLowest:h.score===m,itemStyle:{color:h.score===a?"#10b981":h.score===m?"#ef4444":"rgb(var(--ms-primary-color))"}}))})(),v={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:d=>{const{name:a,value:m,color:h}=d;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${h}"></div>
              <span class="font-semibold text-text text-sm">${a}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm pr-1">Performance Score: </span>
                <span class="font-mono font-bold text-text text-sm">${m}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",show:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12,formatter:"{value}%"}},series:[{name:"Performance Score",type:"bar",barWidth:"60%",itemStyle:{borderRadius:[7,7,0,0],borderWidth:0},label:{show:!0,position:"top",color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"bold",formatter:"{c}%"},emphasis:{disabled:!0},data:M.map(d=>({value:d.score,name:d.name,itemStyle:{...d.itemStyle,borderWidth:0},emphasis:d.isHighest||d.isLowest?void 0:{itemStyle:{opacity:.8}}}))}]};return e.jsx("div",{style:{width:g,height:S},children:e.jsx(B,{option:v,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Ce({data:n,centerLabel:g,width:S="100%",height:r=400}){const M=n.reduce((a,m)=>a+m.value,0),v=Math.max(...n.map(a=>a.value)),d={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:a=>{const m=(a.value/M*100).toFixed(1);return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${a.color}"></div>
              <span class="font-semibold text-text text-sm">${a.name}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Count</span>
                <span class="font-mono font-medium text-text">${a.value.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Percent</span>
                <span class="font-mono font-medium text-text">${m}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},series:[{type:"pie",radius:["37%","77%"],roseType:"area",emphasis:{scale:!0,scaleSize:10,focus:"self"},itemStyle:{borderWidth:0,borderColor:"#fff"},label:{show:!0,fontSize:14,color:"rgb(var(--ms-text-color))",formatter:({name:a,value:m})=>`${a}
{value|${m.toLocaleString()}}`,rich:{value:{fontSize:24,fontWeight:600,color:"rgb(var(--ms-text-color)/0.7)",padding:[2,0,0,0]}}},labelLine:{show:!0,length:20,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},data:n.map(a=>({...a,...a.value===v&&{emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{...a.itemStyle,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}))}]};return e.jsxs("div",{className:"relative",style:{width:S,height:r},children:[e.jsx(B,{option:d,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-[22px] font-bold text-text",children:M.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0",children:g||"Total"})]})]})}function Je(){var V,J,Z,q;const{appName:n,logoUrl:g,logoDarkUrl:S}=de().branding,[r,M]=fe.useState({from:null,to:null}),[v,d]=T.useState([]),[a,m]=T.useState([]),[h,E]=T.useState({}),P={2:{name:"Fall Alerts",color:"#ef4444"},5:{name:"Device Offline",color:"#f59e0b"}},{data:x,isLoading:G,isError:H,isSuccess:s,error:i}=me({to_date:r.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:r.to||p().format("YYYY-MM-DD")}),y=((V=x==null?void 0:x.data)==null?void 0:V.device_uptime)??0,D=((J=x==null?void 0:x.data)==null?void 0:J.device_downtime)??0,b=y+D,u=b>0?Math.round(y/b*100):0,{data:t,isLoading:w,isError:_,isSuccess:U,error:K}=he({to_date:r.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:r.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var Y,j;const o=Array.isArray(t==null?void 0:t.data)&&((Y=t==null?void 0:t.data)==null?void 0:Y.length)>0?(j=t==null?void 0:t.data)==null?void 0:j.map(f=>{var A,O;return{value:(f==null?void 0:f.count)??0,name:((A=P[f==null?void 0:f._id])==null?void 0:A.name)||"Unknown",itemStyle:{color:((O=P[f==null?void 0:f._id])==null?void 0:O.color)||"#9ca3af"}}}):[{value:0,name:"No Data",itemStyle:{color:"#9ca3af"}}];d(o)},[t,U]);const{data:N,isLoading:$e,isError:We,error:ze,isSuccess:Ue}=xe({to_date:r.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:r.to||p().format("YYYY-MM-DD")}),{data:k,isLoading:Ie,isError:Be,isSuccess:X,error:Ge}=ue({to_date:r.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:r.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var Y;const o=(Y=k==null?void 0:k.data)==null?void 0:Y.map(j=>{const f=(j.countLessThan2Min??0)+(j.countGreaterThan2Min??0),A=f>0?(j.countLessThan2Min??0)/f*100:0;return{name:j.closed_by,score:Math.round(A)}});m(o)},[k,X]);const{data:l,isLoading:He,isError:Ke,isSuccess:Xe,error:Qe}=pe({to_date:r.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:r.to||p().format("YYYY-MM-DD")});function Q(o){if(!o||o.length===0)return 0;const j=o.filter(f=>f.sla_status).length/o.length*100;return Math.round(j*100)/100}const oe=ge("(max-width: 1366px)"),C=ve(a),ne=o=>o.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return T.useEffect(()=>{var R,ee,te,ae,se;const o={companyName:n,startDate:r.from||p().format("YYYY-MM-DD"),endDate:r.to||p().subtract(30,"day").format("YYYY-MM-DD"),totalAlerts:((R=t==null?void 0:t.data)==null?void 0:R.reduce((c,L)=>c+L.count,0))||0,avgResponseTime:re(((ee=x==null?void 0:x.data)==null?void 0:ee.avg_res_time)||0),slaCompliance:(l==null?void 0:l.data)&&Q(l==null?void 0:l.data)||"0%",deviceUptime:Math.round(u)+"%"},Y=((te=v==null?void 0:v.filter(c=>c.name=="Fall Alerts")[0])==null?void 0:te.value)||0,j=((ae=v==null?void 0:v.filter(c=>c.name=="Device Offline")[0])==null?void 0:ae.value)||0,f={fall:Y,offline:j,total:Y+j},A=new Map;(se=N==null?void 0:N.data)==null||se.forEach(c=>{const L=new Date(c.year,c.month-1,c.day),I=L.toISOString().split("T")[0],ce=c.event==="5"?"offline":"fall";A.has(I)||A.set(I,{timestamp:L.getTime(),date:ne(L),fall:0,offline:0,total:0});const F=A.get(I);F[ce]+=c.count||0,F.total=F.fall+F.offline});const O=Array.from(A.values()).sort((c,L)=>c.timestamp-L.timestamp);O.forEach(c=>{delete c.timestamp});const le=a==null?void 0:a.map(c=>({...c,score:`${c.score}%`})),ie=be((l==null?void 0:l.data)||[]);E({basicInfo:o,totalAlertOverview:f,alertTrends:O,agentPerformance:le,slaCompliance:ie})},[r.to,r.form,t,N,a,X,l]),e.jsxs("div",{className:"mb-6",children:[" ",e.jsxs("div",{id:"customer_heading",className:"flex justify-between sm:flex-row flex-col gap-4 items-center mb-6",children:[e.jsx(Fe,{}),e.jsxs("div",{className:"flex gap-2  items-center",children:[e.jsxs(ye,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(we,{variant:"tertiary",children:[e.jsx(je,{}),r!=null&&r.from&&(r!=null&&r.to)?`${r.from} - ${r.to}`:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Start Date"})," ",e.jsx(Se,{})," ",e.jsx("span",{children:"End Date"})]})]})}),e.jsx(Ye,{className:"overflow-hidden p-0",align:"end",children:e.jsx(Me,{className:"w-full border-border",mode:"range",selected:r,onSelect:o=>{if(!(o!=null&&o.from)||!(o!=null&&o.to)){M({from:null,to:null});return}M({from:p(o.from).format("YYYY-MM-DD"),to:p(o.to).format("YYYY-MM-DD")})},captionLayout:"dropdown",fixedWeeks:!0,showOutsideDays:!0})})]}),e.jsx(Ae,{pdfProps:h})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:" items-center justify-between grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 lg:auto-rows-fr",children:[e.jsx(W,{label:"Total Alerts",value:((Z=t==null?void 0:t.data)==null?void 0:Z.reduce((o,Y)=>o+Y.count,0))||0,icon:e.jsx(Ne,{size:20,color:"white"})}),e.jsx(W,{label:"Avg. Response Time",value:re(((q=x==null?void 0:x.data)==null?void 0:q.avg_res_time)||0),icon:e.jsx(Le,{size:20,color:"white"})}),e.jsx(W,{label:"SLA Compliance",value:(l==null?void 0:l.data)&&Q(l==null?void 0:l.data)||"0%",icon:e.jsx(Te,{size:20,color:"white"})}),e.jsx(W,{label:"Device Uptime",value:Math.round(u)+"%",icon:e.jsx(Pe,{size:20,color:"white"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2 lg:auto-rows-fr",children:[e.jsx("div",{id:"Total Alert Overview Graph",children:e.jsx($,{title:e.jsx("h1",{className:"text-lg",children:"Total Alert Overview"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4 !h-full flex items-center justify-center",children:e.jsx(Ce,{data:v,centerLabel:" ",width:"100%",height:oe?340:400})})})}),e.jsx("div",{id:"Alert Trends Graph",children:e.jsx($,{title:e.jsx("h1",{className:"text-lg",children:"Alert Trends"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4",children:e.jsx(_e,{data:N==null?void 0:N.data})})})}),e.jsx("div",{id:"Agent Performance Graph",children:e.jsx($,{title:e.jsx("h1",{className:"text-lg",children:"Agent Performance"}),headerPadding:"p-4 !text-lg border-none",children:e.jsxs("div",{className:"p-4",children:[e.jsx(ke,{data:a,height:340}),e.jsxs("div",{className:"flex items-center gap-4 justify-center mt-4",children:[e.jsx(z,{title:"Total Agent",value:C.totalAgents}),e.jsx(z,{title:"Avg. Performance",value:C.averagePerformance+"%"}),e.jsx(z,{title:"Highest Performance",value:C.highestPerformance+"%"}),e.jsx(z,{title:"Lowest Performance",value:C.lowestPerformance+"%"})]})]})})}),e.jsx("div",{id:"SLA Compliance Report Graph",children:e.jsx($,{title:e.jsx("h1",{className:"text-lg",children:"SLA Compliance Report"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx(Oe,{width:"100%",height:400,data:l==null?void 0:l.data})})})]})]})]})}const Fe=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-start gap-2 w-full",children:[e.jsx("h1",{className:"text-text sm:text-xl text-lg",children:"Reporting & Analytics"}),e.jsx("div",{className:"opacity-95",children:e.jsx(Ee,{})})]})}),W=({label:n="",value:g="",icon:S})=>e.jsxs("div",{className:"bg-card p-4 flex items-center justify-between gap-3 rounded-md w-full",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:n}),e.jsx("h1",{className:"text-lg font-semibold",children:g})]}),e.jsx("div",{className:"p-2 bg-primary w-fit rounded-md text-lg",children:S})]}),z=({title:n,value:g})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsxs("div",{className:"p-2 px-3 bg-primary rounded-lg text-white font-medium text-sm",children:[" ",g]}),e.jsxs("div",{className:"rounded-lg text-sm text-wrap",children:[" ",n]})]})});export{Je as default};
//# sourceMappingURL=Analytics-Dfp4I2BW.js.map
