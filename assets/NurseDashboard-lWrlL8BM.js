import{bz as W,af as Ae,ag as Le,ak as Z,aj as Oe,bA as Pe,al as Fe,r,ac as ze,bB as Te,bC as Ee,bD as Be,bE as He,ae as q,ab as $,bF as Ye,aq as Ue,au as Ve,bG as Ge,bH as We,bI as qe,bJ as Je,bK as Ke,j as e,aP as H,b5 as ne,i as Xe,o as Y,B as F,bL as le,bM as pe,G as J,bN as ie,bO as Qe,bP as ee,bQ as Ze,bR as et,bS as tt,bT as xe,bU as st,bV as ot,bW as nt,bX as it,bY as ge,bZ as z,b_ as at,b$ as he,c0 as rt,c1 as be,c2 as ve,c3 as je,c4 as ye,c5 as lt,c6 as Ne,c7 as _e,c8 as we,c9 as ct,T as dt,ca as mt,cb as Ce,cc as X,cd as ae,ce as ft,S as te,cf as ut,h as E,p as Se,aI as pt,cg as xt,bx as gt,ch as ht,u as bt,ci as Ie,cj as $e,ck as vt,cl as Re,cm as jt,C as yt,D as Nt,cn as _t,co as wt,aK as Ct,cp as St,cq as de,cr as G,cs as It,ct as $t,cu as Rt,cv as Dt,cw as kt,cx as Mt,cy as At,cz as Lt,cA as Q,cB as Ot,cC as Pt,cD as Ft,cE as zt,cF as Tt}from"./index-gXk-EDDa.js";import{S as Et}from"./index-6FDmhbhe.js";import"./Steps-BzgK--Tr.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="436a9d32-ea66-44f3-999b-e38385c2f0bb",t._sentryDebugIdIdentifier="sentry-dbid-436a9d32-ea66-44f3-999b-e38385c2f0bb")}catch{}const Bt=t=>{const{componentCls:s,notificationMarginEdge:o,animationMaxHeight:n}=t,p=`${s}-notice`,d=new W("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),m=new W("antNotificationTopFadeIn",{"0%":{top:-n,opacity:0},"100%":{top:0,opacity:1}}),g=new W("antNotificationBottomFadeIn",{"0%":{bottom:t.calc(n).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),h=new W("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[s]:{[`&${s}-top, &${s}-bottom`]:{marginInline:0,[p]:{marginInline:"auto auto"}},[`&${s}-top`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:m}},[`&${s}-bottom`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:g}},[`&${s}-topRight, &${s}-bottomRight`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:d}},[`&${s}-topLeft, &${s}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:o,_skip_check_:!0},[p]:{marginInlineEnd:"auto",marginInlineStart:0},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:h}}}}},Ht=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],Yt={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},Ut=(t,s)=>{const{componentCls:o}=t;return{[`${o}-${s}`]:{[`&${o}-stack > ${o}-notice-wrapper`]:{[s.startsWith("top")?"top":"bottom"]:0,[Yt[s]]:{value:0,_skip_check_:!0}}}}},Vt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={overflow:"hidden",[`& > ${t.componentCls}-notice`]:{opacity:0,transition:`opacity ${t.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${t.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},s)},Gt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={background:t.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},s)},Wt=t=>{const{componentCls:s}=t;return Object.assign({[`${s}-stack`]:{[`& > ${s}-notice-wrapper`]:Object.assign({transition:`transform ${t.motionDurationSlow}, backdrop-filter 0s`,willChange:"transform, opacity",position:"absolute"},Vt(t))},[`${s}-stack:not(${s}-stack-expanded)`]:{[`& > ${s}-notice-wrapper`]:Object.assign({},Gt(t))},[`${s}-stack${s}-stack-expanded`]:{[`& > ${s}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${t.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:t.margin,width:"100%",insetInline:0,bottom:t.calc(t.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},Ht.map(o=>Ut(t,o)).reduce((o,n)=>Object.assign(Object.assign({},o),n),{}))},qt=t=>{const{iconCls:s,componentCls:o,boxShadow:n,fontSizeLG:p,notificationMarginBottom:d,borderRadiusLG:m,colorSuccess:g,colorInfo:h,colorWarning:j,colorError:u,colorTextHeading:x,notificationBg:N,notificationPadding:S,notificationMarginEdge:v,notificationProgressBg:y,notificationProgressHeight:_,fontSize:a,lineHeight:i,width:l,notificationIconSize:f,colorText:c}=t,b=`${o}-notice`;return{position:"relative",marginBottom:d,marginInlineStart:"auto",background:N,borderRadius:m,boxShadow:n,[b]:{padding:S,width:l,maxWidth:`calc(100vw - ${Z(t.calc(v).mul(2).equal())})`,overflow:"hidden",lineHeight:i,wordWrap:"break-word"},[`${b}-message`]:{color:x,fontSize:p,lineHeight:t.lineHeightLG},[`${b}-description`]:{fontSize:a,color:c,marginTop:t.marginXS},[`${b}-closable ${b}-message`]:{paddingInlineEnd:t.paddingLG},[`${b}-with-icon ${b}-message`]:{marginInlineStart:t.calc(t.marginSM).add(f).equal(),fontSize:p},[`${b}-with-icon ${b}-description`]:{marginInlineStart:t.calc(t.marginSM).add(f).equal(),fontSize:a},[`${b}-icon`]:{position:"absolute",fontSize:f,lineHeight:1,[`&-success${s}`]:{color:g},[`&-info${s}`]:{color:h},[`&-warning${s}`]:{color:j},[`&-error${s}`]:{color:u}},[`${b}-close`]:Object.assign({position:"absolute",top:t.notificationPaddingVertical,insetInlineEnd:t.notificationPaddingHorizontal,color:t.colorIcon,outline:"none",width:t.notificationCloseButtonSize,height:t.notificationCloseButtonSize,borderRadius:t.borderRadiusSM,transition:`background-color ${t.motionDurationMid}, color ${t.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center",background:"none",border:"none","&:hover":{color:t.colorIconHover,backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive}},Fe(t)),[`${b}-progress`]:{position:"absolute",display:"block",appearance:"none",inlineSize:`calc(100% - ${Z(m)} * 2)`,left:{_skip_check_:!0,value:m},right:{_skip_check_:!0,value:m},bottom:0,blockSize:_,border:0,"&, &::-webkit-progress-bar":{borderRadius:m,backgroundColor:"rgba(0, 0, 0, 0.04)"},"&::-moz-progress-bar":{background:y},"&::-webkit-progress-value":{borderRadius:m,background:y}},[`${b}-actions`]:{float:"right",marginTop:t.marginSM}}},Jt=t=>{const{componentCls:s,notificationMarginBottom:o,notificationMarginEdge:n,motionDurationMid:p,motionEaseInOut:d}=t,m=`${s}-notice`,g=new W("antNotificationFadeOut",{"0%":{maxHeight:t.animationMaxHeight,marginBottom:o},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[s]:Object.assign(Object.assign({},Oe(t)),{position:"fixed",zIndex:t.zIndexPopup,marginRight:{value:n,_skip_check_:!0},[`${s}-hook-holder`]:{position:"relative"},[`${s}-fade-appear-prepare`]:{opacity:"0 !important"},[`${s}-fade-enter, ${s}-fade-appear`]:{animationDuration:t.motionDurationMid,animationTimingFunction:d,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${s}-fade-leave`]:{animationTimingFunction:d,animationFillMode:"both",animationDuration:p,animationPlayState:"paused"},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationPlayState:"running"},[`${s}-fade-leave${s}-fade-leave-active`]:{animationName:g,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${m}-actions`]:{float:"left"}}})},{[s]:{[`${m}-wrapper`]:Object.assign({},qt(t))}}]},Kt=t=>({zIndexPopup:t.zIndexPopupBase+Pe+50,width:384}),Xt=t=>{const s=t.paddingMD,o=t.paddingLG;return Le(t,{notificationBg:t.colorBgElevated,notificationPaddingVertical:s,notificationPaddingHorizontal:o,notificationIconSize:t.calc(t.fontSizeLG).mul(t.lineHeightLG).equal(),notificationCloseButtonSize:t.calc(t.controlHeightLG).mul(.55).equal(),notificationMarginBottom:t.margin,notificationPadding:`${Z(t.paddingMD)} ${Z(t.paddingContentHorizontalLG)}`,notificationMarginEdge:t.marginLG,animationMaxHeight:150,notificationStackLayer:3,notificationProgressHeight:2,notificationProgressBg:`linear-gradient(90deg, ${t.colorPrimaryBorderHover}, ${t.colorPrimary})`})},Qt=Ae("Notification",t=>{const s=Xt(t);return[Jt(s),Bt(s),Wt(s)]},Kt);function De(t,s){return s===null||s===!1?null:s||r.createElement(ze,{className:`${t}-close-icon`})}const Zt={success:He,info:Be,error:Ee,warning:Te},es=t=>{const{prefixCls:s,icon:o,type:n,message:p,description:d,actions:m,role:g="alert"}=t;let h=null;return o?h=r.createElement("span",{className:`${s}-icon`},o):n&&(h=r.createElement(Zt[n]||null,{className:q(`${s}-icon`,`${s}-icon-${n}`)})),r.createElement("div",{className:q({[`${s}-with-icon`]:h}),role:g},h,r.createElement("div",{className:`${s}-message`},p),d&&r.createElement("div",{className:`${s}-description`},d),m&&r.createElement("div",{className:`${s}-actions`},m))};function ts(t,s,o){let n;switch(t){case"top":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:s,bottom:"auto"};break;case"topLeft":n={left:0,top:s,bottom:"auto"};break;case"topRight":n={right:0,top:s,bottom:"auto"};break;case"bottom":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:o};break;case"bottomLeft":n={left:0,top:"auto",bottom:o};break;default:n={right:0,top:"auto",bottom:o};break}return n}function ss(t){return{motionName:`${t}-fade`}}function os(t,s,o){return typeof t<"u"?t:o==null?void 0:o.closeIcon}var ns=function(t,s){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,n=Object.getOwnPropertySymbols(t);p<n.length;p++)s.indexOf(n[p])<0&&Object.prototype.propertyIsEnumerable.call(t,n[p])&&(o[n[p]]=t[n[p]]);return o};const me=24,is=4.5,as="topRight",rs=({children:t,prefixCls:s})=>{const o=We(s),[n,p,d]=Qt(s,o);return n($.createElement(qe,{classNames:{list:q(p,d,o)}},t))},ls=(t,{prefixCls:s,key:o})=>$.createElement(rs,{prefixCls:s,key:o},t),cs=$.forwardRef((t,s)=>{const{top:o,bottom:n,prefixCls:p,getContainer:d,maxCount:m,rtl:g,onAllRemoved:h,stack:j,duration:u,pauseOnHover:x=!0,showProgress:N}=t,{getPrefixCls:S,getPopupContainer:v,notification:y,direction:_}=r.useContext(Ue),[,a]=Ve(),i=p||S("notification"),l=M=>ts(M,o??me,n??me),f=()=>q({[`${i}-rtl`]:g??_==="rtl"}),c=()=>ss(i),[b,C]=Ge({prefixCls:i,style:l,className:f,motion:c,closable:!0,closeIcon:De(i),duration:u??is,getContainer:()=>(d==null?void 0:d())||(v==null?void 0:v())||document.body,maxCount:m,pauseOnHover:x,showProgress:N,onAllRemoved:h,renderNotifications:ls,stack:j===!1?!1:{threshold:typeof j=="object"?j==null?void 0:j.threshold:void 0,offset:8,gap:a.margin}});return $.useImperativeHandle(s,()=>Object.assign(Object.assign({},b),{prefixCls:i,notification:y})),C});function ds(t){const s=$.useRef(null);return Ye(),[$.useMemo(()=>{const n=g=>{var h;if(!s.current)return;const{open:j,prefixCls:u,notification:x}=s.current,N=`${u}-notice`,{message:S,description:v,icon:y,type:_,btn:a,actions:i,className:l,style:f,role:c="alert",closeIcon:b,closable:C}=g,M=ns(g,["message","description","icon","type","btn","actions","className","style","role","closeIcon","closable"]),B=i??a,O=De(N,os(b,t,x));return j(Object.assign(Object.assign({placement:(h=void 0)!==null&&h!==void 0?h:as},M),{content:$.createElement(es,{prefixCls:N,icon:y,type:_,message:S,description:v,actions:B,role:c}),className:q(_&&`${N}-${_}`,l,x==null?void 0:x.className),style:Object.assign(Object.assign({},x==null?void 0:x.style),f),closeIcon:O,closable:C??!!O}))},d={open:n,destroy:g=>{var h,j;g!==void 0?(h=s.current)===null||h===void 0||h.close(g):(j=s.current)===null||j===void 0||j.destroy()}};return["success","info","warning","error"].forEach(g=>{d[g]=h=>n(Object.assign(Object.assign({},h),{type:g}))}),d},[]),$.createElement(cs,Object.assign({key:"notification-holder"},t,{ref:s}))]}function ms(t){return ds(t)}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],us=Je("circle",fs);function ps({isvisible:t,setVisible:s,id:o,firstAlarm:n}){var i;const p=()=>{s(!1),m([]),h(1),u(!1),N(!1)},[d,m]=r.useState([]),[g,h]=r.useState(1),[j,u]=r.useState(!1),[x,N]=r.useState(!1),[S,v]=r.useState(!1),y=r.useCallback(async(l=1,f=!1)=>{var c;f?v(!0):N(!0);try{const b=await Ke(o,{page:l,limit:50}),C=((c=b==null?void 0:b.data[0])==null?void 0:c.logs_before_resovle)||[];m(f?M=>[...M,...C]:C),u(C.length===50),f||h(1)}catch(b){console.log(b)}finally{N(!1),v(!1)}},[o]),_=()=>{const l=g+1;h(l),y(l,!0)};r.useEffect(()=>{o&&t&&y(1,!1)},[o,t,y]);const a=[...n?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ne(n.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:((i=H(n))==null?void 0:i.title)||"Alarm Triggered"}),key:"first-alarm"}]:[],...d.map((l,f)=>{var c;return{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ne(l.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:(c=H(l))==null?void 0:c.title}),key:`log-${f}`}}),...n!=null&&n.closed_at?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ne(n.closed_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:"Alarm Resolved"}),key:"resolved"}]:[]];return e.jsx(Xe,{open:t,onCancel:p,footer:null,centered:!0,className:"!w-[60vw] max-h-[90svh] bg-white !border-none overflow-x-hidden rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-[24px] font-semibold",children:"Alarm Logs"}),x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(Y,{size:"large"})}):e.jsxs(e.Fragment,{children:[e.jsx(Et,{progressDot:!0,current:a.length,direction:"vertical",items:a,className:"max-h-[70vh] overflow-y-auto"}),S&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(Y,{size:"small"})}),j&&!S&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(F,{type:"primary",onClick:_,className:"load-more-btn",children:"Load More"})}),d.length===0&&!n&&!x&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No logs found"})]})]})})}function xs({data:t={}}){var g,h,j,u,x,N,S;const{deviceData:s}=r.useContext(le),o=r.useContext(pe),{elderlyDetails:n}=o||{},p=(t==null?void 0:t.device_no)||(n==null?void 0:n.deviceId),d=r.useMemo(()=>{var v;return((v=s[p])==null?void 0:v.position)||[]},[(g=s[p])==null?void 0:g.position]),m=r.useMemo(()=>{const v=s[p],y=v==null?void 0:v.hbstaticsTimestamp,_=Date.now();return!(v!=null&&v.hbstatics)||!y||(_-y)/1e3>90?null:v.hbstatics},[s[p]]);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit",children:[(d==null?void 0:d.length)>0?e.jsx(J,{color:"white",overlayInnerStyle:{color:"black",padding:"10px"},title:d==null?void 0:d.map((v,y)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-2 rounded-full",children:e.jsx(ie,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-[14px] m-0",children:v==null?void 0:v.posture})})]},y)),children:e.jsx("div",{className:"flex -space-x-4 cursor-pointer",children:d==null?void 0:d.map((v,y)=>e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-1 rounded-full border-2 border-white",children:e.jsx(ie,{size:16,color:"white"})},y))})}):e.jsx("div",{className:"bg-primary p-1 rounded-full border-2 border-white",children:e.jsx(ie,{size:16,color:"white"})}),e.jsx("span",{className:"font-bold text-[14px]",children:d?d==null?void 0:d.length:0})]}),(t==null?void 0:t.room_type)==2&&m&&e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit px-2 py-1",children:[e.jsx("div",{className:"pr-1",children:e.jsx(Qe,{size:20,color:`${(u=(j=(h=ee(m))==null?void 0:h.statusEvents)==null?void 0:j.sleepState)==null?void 0:u.color}`})}),e.jsx("span",{className:"font-semibold",children:((S=(N=(x=ee(m))==null?void 0:x.statusEvents)==null?void 0:N.sleepState)==null?void 0:S.label)||"--"})]})]})}function gs({data:t={},elderlyId:s}){const[o,n]=r.useState(!1),[p,d]=r.useState(!1),[m,g]=r.useState(null),h=r.useCallback(()=>{d(!0),Ze({room_id:t==null?void 0:t.device_no,elderly_id:s}).then(u=>{g(u.data)}).catch(u=>console.log(u)).finally(()=>{d(!1)})},[t==null?void 0:t.device_no,s]);r.useEffect(()=>{h()},[h]);function j(u){u&&it(u)}return e.jsxs("div",{className:"flex flex-col gap-2 h-full mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-[20px] font-medium",children:t==null?void 0:t.name}),e.jsx(xs,{data:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(F,{icon:e.jsx(et,{}),onClick:()=>j(t==null?void 0:t.device_no),children:[" ","Call"]}),e.jsxs(F,{icon:e.jsx(tt,{}),onClick:()=>n(!0),children:[" ","Settings"]})]})]}),e.jsxs(Y,{spinning:p,className:"relative",children:[(t==null?void 0:t.is_device_bind)==!1&&e.jsx("div",{className:"w-full h-full absolute bg-slate-400/20 top-0 z-10 backdrop-blur-sm flex items-center justify-center rounded-2xl",children:e.jsx(xe,{size:40,color:"red"})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 h-full w-full border border-gray-200 rounded-2xl overflow-hidden relative z-1",children:[(t==null?void 0:t.mount_type)===2&&e.jsx(st,{roomInfo:m}),(t==null?void 0:t.mount_type)===1&&e.jsx(ot,{roomInfo:m})]})]}),e.jsx(nt,{isvisible:o,setVisible:n,elderly_id:s,device_id:t==null?void 0:t.device_no,room_id:t==null?void 0:t._id})]})}const hs=r.forwardRef(({className:t,inset:s,children:o,...n},p)=>e.jsxs(ge,{ref:p,className:z("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...n,children:[o,e.jsx(at,{className:"ml-auto"})]}));hs.displayName=ge.displayName;const bs=r.forwardRef(({className:t,...s},o)=>e.jsx(he,{ref:o,className:z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));bs.displayName=he.displayName;const vs=r.forwardRef(({className:t,sideOffset:s=4,...o},n)=>e.jsx(rt,{children:e.jsx(be,{ref:n,sideOffset:s,className:z("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...o})}));vs.displayName=be.displayName;const js=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(ve,{ref:n,className:z("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...o}));js.displayName=ve.displayName;const ys=r.forwardRef(({className:t,children:s,checked:o,...n},p)=>e.jsxs(je,{ref:p,className:z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:o,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ye,{children:e.jsx(lt,{className:"h-4 w-4"})})}),s]}));ys.displayName=je.displayName;const Ns=r.forwardRef(({className:t,children:s,...o},n)=>e.jsxs(Ne,{ref:n,className:z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ye,{children:e.jsx(us,{className:"h-2 w-2 fill-current"})})}),s]}));Ns.displayName=Ne.displayName;const _s=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(_e,{ref:n,className:z("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...o}));_s.displayName=_e.displayName;const ws=r.forwardRef(({className:t,...s},o)=>e.jsx(we,{ref:o,className:z("-mx-1 my-1 h-px bg-muted",t),...s}));ws.displayName=we.displayName;function Cs({data:t={}}){var g,h,j,u;const[s,o]=r.useState(!1),[n,p]=r.useState(!1),d=(t==null?void 0:t.response_details)||((g=t==null?void 0:t.response_details)==null?void 0:g.length)>0&&(t==null?void 0:t.response_details[0])||null;function m(){o(!0)}return e.jsxs("div",{className:"p-4 border border-gray-200 rounded-md w-full",children:[e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h2",{className:"text-[18px] font-semibold",children:(h=H(t))==null?void 0:h.title}),e.jsx("div",{className:"size-2 bg-slate-400 rounded-xl"}),e.jsx("span",{className:"text-[13px] font-medium opacity-80",children:ct(t==null?void 0:t.created_at)})]}),e.jsxs("div",{children:[t!=null&&t.res_time?e.jsxs(dt,{color:"purple",className:"font-semibold",children:[mt((t==null?void 0:t.res_time)||0)," Resp. Time"]}):null,(t==null?void 0:t.event)==2&&e.jsx(J,{title:"Fall Playback",children:e.jsx(F,{shape:"circle",onClick:()=>m(),icon:e.jsx(Ce,{})})})]})]}),e.jsx("div",{className:"bg-[#80CAA7]/5 mt-6 border border-[#0091DA] cursor-pointer hover:bg-[#0091DA]/10 rounded-sm",onClick:()=>p(!0),children:e.jsxs(X,{separator:">",className:"text-[#0091DA] p-3",children:[e.jsx(X.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",ae(t==null?void 0:t.created_at)]})," ",(j=H(t))==null?void 0:j.title]})}),d&&d!==null&&e.jsx(X.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",ae(d==null?void 0:d.created_at)]})," ",(u=H(d))==null?void 0:u.title]})}),(t==null?void 0:t.closed_at)&&e.jsx(X.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",ae(t==null?void 0:t.closed_at)]})," Alarm Resolved"]})})]})})]}),e.jsx(ft,{isvisible:s,setVisible:o,data:t}),n&&e.jsx(ps,{isvisible:n,setVisible:p,id:t==null?void 0:t._id,firstAlarm:t})]})}function Ss({id:t}){const[s,o]=$.useState(!1),[n,p]=$.useState([]),[d,m]=$.useState(0),[g,h]=$.useState(1),j=5,{resolvedAlarm:u,setResolvedAlarm:x}=r.useContext(te),N=$.useCallback((y=1)=>{o(!0),ut({room_id:t,page:y,limit:j,to_date:E().format("YYYY-MM-DD")}).then(_=>{p(y===1?_.data||[]:a=>[...a,..._.data||[]]),m(_.total)}).catch(_=>{console.error(_)}).finally(()=>o(!1))},[t,u]);$.useEffect(()=>{t&&(h(1),N(1))},[t,N]);const S=()=>{const y=g+1;h(y),N(y)},v=n.length<d;return e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Today’s Alarm Logs"}),e.jsx("hr",{className:"w-full m-0"})]}),(n==null?void 0:n.length)===0&&!s?e.jsx(Se,{description:"Alarm Logs Not Available For Today",className:"mt-4"}):e.jsxs("div",{className:"flex flex-col w-full gap-3",children:[n==null?void 0:n.map((y,_)=>e.jsx(Cs,{data:y},_)),s&&e.jsx("div",{className:"flex justify-center my-2",children:e.jsx(Y,{})}),!s&&v&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(F,{onClick:S,children:"Load More"})})]})]})}function Is({elderlyId:t}){const[s,o]=r.useState([]),n=["Critical"],p=r.useCallback(async()=>{const m=[];let g=10;for(const h of n){if(g<=0)break;const j=xt(h);if(j)try{const x=(await pt({to_date:"2024-11-30",from_date:E().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t,limit:g,lookup:!1,...j})).data||[];if(m.push(...x),g-=x.length,g<=0)break}catch(u){console.error(`Error fetching ${h} alerts:`,u)}}o(m)},[t]);r.useEffect(()=>{t&&(p(),console.log(s))},[p,t]);const d={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,centerMode:!1,variableWidth:!1,adaptiveHeight:!0,appendDots:m=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"5px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:m})})};return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(gt,{...d,className:"w-full transition-all duration-300",children:s==null?void 0:s.map((m,g)=>(console.log(m),e.jsx(ht,{item:m,onResolved:()=>p()},g+1)))})})})}const $s=({open:t,setOpen:s,data:o})=>{var d,m,g,h,j,u;const n=()=>s(!1),p=bt();return e.jsx(Ie,{deviceId:((d=o==null?void 0:o.details)==null?void 0:d.length)>0?(m=o==null?void 0:o.details)==null?void 0:m.filter(x=>x.device_no).map(x=>x.device_no).join(","):"",children:e.jsxs($e,{title:null,onClose:n,closeIcon:e.jsx(Re,{size:24}),size:"large",className:"relative ",open:t,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pt-2 pb-4 fixed w-[calc(736px-48px)] top-[calc(57px)] bg-white z-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:(o==null?void 0:o.name)||"Name not found"}),e.jsx("p",{className:"text-lg text-gray-600",children:(o==null?void 0:o.room)||"Room No. Not Found"})]}),e.jsx(F,{size:"large",icon:e.jsx(vt,{}),iconPosition:"end",type:"primary",onClick:()=>{window.scrollTo(0,0),p(`/supporter/elderlies/elderly-profile/${o.id}?tab=overview`)},children:"View Profile"})]}),e.jsx("div",{className:"mt-[77px]"}),e.jsx(Is,{elderlyId:o==null?void 0:o.id}),e.jsxs("div",{className:"mb-8 mt-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Room Map"}),e.jsx("hr",{className:"w-full m-0"})]}),(g=o==null?void 0:o.details)==null?void 0:g.filter(x=>x==null?void 0:x.device_no).map((x,N)=>e.jsx(gs,{data:x,elderlyId:o==null?void 0:o.id},N)),((j=(h=o==null?void 0:o.details)==null?void 0:h.filter(x=>x==null?void 0:x.device_no))==null?void 0:j.length)==0&&e.jsx(Se,{description:"No Room",className:"mt-4"})]}),e.jsx("div",{className:"mb-8 mt-8",children:e.jsx(Ss,{id:(u=o==null?void 0:o.details)==null?void 0:u.filter(x=>(x==null?void 0:x.room_type)==2)[0]._id})})]})})},Rs=$.memo($s);function Ds({setOpen:t,open:s,room_id:o}){const[n,p]=r.useState([]),[d,m]=r.useState(1),[g,h]=r.useState(!1),[j,u]=r.useState(!1),[x,N]=r.useState(1),[S,v]=r.useState(""),[y,_]=r.useState(null);function a(){t(!1)}const i=r.useCallback((c=1,b=!1)=>{h(!0),jt({limit:30,page:c,room_no:o,to_date:y?y.format("YYYY-MM-DD"):E().format("YYYY-MM-DD"),sort_by:x}).then(C=>{p(M=>b?[...M,...C.data]:C.data),C.total_pages&&c<C.total_pages?u(!0):u(!1)}).catch(console.error).finally(()=>h(!1))},[x,S,y]);r.useEffect(()=>{m(1),i(1,!1)},[i]);const l=()=>{const c=d+1;m(c),i(c,!0)},f=[{title:e.jsx("span",{className:"px-0 block font-medium text-gray-700",children:"Check-In"}),dataIndex:"time_of_visit",key:"time_of_visit",render:c=>e.jsx("div",{className:"px-2",children:e.jsx("div",{className:"rounded-[6px] text-nowrap bg-white border border-[#E4E4E7] px-3 py-1 text-[12px] font-medium text-gray-700 inline-block",children:E(c).format("HH:mm:ss")})})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Check-Out"}),dataIndex:"exit_time",key:"exit_time",render:c=>e.jsx("div",{className:"px-2 ",children:c&&E(c).format("HH:mm:ss")||"-"})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Stay"}),key:"duration",render:c=>e.jsx("div",{className:"px-2 ",children:St(c==null?void 0:c.time_of_visit,c==null?void 0:c.exit_time)})},{title:e.jsx("span",{className:"px-0 block text-nowrap font-medium text-gray-700",children:"Room #"}),key:"room_no",render:c=>e.jsxs("div",{className:"px-2",children:[c==null?void 0:c.room_no," ",(c==null?void 0:c.elderly_name)&&NaN+(c==null?void 0:c.elderly_name)]})}];return e.jsx($e,{title:null,onClose:a,closeIcon:e.jsx(Re,{size:24}),size:"large",open:!0,children:e.jsxs("div",{className:" bg-white rounded-[12px] w-full",children:[e.jsxs("h2",{className:"text-[22px] font-semibold mb-4",children:["Visit Logs - ",e.jsxs("small",{className:"text-slate-500",children:[" Room ",o]})]}),e.jsx(yt,{theme:{token:{colorPrimary:"#64748b"}},children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Nt,{onChange:c=>_(c),placeholder:"Today"}),e.jsxs("div",{className:"flex items-center px-3 py-1 border rounded cursor-pointer",onClick:()=>N(c=>c===1?0:1),children:["Sort ",x===1?e.jsx(_t,{}):e.jsx(wt,{})]})]})}),e.jsx("div",{style:{maxHeight:"auto",overflowY:"auto"},children:e.jsx("div",{className:"w-full ",children:e.jsx(Ct,{columns:f,dataSource:n,pagination:!1,loading:g&&d===1,size:"middle",rowClassName:(c,b)=>b===0?"bg-white":(b-1)%2===0?"bg-gray-50":"bg-white",className:`\r
      [&_.ant-table-thead>tr>th]:!bg-gray-100\r
      [&_.ant-table-thead>tr>th]:!py-3\r
      [&_.ant-table-thead>tr>th]:!text-gray-700\r
      [&_.ant-table-thead>tr>th]:!font-semibold\r
      [&_.ant-table-tbody_td]:!border-none\r
      [&_.ant-table-tbody_td]:!whitespace-normal\r
    `})})}),j&&!g&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(F,{onClick:l,type:"default",children:"Load More"})}),j&&g&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(Y,{})})]})})}function fe({deviceCode:t="",selectedEvents:s=[],group:o="all",rooms:n=[],deviceOnline:p,visit_count:d}){var v,y,_,a;const{deviceData:m}=r.useContext(le),g=r.useMemo(()=>({0:null,1:Dt,2:Rt,3:$t,4:It,5:Ce,6:G,9:G,10:G,11:G,7:de,8:de}),[]),h=r.useMemo(()=>({2:1,1:2,3:3,4:4}),[]),j=i=>i.room_type===2?"Bedroom":i.name&&i.name.trim()!==""?i.name:{1:"Living Room",2:"Bedroom",3:"Bathroom",4:"Other Room"}[i.room_type]||"Unknown Room",u=r.useMemo(()=>{if(!n||n.length===0)return null;const i=[...n].sort((l,f)=>{const c=h[l.room_type]||999,b=h[f.room_type]||999;return c-b});for(const l of i){if(!l.device_no)continue;const f=m[l.device_no],c=(f==null?void 0:f.position)||[];if(c.length>0)return{room:l,deviceData:f,positionData:c,deviceCode:l.device_no}}return null},[n,m,h]),x=r.useMemo(()=>{var c,b;if(!u)return null;const i=u.deviceData,l=i==null?void 0:i.hbstaticsTimestamp;return!(i!=null&&i.hbstatics)||!l||(Date.now()-l)/1e3>90?null:(b=(c=ee(i.hbstatics))==null?void 0:c.statusEvents)==null?void 0:b.sleepState},[u]),N=r.useMemo(()=>{if(!u)return[];const{positionData:i}=u;return!s||s.length===0?i:i.filter(l=>s.includes(l.posture))},[u,s]);if(!u)return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{className:"text-[#6B7280] w-fit p-[16px] bg-[#F3F4F6] rounded-full",style:{backgroundColor:(v=n[0])!=null&&v.is_device_bind?"#F3F4F6":"#FCA5A520"},children:e.jsx(J,{title:(y=n[0])!=null&&y.is_device_bind?"Out of Room":" Device Offline",children:(_=n[0])!=null&&_.is_device_bind?e.jsx(kt,{size:20}):e.jsx(xe,{size:20,color:"red"})})}),e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] font-medium text-primary/85",children:(a=n[0])!=null&&a.is_device_bind?"Out of Room":" Device Offline"})})]});const S=()=>{const{room:i}=u,l=N[0];return i.room_type===2?l.postureIndex===6&&x?x.label:l.posture:`In ${j(i)}`};return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{children:e.jsx(J,{color:"white",className:"flex -space-x-3 cursor-pointer",overlayInnerStyle:{color:"black",padding:"10px"},title:N.map((i,l)=>{let f=i==null?void 0:i.posture;const{room:c}=u;let b=!1,C=null;return c.room_type===2&&i.postureIndex===6&&x?(f=x.label,b=!0,C=x.color2):c.room_type!==2&&(f=`In ${j(c)}`),e.jsxs("div",{className:"flex items-center gap-2 w-fit",style:{marginBottom:l===N.length-1?"0":"8px"},children:[e.jsx("div",{style:{backgroundColor:b?C:i==null?void 0:i.color2},className:"p-2 rounded-full",children:e.jsx(Mt,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm m-0",children:f})})]},l)}),children:N.map((i,l)=>{let f=g[i.postureIndex],c=!1,b=null;const{room:C}=u;return C.room_type===2&&i.postureIndex===6&&x&&(c=!0,b=x.color2),e.jsx("div",{style:{backgroundColor:c?`${b}30`:`${i==null?void 0:i.color2}30`},className:"rounded-full p-[15px] flex items-center justify-center border-2 border-white",children:c?e.jsx(G,{size:20,color:b}):f&&e.jsx(f,{size:20,color:i==null?void 0:i.color2})},l)})})}),N.length>0&&e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] text-[#4B5563] font-medium",children:S()})})]})}function ue({deviceCode:t,visit_count:s=0,onClick:o}){const{visitCountMap:n,setInitialCount:p}=r.useContext(te);return r.useEffect(()=>{p(t,s)},[t,s]),e.jsxs("div",{onClick:o,className:"text-[12px] text-[#6B7280] font-medium cursor-pointer hover:text-slate-800",children:[n[t]||0," Visits"]})}const ks=({name:t,room:s,deviceCode:o,selectedEvents:n,sleepScore:p,emergencyContacts:d=[],rooms:m=[],isDanger:g=!0,currentAlertDetails:h,priority:j=0,user:u})=>{var i;const[x,N]=r.useState(!1),[S,v]=r.useState(!1),[y,_]=$.useState(null),a=(i=m==null?void 0:m.filter(l=>(l==null?void 0:l.room_type)==2)[0])==null?void 0:i.is_device_bind;return e.jsxs(e.Fragment,{children:[j==1?e.jsx("div",{className:"relative rounded-[10px] min-w-[220px] max-w-[220px] w-full flex-grow h-fit cursor-pointer border-2 p0 card_UI",onClick:()=>N(!0),style:{borderColor:"#FCA5A5"},children:e.jsx("div",{className:"bg-white/90 rounded-[7px] border border-gray-200 p-[10px] flex flex-col gap-4 h-full ",children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-medium font-roboto text-gray-500 leading-none w-full justify-center flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(fe,{deviceCode:o,rooms:m,visit_count:u==null?void 0:u.visit_count,deviceOnline:a}),e.jsx(ue,{onClick:l=>{var f;l.stopPropagation(),v(!0),_((f=m[0])==null?void 0:f.room_no)},deviceCode:o,visit_count:u==null?void 0:u.visit_count})]})]})})}):e.jsx("div",{className:"relative bg-white rounded-[10px]  cursor-pointer border-2 border-[#8BD1A5] p-[10px] min-w-[220px] max-w-[220px] card_UI w-fit flex-grow flex flex-col h-fit",onClick:()=>N(!0),style:{borderColor:a?"#8BD1A5":"#00000010"},children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-semibold text-[#6B7280] leading-none w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(fe,{deviceCode:o,rooms:m,visit_count:u==null?void 0:u.visit_count}),e.jsx(ue,{onClick:l=>{var f;l.stopPropagation(),v(!0),_((f=m[0])==null?void 0:f.room_no)},deviceCode:o,visit_count:u==null?void 0:u.visit_count})]})]})}),S&&e.jsx(Ds,{open:S,setOpen:v,room_id:y}),x&&e.jsx(Rs,{open:x,setOpen:N,data:u})]})},re=$.memo(ks),Ms=({users:t,selectedEvents:s,notVisitedRoom:o,isActiveAlertsSelect:n,loading:p})=>{const{deviceData:d}=r.useContext(le),[m,g]=r.useState([]),h="criticalAlarmCountsCache";r.useEffect(()=>{var i;const a=localStorage.getItem(h);if(a){const l=JSON.parse(a);Date.now()-l.timestamp<24*60*60*1e3&&g(l.data)}At({to_date:E().subtract(14,"day").format("YYYY-MM-DD"),from_date:(i=E())==null?void 0:i.format("YYYY-MM-DD"),limit:1e3}).then(l=>{const f=(l==null?void 0:l.data)||[];g(f),localStorage.setItem(h,JSON.stringify({data:f,timestamp:Date.now()}))}).catch(l=>{console.log(l)})},[]);const j=r.useMemo(()=>{const a={};for(const i of m){a[i.room_id]||(a[i.room_id]={});const l=i.event;a[i.room_id][l]=(a[i.room_id][l]||0)+i.count}return a},[m]),u={2:3},x=a=>{const i=j[a];return i?Object.entries(u).some(([l,f])=>(i[l]||0)>=f):!1},N=a=>!a.rooms||a.rooms.length===0?!1:a.rooms.some(i=>{if(!i.device_no)return!1;const l=d[i.device_no];return(l==null?void 0:l.position)&&l.position.length>0}),S=r.useMemo(()=>!s||s.length===0?t:s.includes("outOfRoom")?t.filter(a=>a.is_device_bind!==!1&&!N(a)):t.filter(a=>{var M,B,O;if(!N(a))return!1;const i={2:1,1:2,3:3,4:4,5:5},l=[...a.rooms||[]].sort((L,D)=>{const K=i[L.room_type]||999,U=i[D.room_type]||999;return K-U});let f=null;for(const L of l){if(!L.device_no)continue;const D=d[L.device_no];if(D!=null&&D.position&&D.position.length>0){f={room:L,deviceData:D};break}}if(!f)return!1;const c=f.deviceData.position||[];if(c.length===0)return!1;const b=f.deviceData;let C=null;return b!=null&&b.hbstatics&&(b!=null&&b.hbstaticsTimestamp)&&(Date.now()-b.hbstaticsTimestamp)/1e3<=90&&(C=((O=(B=(M=ee(b.hbstatics))==null?void 0:M.statusEvents)==null?void 0:B.sleepState)==null?void 0:O.label)||null),c.every(L=>{const D=c[0];if(!D)return!1;if(D.postureIndex===6){if(s.some(U=>["awake","asleep"].includes(U))){if(!C)return!1;if(s.includes("awake"))return C==="Awake";if(s.includes("asleep"))return["Light Sleep","Deep Sleep"].includes(C)}return s.includes(6)}return s.includes(D.postureIndex)})}),[d,s,t,n,o]),[v,y,_]=r.useMemo(()=>{const a=[],i=[],l=[];return S.forEach(f=>{if(f.is_device_bind===!1){l.push(f);return}const c=f.room_id;x(c)?a.push(f):i.push(f)}),o?[a.filter(f=>!f.visit_count||f.visit_count==0),i.filter(f=>!f.visit_count||f.visit_count==0),l.filter(f=>!f.visit_count||f.visit_count==0)]:[a,i,l]},[S,j,n,o]);return e.jsxs("div",{className:"flex flex-col gap-6",children:[p&&(t==null?void 0:t.length)==0&&e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from({length:8}).map((a,i)=>e.jsx(As,{},i))}),v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsxs("h2",{className:"text-sm text-primary/90 text-nowrap flex items-center",children:["High Risk Residents"," ",e.jsx(J,{className:"ml-2",title:"A room is marked as high risk if a resident has fallen 3 or more times in the last 2 weeks.",children:e.jsx(Lt,{className:"text-sm text-primary cursor-pointer"})})]}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((a,i)=>e.jsx(re,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"All Residents"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((a,i)=>e.jsx(re,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),_.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"Offline Rooms"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(a=>e.jsx(re,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]})]})},As=()=>e.jsx("div",{className:"relative rounded-[9px] min-w-[220px] max-w-[280px] w-fit flex-grow h-fit cursor-pointer border-2",children:e.jsxs("div",{className:"bg-white/90 rounded-[7px]  p-[10px] flex flex-col gap-4 h-full relative",children:[e.jsx("div",{className:"bg-[linear-gradient(to_bottom,_#fef2f2_20%,_#ffffff_80%)] absolute inset-[1px] rounded-[6px] -z-10"}),e.jsxs("div",{className:"flex flex-col justify-between items-center w-full",children:[e.jsxs("div",{className:"text-[14px] font-semibold text-gray-500 leading-none w-full flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-gray-300"}),e.jsx(Q.Input,{active:!0,size:"small",style:{width:80}})]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-1 w-full",children:e.jsx(Q.Input,{active:!0,size:"small",style:{width:100}})}),e.jsx("div",{className:"mt-4 mb-1",children:e.jsx(Q.Button,{active:!0,size:"small",style:{width:120}})})]}),e.jsx("div",{className:"flex justify-between z-10 absolute top-2 right-2",children:e.jsx(Q.Avatar,{active:!0,size:"small",shape:"circle"})})]})}),Ls=(t,s=24*60*60*1e3)=>{const o=localStorage.getItem(t);if(!o)return null;const n=JSON.parse(o);return Date.now()-n.timestamp<s?n.data:null},Os=(t,s)=>{localStorage.setItem(t,JSON.stringify({data:s,timestamp:Date.now()}))};function Ts(){const[t,s]=r.useState(""),[o,n]=r.useState(""),[p,d]=r.useState([]),[m,g]=r.useState(!1),[h,j]=r.useState(1),u=30,{totalResident:x,setTotalResident:N,setActiveAlerts:S,activeAlerts:v,selectedEvents:y,setSelectedEvents:_,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l,setNotVisitRoomCount:f,offlineRoomCount:c,setOfflineRoomCount:b}=r.useContext(te),{resolvedAlarm:C,setResolvedAlarm:M}=r.useContext(te),{notificationEvent:B}=ms(),O="roomListCache",L="allUIDsCache",D=r.useCallback(async(P=1,T=!1)=>{var se,V;try{if(P===1&&!T){const w=localStorage.getItem(O);if(w){const I=JSON.parse(w);Date.now()-I.timestamp<24*60*60*1e3&&(d(I.data),N(I.totalResident||0),f(I.notVisitRoomCount||0))}}g(!0);const R=await Ot({page:P,limit:u});N((R==null?void 0:R.total)||0);const oe=R.data.map(w=>{var A;const I=w.rooms.find(k=>(k==null?void 0:k.room_type)===2)||"";return{id:w._id,name:w.name||"N/A",room:w.room_no||"N/A",visit_count:w.visit_count||0,room_id:I==null?void 0:I._id,is_device_bind:(I==null?void 0:I.is_device_bind)||!1,sleepScore:Math.floor(Math.random()*100),emergency_contacts:w.emergency_contacts||[],deviceCode:I==null?void 0:I.device_no,rooms:(w.rooms||[]).filter(k=>k.device_no&&k.device_no.trim()!=="").map(k=>({room:k.name||"N/A",device_no:k.device_no,room_no:w.room_no,room_type:k.room_type,id:k._id,is_device_bind:k.is_device_bind})),currentAlertDetails:{...H(w==null?void 0:w.alarms_data[0]),created_at:(A=w==null?void 0:w.alarms_data[0])==null?void 0:A.created_at},priority:w==null?void 0:w.highest_priority,details:w==null?void 0:w.rooms}});d(w=>T?[...w,...oe]:oe);const ke=R.data.map(w=>{const I=w.rooms.find(A=>(A==null?void 0:A.room_type)===2)||"";return(I==null?void 0:I.device_no)||null}).filter(Boolean),Me=(se=R.data.filter(w=>{const I=w.rooms.find(A=>(A==null?void 0:A.room_type)===2)||"";return(I==null?void 0:I.is_device_bind)===!1}))==null?void 0:se.length;b(Me);const ce=(V=R.data.filter(w=>!w.visit_count||w.visit_count==0))==null?void 0:V.length;f(ce||0),n(ke.join(",")),localStorage.setItem(O,JSON.stringify({data:oe,timestamp:Date.now(),totalResident:(R==null?void 0:R.total)||0,notVisitRoomCount:ce||0}))}catch(R){console.log(R)}finally{g(!1)}},[C,B]),K=r.useCallback(async()=>{var P;try{const T=Ls(L);T&&s(T);const V=(P=(await Pt()).data)==null?void 0:P.map(R=>R==null?void 0:R.uid).filter(Boolean).join(",");s(V),Os(L,V)}catch(T){console.log(T)}},[]);r.useEffect(()=>{D(1),K()},[D]);const U=()=>{if(p.length<x){const P=h+1;j(P),D(P,!0)}};return e.jsx(Ie,{deviceId:t||o,children:e.jsx(pe.Provider,{value:{selectedEvents:y,setSelectedEvents:_,setActiveAlerts:S,activeAlerts:v,totalResident:x,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l},children:e.jsxs("div",{className:"w-full bg-[#F4F4F4] h-[calc(100svh-100px)] flex flex-col items-start font-poppins relative ",children:[e.jsxs("div",{className:"p-[20px] w-full flex lg:flex-nowrap flex-wrap gap-2 lg:gap-8 sticky top-0 bg-gradient-to-b from-[#F4F4F4] via-[#F4F4F4]/70 to-[#F4F4F4]/10 z-50",children:[e.jsx("div",{className:"lg:w-[60%] w-[100%]",children:e.jsx(Ft,{})}),e.jsx("div",{className:"lg:w-[40%] w-[100%]",children:e.jsx(zt,{})})]}),e.jsx("div",{className:"w-full p-5 pt-1 h-[calc(100svh-100px)] overflow-auto",children:e.jsx(Ms,{users:p,selectedEvents:y,loading:m&&p.length===0,isActiveAlertsSelect:v,notVisitedRoom:i})}),p.length<x&&e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2",children:e.jsx(F,{shape:"round",onClick:U,disabled:m,className:"shadow-lg",children:m?e.jsx(Y,{size:"small"}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Load More ",e.jsx(Tt,{size:12})]})})})]})})})}export{Ts as default};
//# sourceMappingURL=NurseDashboard-lWrlL8BM.js.map
